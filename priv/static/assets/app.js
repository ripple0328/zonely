(()=>{var zi=Object.create;var ct=Object.defineProperty,xi=Object.defineProperties,Li=Object.getOwnPropertyDescriptor,_i=Object.getOwnPropertyDescriptors,Ri=Object.getOwnPropertyNames,Rt=Object.getOwnPropertySymbols,Ii=Object.getPrototypeOf,Ot=Object.prototype.hasOwnProperty,Oi=Object.prototype.propertyIsEnumerable;var It=(e,t,i)=>t in e?ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,N=(e,t)=>{for(var i in t||(t={}))Ot.call(t,i)&&It(e,i,t[i]);if(Rt)for(var i of Rt(t))Oi.call(t,i)&&It(e,i,t[i]);return e},he=(e,t)=>xi(e,_i(t));var $i=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Di=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Ri(t))!Ot.call(e,s)&&s!==i&&ct(e,s,{get:()=>t[s],enumerable:!(n=Li(t,s))||n.enumerable});return e};var Mi=(e,t,i)=>(i=e!=null?zi(Ii(e)):{},Di(t||!e||!e.__esModule?ct(i,"default",{value:e,enumerable:!0}):i,e));var Si=$i((Ci,st)=>{(function(e,t){"use strict";(function(){for(var m=0,d=["ms","moz","webkit","o"],y=0;y<d.length&&!e.requestAnimationFrame;++y)e.requestAnimationFrame=e[d[y]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[d[y]+"CancelAnimationFrame"]||e[d[y]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(v,E){var L=new Date().getTime(),A=Math.max(0,16-(L-m)),P=e.setTimeout(function(){v(L+A)},A);return m=L+A,P}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(v){clearTimeout(v)})})();var i,n,s,o=null,r=null,a=null,l=function(m,d,y){m.addEventListener?m.addEventListener(d,y,!1):m.attachEvent?m.attachEvent("on"+d,y):m["on"+d]=y},c={autoRun:!0,barThickness:3,barColors:{0:"rgba(26,  188, 156, .9)",".25":"rgba(52,  152, 219, .9)",".50":"rgba(241, 196, 15,  .9)",".75":"rgba(230, 126, 34,  .9)","1.0":"rgba(211, 84,  0,   .9)"},shadowBlur:10,shadowColor:"rgba(0,   0,   0,   .6)",className:null},h=function(){i.width=e.innerWidth,i.height=c.barThickness*5;var m=i.getContext("2d");m.shadowBlur=c.shadowBlur,m.shadowColor=c.shadowColor;var d=m.createLinearGradient(0,0,i.width,0);for(var y in c.barColors)d.addColorStop(y,c.barColors[y]);m.lineWidth=c.barThickness,m.beginPath(),m.moveTo(0,c.barThickness/2),m.lineTo(Math.ceil(n*i.width),c.barThickness/2),m.strokeStyle=d,m.stroke()},f=function(){i=t.createElement("canvas");var m=i.style;m.position="fixed",m.top=m.left=m.right=m.margin=m.padding=0,m.zIndex=100001,m.display="none",c.className&&(i.className=c.className),t.body.appendChild(i),l(e,"resize",h)},g={config:function(m){for(var d in m)c.hasOwnProperty(d)&&(c[d]=m[d])},show:function(m){var d=typeof m;d==="undefined"?m=13:d==="string"&&(m=parseInt(m,10)),!s&&(s=!0,r!==null&&e.clearTimeout(r),i||f(),i.style.opacity=1,i.style.display="block",g.progress(0),c.autoRun&&function y(){o=e.requestAnimationFrame(y),g.progress("+"+.05*Math.pow(1-Math.sqrt(n),2))}(),a=e.setTimeout(function(){a=null},m))},progress:function(m){return typeof m=="undefined"||(typeof m=="string"&&(m=(m.indexOf("+")>=0||m.indexOf("-")>=0?n:0)+parseFloat(m)),n=m>1?1:m,h()),n},hide:function(){clearTimeout(a),a=null,s&&(s=!1,o!=null&&(e.cancelAnimationFrame(o),o=null),function m(){if(g.progress("+.1")>=1&&(i.style.opacity-=.05,i.style.opacity<=.05)){i.style.display="none",r=null;return}r=e.requestAnimationFrame(m)}())}};typeof st=="object"&&typeof st.exports=="object"?st.exports=g:typeof define=="function"&&define.amd?define(function(){return g}):this.topbar=g}).call(Ci,window,document)});(function(){var e=t();function t(){if(typeof window.CustomEvent=="function")return window.CustomEvent;function s(o,r){r=r||{bubbles:!1,cancelable:!1,detail:void 0};var a=document.createEvent("CustomEvent");return a.initCustomEvent(o,r.bubbles,r.cancelable,r.detail),a}return s.prototype=window.Event.prototype,s}function i(s,o){var r=document.createElement("input");return r.type="hidden",r.name=s,r.value=o,r}function n(s,o){var r=s.getAttribute("data-to"),a=i("_method",s.getAttribute("data-method")),l=i("_csrf_token",s.getAttribute("data-csrf")),c=document.createElement("form"),h=document.createElement("input"),f=s.getAttribute("target");c.method=s.getAttribute("data-method")==="get"?"get":"post",c.action=r,c.style.display="none",f?c.target=f:o&&(c.target="_blank"),c.appendChild(l),c.appendChild(a),document.body.appendChild(c),h.type="submit",c.appendChild(h),h.click()}window.addEventListener("click",function(s){var o=s.target;if(!s.defaultPrevented)for(;o&&o.getAttribute;){var r=new e("phoenix.link.click",{bubbles:!0,cancelable:!0});if(!o.dispatchEvent(r))return s.preventDefault(),s.stopImmediatePropagation(),!1;if(o.getAttribute("data-method")&&o.getAttribute("data-to"))return n(o,s.metaKey||s.shiftKey),s.preventDefault(),!1;o=o.parentNode}},!1),window.addEventListener("phoenix.link.click",function(s){var o=s.target.getAttribute("data-confirm");o&&!window.confirm(o)&&s.preventDefault()},!1)})();var ze=e=>typeof e=="function"?e:function(){return e},Ni=typeof self!="undefined"?self:null,Pe=typeof window!="undefined"?window:null,X=Ni||Pe||globalThis,Ui="2.0.0",K={connecting:0,open:1,closing:2,closed:3},Hi=1e4,Fi=1e3,j={closed:"closed",errored:"errored",joined:"joined",joining:"joining",leaving:"leaving"},te={close:"phx_close",error:"phx_error",join:"phx_join",reply:"phx_reply",leave:"phx_leave"},ht={longpoll:"longpoll",websocket:"websocket"},ji={complete:4},dt="base64url.bearer.phx.",Fe=class{constructor(e,t,i,n){this.channel=e,this.event=t,this.payload=i||function(){return{}},this.receivedResp=null,this.timeout=n,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}resend(e){this.timeout=e,this.reset(),this.send()}send(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload(),ref:this.ref,join_ref:this.channel.joinRef()}))}receive(e,t){return this.hasReceived(e)&&t(this.receivedResp.response),this.recHooks.push({status:e,callback:t}),this}reset(){this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1}matchReceive({status:e,response:t,_ref:i}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}startTimeout(){this.timeoutTimer&&this.cancelTimeout(),this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,e=>{this.cancelRefEvent(),this.cancelTimeout(),this.receivedResp=e,this.matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}trigger(e,t){this.channel.trigger(this.refEvent,{status:e,response:t})}},$t=class{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=null,this.tries=0}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}},Bi=class{constructor(e,t,i){this.state=j.closed,this.topic=e,this.params=ze(t||{}),this.socket=i,this.bindings=[],this.bindingRef=0,this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new Fe(this,te.join,this.params,this.timeout),this.pushBuffer=[],this.stateChangeRefs=[],this.rejoinTimer=new $t(()=>{this.socket.isConnected()&&this.rejoin()},this.socket.rejoinAfterMs),this.stateChangeRefs.push(this.socket.onError(()=>this.rejoinTimer.reset())),this.stateChangeRefs.push(this.socket.onOpen(()=>{this.rejoinTimer.reset(),this.isErrored()&&this.rejoin()})),this.joinPush.receive("ok",()=>{this.state=j.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this.joinPush.receive("error",()=>{this.state=j.errored,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.hasLogger()&&this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=j.closed,this.socket.remove(this)}),this.onError(n=>{this.socket.hasLogger()&&this.socket.log("channel",`error ${this.topic}`,n),this.isJoining()&&this.joinPush.reset(),this.state=j.errored,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.joinPush.receive("timeout",()=>{this.socket.hasLogger()&&this.socket.log("channel",`timeout ${this.topic} (${this.joinRef()})`,this.joinPush.timeout),new Fe(this,te.leave,ze({}),this.timeout).send(),this.state=j.errored,this.joinPush.reset(),this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.on(te.reply,(n,s)=>{this.trigger(this.replyEventName(s),n)})}join(e=this.timeout){if(this.joinedOnce)throw new Error("tried to join multiple times. 'join' can only be called a single time per channel instance");return this.timeout=e,this.joinedOnce=!0,this.rejoin(),this.joinPush}onClose(e){this.on(te.close,e)}onError(e){return this.on(te.error,t=>e(t))}on(e,t){let i=this.bindingRef++;return this.bindings.push({event:e,ref:i,callback:t}),i}off(e,t){this.bindings=this.bindings.filter(i=>!(i.event===e&&(typeof t=="undefined"||t===i.ref)))}canPush(){return this.socket.isConnected()&&this.isJoined()}push(e,t,i=this.timeout){if(t=t||{},!this.joinedOnce)throw new Error(`tried to push '${e}' to '${this.topic}' before joining. Use channel.join() before pushing events`);let n=new Fe(this,e,function(){return t},i);return this.canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}leave(e=this.timeout){this.rejoinTimer.reset(),this.joinPush.cancelTimeout(),this.state=j.leaving;let t=()=>{this.socket.hasLogger()&&this.socket.log("channel",`leave ${this.topic}`),this.trigger(te.close,"leave")},i=new Fe(this,te.leave,ze({}),e);return i.receive("ok",()=>t()).receive("timeout",()=>t()),i.send(),this.canPush()||i.trigger("ok",{}),i}onMessage(e,t,i){return t}isMember(e,t,i,n){return this.topic!==e?!1:n&&n!==this.joinRef()?(this.socket.hasLogger()&&this.socket.log("channel","dropping outdated message",{topic:e,event:t,payload:i,joinRef:n}),!1):!0}joinRef(){return this.joinPush.ref}rejoin(e=this.timeout){this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=j.joining,this.joinPush.resend(e))}trigger(e,t,i,n){let s=this.onMessage(e,t,i,n);if(t&&!s)throw new Error("channel onMessage callbacks must return the payload, modified or unmodified");let o=this.bindings.filter(r=>r.event===e);for(let r=0;r<o.length;r++)o[r].callback(s,i,n||this.joinRef())}replyEventName(e){return`chan_reply_${e}`}isClosed(){return this.state===j.closed}isErrored(){return this.state===j.errored}isJoined(){return this.state===j.joined}isJoining(){return this.state===j.joining}isLeaving(){return this.state===j.leaving}},Be=class{static request(e,t,i,n,s,o,r){if(X.XDomainRequest){let a=new X.XDomainRequest;return this.xdomainRequest(a,e,t,n,s,o,r)}else if(X.XMLHttpRequest){let a=new X.XMLHttpRequest;return this.xhrRequest(a,e,t,i,n,s,o,r)}else{if(X.fetch&&X.AbortController)return this.fetchRequest(e,t,i,n,s,o,r);throw new Error("No suitable XMLHttpRequest implementation found")}}static fetchRequest(e,t,i,n,s,o,r){let a={method:e,headers:i,body:n},l=null;if(s){l=new AbortController;let c=setTimeout(()=>l.abort(),s);a.signal=l.signal}return X.fetch(t,a).then(c=>c.text()).then(c=>this.parseJSON(c)).then(c=>r&&r(c)).catch(c=>{c.name==="AbortError"&&o?o():r&&r(null)}),l}static xdomainRequest(e,t,i,n,s,o,r){return e.timeout=s,e.open(t,i),e.onload=()=>{let a=this.parseJSON(e.responseText);r&&r(a)},o&&(e.ontimeout=o),e.onprogress=()=>{},e.send(n),e}static xhrRequest(e,t,i,n,s,o,r,a){e.open(t,i,!0),e.timeout=o;for(let[l,c]of Object.entries(n))e.setRequestHeader(l,c);return e.onerror=()=>a&&a(null),e.onreadystatechange=()=>{if(e.readyState===ji.complete&&a){let l=this.parseJSON(e.responseText);a(l)}},r&&(e.ontimeout=r),e.send(s),e}static parseJSON(e){if(!e||e==="")return null;try{return JSON.parse(e)}catch(t){return console&&console.log("failed to parse JSON response",e),null}}static serialize(e,t){let i=[];for(var n in e){if(!Object.prototype.hasOwnProperty.call(e,n))continue;let s=t?`${t}[${n}]`:n,o=e[n];typeof o=="object"?i.push(this.serialize(o,s)):i.push(encodeURIComponent(s)+"="+encodeURIComponent(o))}return i.join("&")}static appendParams(e,t){if(Object.keys(t).length===0)return e;let i=e.match(/\?/)?"&":"?";return`${e}${i}${this.serialize(t)}`}},Ji=e=>{let t="",i=new Uint8Array(e),n=i.byteLength;for(let s=0;s<n;s++)t+=String.fromCharCode(i[s]);return btoa(t)},Ee=class{constructor(e,t){t&&t.length===2&&t[1].startsWith(dt)&&(this.authToken=atob(t[1].slice(dt.length))),this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.reqs=new Set,this.awaitingBatchAck=!1,this.currentBatch=null,this.currentBatchTimer=null,this.batchBuffer=[],this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(e),this.readyState=K.connecting,setTimeout(()=>this.poll(),0)}normalizeEndpoint(e){return e.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+ht.websocket),"$1/"+ht.longpoll)}endpointURL(){return Be.appendParams(this.pollEndpoint,{token:this.token})}closeAndRetry(e,t,i){this.close(e,t,i),this.readyState=K.connecting}ontimeout(){this.onerror("timeout"),this.closeAndRetry(1005,"timeout",!1)}isActive(){return this.readyState===K.open||this.readyState===K.connecting}poll(){let e={Accept:"application/json"};this.authToken&&(e["X-Phoenix-AuthToken"]=this.authToken),this.ajax("GET",e,null,()=>this.ontimeout(),t=>{if(t){var{status:i,token:n,messages:s}=t;this.token=n}else i=0;switch(i){case 200:s.forEach(o=>{setTimeout(()=>this.onmessage({data:o}),0)}),this.poll();break;case 204:this.poll();break;case 410:this.readyState=K.open,this.onopen({}),this.poll();break;case 403:this.onerror(403),this.close(1008,"forbidden",!1);break;case 0:case 500:this.onerror(500),this.closeAndRetry(1011,"internal server error",500);break;default:throw new Error(`unhandled poll status ${i}`)}})}send(e){typeof e!="string"&&(e=Ji(e)),this.currentBatch?this.currentBatch.push(e):this.awaitingBatchAck?this.batchBuffer.push(e):(this.currentBatch=[e],this.currentBatchTimer=setTimeout(()=>{this.batchSend(this.currentBatch),this.currentBatch=null},0))}batchSend(e){this.awaitingBatchAck=!0,this.ajax("POST",{"Content-Type":"application/x-ndjson"},e.join(`
`),()=>this.onerror("timeout"),t=>{this.awaitingBatchAck=!1,!t||t.status!==200?(this.onerror(t&&t.status),this.closeAndRetry(1011,"internal server error",!1)):this.batchBuffer.length>0&&(this.batchSend(this.batchBuffer),this.batchBuffer=[])})}close(e,t,i){for(let s of this.reqs)s.abort();this.readyState=K.closed;let n=Object.assign({code:1e3,reason:void 0,wasClean:!0},{code:e,reason:t,wasClean:i});this.batchBuffer=[],clearTimeout(this.currentBatchTimer),this.currentBatchTimer=null,typeof CloseEvent!="undefined"?this.onclose(new CloseEvent("close",n)):this.onclose(n)}ajax(e,t,i,n,s){let o,r=()=>{this.reqs.delete(o),n()};o=Be.request(e,this.endpointURL(),t,i,this.timeout,r,a=>{this.reqs.delete(o),this.isActive()&&s(a)}),this.reqs.add(o)}};var je={HEADER_LENGTH:1,META_LENGTH:4,KINDS:{push:0,reply:1,broadcast:2},encode(e,t){if(e.payload.constructor===ArrayBuffer)return t(this.binaryEncode(e));{let i=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(i))}},decode(e,t){if(e.constructor===ArrayBuffer)return t(this.binaryDecode(e));{let[i,n,s,o,r]=JSON.parse(e);return t({join_ref:i,ref:n,topic:s,event:o,payload:r})}},binaryEncode(e){let{join_ref:t,ref:i,event:n,topic:s,payload:o}=e,r=this.META_LENGTH+t.length+i.length+s.length+n.length,a=new ArrayBuffer(this.HEADER_LENGTH+r),l=new DataView(a),c=0;l.setUint8(c++,this.KINDS.push),l.setUint8(c++,t.length),l.setUint8(c++,i.length),l.setUint8(c++,s.length),l.setUint8(c++,n.length),Array.from(t,f=>l.setUint8(c++,f.charCodeAt(0))),Array.from(i,f=>l.setUint8(c++,f.charCodeAt(0))),Array.from(s,f=>l.setUint8(c++,f.charCodeAt(0))),Array.from(n,f=>l.setUint8(c++,f.charCodeAt(0)));var h=new Uint8Array(a.byteLength+o.byteLength);return h.set(new Uint8Array(a),0),h.set(new Uint8Array(o),a.byteLength),h.buffer},binaryDecode(e){let t=new DataView(e),i=t.getUint8(0),n=new TextDecoder;switch(i){case this.KINDS.push:return this.decodePush(e,t,n);case this.KINDS.reply:return this.decodeReply(e,t,n);case this.KINDS.broadcast:return this.decodeBroadcast(e,t,n)}},decodePush(e,t,i){let n=t.getUint8(1),s=t.getUint8(2),o=t.getUint8(3),r=this.HEADER_LENGTH+this.META_LENGTH-1,a=i.decode(e.slice(r,r+n));r=r+n;let l=i.decode(e.slice(r,r+s));r=r+s;let c=i.decode(e.slice(r,r+o));r=r+o;let h=e.slice(r,e.byteLength);return{join_ref:a,ref:null,topic:l,event:c,payload:h}},decodeReply(e,t,i){let n=t.getUint8(1),s=t.getUint8(2),o=t.getUint8(3),r=t.getUint8(4),a=this.HEADER_LENGTH+this.META_LENGTH,l=i.decode(e.slice(a,a+n));a=a+n;let c=i.decode(e.slice(a,a+s));a=a+s;let h=i.decode(e.slice(a,a+o));a=a+o;let f=i.decode(e.slice(a,a+r));a=a+r;let g=e.slice(a,e.byteLength),m={status:f,response:g};return{join_ref:l,ref:c,topic:h,event:te.reply,payload:m}},decodeBroadcast(e,t,i){let n=t.getUint8(1),s=t.getUint8(2),o=this.HEADER_LENGTH+2,r=i.decode(e.slice(o,o+n));o=o+n;let a=i.decode(e.slice(o,o+s));o=o+s;let l=e.slice(o,e.byteLength);return{join_ref:null,ref:null,topic:r,event:a,payload:l}}},Dt=class{constructor(e,t={}){this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=t.timeout||Hi,this.transport=t.transport||X.WebSocket||Ee,this.primaryPassedHealthCheck=!1,this.longPollFallbackMs=t.longPollFallbackMs,this.fallbackTimer=null,this.sessionStore=t.sessionStorage||X&&X.sessionStorage,this.establishedConnections=0,this.defaultEncoder=je.encode.bind(je),this.defaultDecoder=je.decode.bind(je),this.closeWasClean=!1,this.disconnecting=!1,this.binaryType=t.binaryType||"arraybuffer",this.connectClock=1,this.transport!==Ee?(this.encode=t.encode||this.defaultEncoder,this.decode=t.decode||this.defaultDecoder):(this.encode=this.defaultEncoder,this.decode=this.defaultDecoder);let i=null;Pe&&Pe.addEventListener&&(Pe.addEventListener("pagehide",n=>{this.conn&&(this.disconnect(),i=this.connectClock)}),Pe.addEventListener("pageshow",n=>{i===this.connectClock&&(i=null,this.connect())})),this.heartbeatIntervalMs=t.heartbeatIntervalMs||3e4,this.rejoinAfterMs=n=>t.rejoinAfterMs?t.rejoinAfterMs(n):[1e3,2e3,5e3][n-1]||1e4,this.reconnectAfterMs=n=>t.reconnectAfterMs?t.reconnectAfterMs(n):[10,50,100,150,200,250,500,1e3,2e3][n-1]||5e3,this.logger=t.logger||null,!this.logger&&t.debug&&(this.logger=(n,s,o)=>{console.log(`${n}: ${s}`,o)}),this.longpollerTimeout=t.longpollerTimeout||2e4,this.params=ze(t.params||{}),this.endPoint=`${e}/${ht.websocket}`,this.vsn=t.vsn||Ui,this.heartbeatTimeoutTimer=null,this.heartbeatTimer=null,this.pendingHeartbeatRef=null,this.reconnectTimer=new $t(()=>{this.teardown(()=>this.connect())},this.reconnectAfterMs),this.authToken=t.authToken}getLongPollTransport(){return Ee}replaceTransport(e){this.connectClock++,this.closeWasClean=!0,clearTimeout(this.fallbackTimer),this.reconnectTimer.reset(),this.conn&&(this.conn.close(),this.conn=null),this.transport=e}protocol(){return location.protocol.match(/^https/)?"wss":"ws"}endPointURL(){let e=Be.appendParams(Be.appendParams(this.endPoint,this.params()),{vsn:this.vsn});return e.charAt(0)!=="/"?e:e.charAt(1)==="/"?`${this.protocol()}:${e}`:`${this.protocol()}://${location.host}${e}`}disconnect(e,t,i){this.connectClock++,this.disconnecting=!0,this.closeWasClean=!0,clearTimeout(this.fallbackTimer),this.reconnectTimer.reset(),this.teardown(()=>{this.disconnecting=!1,e&&e()},t,i)}connect(e){e&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=ze(e)),!(this.conn&&!this.disconnecting)&&(this.longPollFallbackMs&&this.transport!==Ee?this.connectWithFallback(Ee,this.longPollFallbackMs):this.transportConnect())}log(e,t,i){this.logger&&this.logger(e,t,i)}hasLogger(){return this.logger!==null}onOpen(e){let t=this.makeRef();return this.stateChangeCallbacks.open.push([t,e]),t}onClose(e){let t=this.makeRef();return this.stateChangeCallbacks.close.push([t,e]),t}onError(e){let t=this.makeRef();return this.stateChangeCallbacks.error.push([t,e]),t}onMessage(e){let t=this.makeRef();return this.stateChangeCallbacks.message.push([t,e]),t}ping(e){if(!this.isConnected())return!1;let t=this.makeRef(),i=Date.now();this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:t});let n=this.onMessage(s=>{s.ref===t&&(this.off([n]),e(Date.now()-i))});return!0}transportConnect(){this.connectClock++,this.closeWasClean=!1;let e;this.authToken&&(e=["phoenix",`${dt}${btoa(this.authToken).replace(/=/g,"")}`]),this.conn=new this.transport(this.endPointURL(),e),this.conn.binaryType=this.binaryType,this.conn.timeout=this.longpollerTimeout,this.conn.onopen=()=>this.onConnOpen(),this.conn.onerror=t=>this.onConnError(t),this.conn.onmessage=t=>this.onConnMessage(t),this.conn.onclose=t=>this.onConnClose(t)}getSession(e){return this.sessionStore&&this.sessionStore.getItem(e)}storeSession(e,t){this.sessionStore&&this.sessionStore.setItem(e,t)}connectWithFallback(e,t=2500){clearTimeout(this.fallbackTimer);let i=!1,n=!0,s,o,r=a=>{this.log("transport",`falling back to ${e.name}...`,a),this.off([s,o]),n=!1,this.replaceTransport(e),this.transportConnect()};if(this.getSession(`phx:fallback:${e.name}`))return r("memorized");this.fallbackTimer=setTimeout(r,t),o=this.onError(a=>{this.log("transport","error",a),n&&!i&&(clearTimeout(this.fallbackTimer),r(a))}),this.onOpen(()=>{if(i=!0,!n)return this.primaryPassedHealthCheck||this.storeSession(`phx:fallback:${e.name}`,"true"),this.log("transport",`established ${e.name} fallback`);clearTimeout(this.fallbackTimer),this.fallbackTimer=setTimeout(r,t),this.ping(a=>{this.log("transport","connected to primary after",a),this.primaryPassedHealthCheck=!0,clearTimeout(this.fallbackTimer)})}),this.transportConnect()}clearHeartbeats(){clearTimeout(this.heartbeatTimer),clearTimeout(this.heartbeatTimeoutTimer)}onConnOpen(){this.hasLogger()&&this.log("transport",`${this.transport.name} connected to ${this.endPointURL()}`),this.closeWasClean=!1,this.disconnecting=!1,this.establishedConnections++,this.flushSendBuffer(),this.reconnectTimer.reset(),this.resetHeartbeat(),this.stateChangeCallbacks.open.forEach(([,e])=>e())}heartbeatTimeout(){this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null,this.hasLogger()&&this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.triggerChanError(),this.closeWasClean=!1,this.teardown(()=>this.reconnectTimer.scheduleTimeout(),Fi,"heartbeat timeout"))}resetHeartbeat(){this.conn&&this.conn.skipHeartbeat||(this.pendingHeartbeatRef=null,this.clearHeartbeats(),this.heartbeatTimer=setTimeout(()=>this.sendHeartbeat(),this.heartbeatIntervalMs))}teardown(e,t,i){if(!this.conn)return e&&e();let n=this.connectClock;this.waitForBufferDone(()=>{n===this.connectClock&&(this.conn&&(t?this.conn.close(t,i||""):this.conn.close()),this.waitForSocketClosed(()=>{n===this.connectClock&&(this.conn&&(this.conn.onopen=function(){},this.conn.onerror=function(){},this.conn.onmessage=function(){},this.conn.onclose=function(){},this.conn=null),e&&e())}))})}waitForBufferDone(e,t=1){if(t===5||!this.conn||!this.conn.bufferedAmount){e();return}setTimeout(()=>{this.waitForBufferDone(e,t+1)},150*t)}waitForSocketClosed(e,t=1){if(t===5||!this.conn||this.conn.readyState===K.closed){e();return}setTimeout(()=>{this.waitForSocketClosed(e,t+1)},150*t)}onConnClose(e){let t=e&&e.code;this.hasLogger()&&this.log("transport","close",e),this.triggerChanError(),this.clearHeartbeats(),!this.closeWasClean&&t!==1e3&&this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(([,i])=>i(e))}onConnError(e){this.hasLogger()&&this.log("transport",e);let t=this.transport,i=this.establishedConnections;this.stateChangeCallbacks.error.forEach(([,n])=>{n(e,t,i)}),(t===this.transport||i>0)&&this.triggerChanError()}triggerChanError(){this.channels.forEach(e=>{e.isErrored()||e.isLeaving()||e.isClosed()||e.trigger(te.error)})}connectionState(){switch(this.conn&&this.conn.readyState){case K.connecting:return"connecting";case K.open:return"open";case K.closing:return"closing";default:return"closed"}}isConnected(){return this.connectionState()==="open"}remove(e){this.off(e.stateChangeRefs),this.channels=this.channels.filter(t=>t!==e)}off(e){for(let t in this.stateChangeCallbacks)this.stateChangeCallbacks[t]=this.stateChangeCallbacks[t].filter(([i])=>e.indexOf(i)===-1)}channel(e,t={}){let i=new Bi(e,t,this);return this.channels.push(i),i}push(e){if(this.hasLogger()){let{topic:t,event:i,payload:n,ref:s,join_ref:o}=e;this.log("push",`${t} ${i} (${o}, ${s})`,n)}this.isConnected()?this.encode(e,t=>this.conn.send(t)):this.sendBuffer.push(()=>this.encode(e,t=>this.conn.send(t)))}makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}sendHeartbeat(){this.pendingHeartbeatRef&&!this.isConnected()||(this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatTimeoutTimer=setTimeout(()=>this.heartbeatTimeout(),this.heartbeatIntervalMs))}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}onConnMessage(e){this.decode(e.data,t=>{let{topic:i,event:n,payload:s,ref:o,join_ref:r}=t;o&&o===this.pendingHeartbeatRef&&(this.clearHeartbeats(),this.pendingHeartbeatRef=null,this.heartbeatTimer=setTimeout(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)),this.hasLogger()&&this.log("receive",`${s.status||""} ${i} ${n} ${o&&"("+o+")"||""}`,s);for(let a=0;a<this.channels.length;a++){let l=this.channels[a];l.isMember(i,n,s,r)&&l.trigger(n,s,o,r)}for(let a=0;a<this.stateChangeCallbacks.message.length;a++){let[,l]=this.stateChangeCallbacks.message[a];l(t)}})}leaveOpenTopic(e){let t=this.channels.find(i=>i.topic===e&&(i.isJoined()||i.isJoining()));t&&(this.hasLogger()&&this.log("transport",`leaving duplicate topic "${e}"`),t.leave())}};var hi="consecutive-reloads",Vi=10,Wi=5e3,qi=1e4,Xi=3e4,di=["phx-click-loading","phx-change-loading","phx-submit-loading","phx-keydown-loading","phx-keyup-loading","phx-blur-loading","phx-focus-loading","phx-hook-loading"],ne="data-phx-component",Ge="data-phx-view",ut="data-phx-link",Ki="track-static",Gi="data-phx-link-state",Ce="data-phx-ref-loading",W="data-phx-ref-src",I="data-phx-ref-lock",Mt="phx-pending-refs",ui="track-uploads",se="data-phx-upload-ref",Pt="data-phx-preflighted-refs",Yi="data-phx-done-refs",Nt="drop-target",bt="data-phx-active-refs",Ye="phx:live-file:updated",fi="data-phx-skip",mi="data-phx-id",Ut="data-phx-prune",Ht="phx-connected",de="phx-loading",ve="phx-error",Ft="phx-client-error",xe="phx-server-error",pe="data-phx-parent-id",zt="data-phx-main",ce="data-phx-root-id",At="viewport-top",wt="viewport-bottom",Zi="trigger-action",tt="phx-has-focused",Qi=["text","textarea","number","email","password","search","tel","url","date","time","datetime-local","color","range"],pi=["checkbox","radio"],Ne="phx-has-submitted",Z="data-phx-session",ke=`[${Z}]`,Tt="data-phx-sticky",fe="data-phx-static",Ct="data-phx-readonly",Te="data-phx-disabled",jt="disable-with",it="data-phx-disable-with-restore",Le="hook",en="debounce",tn="throttle",nt="update",Ze="stream",_e="data-phx-stream",gi="data-phx-portal",Se="data-phx-teleported",ft="data-phx-teleported-src",Qe="data-phx-runtime-hook",nn="data-phx-pid",sn="key",G="phxPrivate",Bt="auto-recover",Je="phx:live-socket:debug",mt="phx:live-socket:profiling",pt="phx:live-socket:latency-sim",Ve="phx:nav-history-position",on="progress",Jt="mounted",Vt="__phoenix_reload_status__",rn=1,Wt=3,an=200,ln=500,cn="phx-",hn=3e4,Re="debounce-trigger",Ie="throttled",qt="debounce-prev-key",dn={debounce:300,throttle:300},Xt=[Ce,W,I],V="s",gt="r",U="c",R="k",Y="kc",Kt="e",Gt="r",Yt="t",ae="p",be="stream",un=class{constructor(e,t,i){let{chunk_size:n,chunk_timeout:s}=t;this.liveSocket=i,this.entry=e,this.offset=0,this.chunkSize=n,this.chunkTimeout=s,this.chunkTimer=null,this.errored=!1,this.uploadChannel=i.channel(`lvu:${e.ref}`,{token:e.metadata()})}error(e){this.errored||(this.uploadChannel.leave(),this.errored=!0,clearTimeout(this.chunkTimer),this.entry.error(e))}upload(){this.uploadChannel.onError(e=>this.error(e)),this.uploadChannel.join().receive("ok",e=>this.readNextChunk()).receive("error",e=>this.error(e))}isDone(){return this.offset>=this.entry.file.size}readNextChunk(){let e=new window.FileReader,t=this.entry.file.slice(this.offset,this.chunkSize+this.offset);e.onload=i=>{if(i.target.error===null)this.offset+=i.target.result.byteLength,this.pushChunk(i.target.result);else return x("Read error: "+i.target.error)},e.readAsArrayBuffer(t)}pushChunk(e){this.uploadChannel.isJoined()&&this.uploadChannel.push("chunk",e,this.chunkTimeout).receive("ok",()=>{this.entry.progress(this.offset/this.entry.file.size*100),this.isDone()||(this.chunkTimer=setTimeout(()=>this.readNextChunk(),this.liveSocket.getLatencySim()||0))}).receive("error",({reason:t})=>this.error(t))}},x=(e,t)=>console.error&&console.error(e,t),ie=e=>{let t=typeof e;return t==="number"||t==="string"&&/^(0|[1-9]\d*)$/.test(e)};function fn(){let e=new Set,t=document.querySelectorAll("*[id]");for(let i=0,n=t.length;i<n;i++)e.has(t[i].id)?console.error(`Multiple IDs detected: ${t[i].id}. Ensure unique element ids.`):e.add(t[i].id)}function mn(e){let t=new Set;Object.keys(e).forEach(i=>{let n=document.getElementById(i);n&&n.parentElement&&n.parentElement.getAttribute("phx-update")!=="stream"&&t.add(`The stream container with id "${n.parentElement.id}" is missing the phx-update="stream" attribute. Ensure it is set for streams to work properly.`)}),t.forEach(i=>console.error(i))}var pn=(e,t,i,n)=>{e.liveSocket.isDebugEnabled()&&console.log(`${e.id} ${t}: ${i} - `,n)},Oe=e=>typeof e=="function"?e:function(){return e},et=e=>JSON.parse(JSON.stringify(e)),Me=(e,t,i)=>{do{if(e.matches(`[${t}]`)&&!e.disabled)return e;e=e.parentElement||e.parentNode}while(e!==null&&e.nodeType===1&&!(i&&i.isSameNode(e)||e.matches(ke)));return null},Ae=e=>e!==null&&typeof e=="object"&&!(e instanceof Array),gn=(e,t)=>JSON.stringify(e)===JSON.stringify(t),Zt=e=>{for(let t in e)return!1;return!0},me=(e,t)=>e&&t(e),yn=function(e,t,i,n){e.forEach(s=>{new un(s,i.config,n).upload()})},vn={canPushState(){return typeof history.pushState!="undefined"},dropLocal(e,t,i){return e.removeItem(this.localKey(t,i))},updateLocal(e,t,i,n,s){let o=this.getLocal(e,t,i),r=this.localKey(t,i),a=o===null?n:s(o);return e.setItem(r,JSON.stringify(a)),a},getLocal(e,t,i){return JSON.parse(e.getItem(this.localKey(t,i)))},updateCurrentState(e){this.canPushState()&&history.replaceState(e(history.state||{}),"",window.location.href)},pushState(e,t,i){if(this.canPushState()){if(i!==window.location.href){if(t.type=="redirect"&&t.scroll){let n=history.state||{};n.scroll=t.scroll,history.replaceState(n,"",window.location.href)}delete t.scroll,history[e+"State"](t,"",i||null),window.requestAnimationFrame(()=>{let n=this.getHashTargetEl(window.location.hash);n?n.scrollIntoView():t.type==="redirect"&&window.scroll(0,0)})}}else this.redirect(i)},setCookie(e,t,i){let n=typeof i=="number"?` max-age=${i};`:"";document.cookie=`${e}=${t};${n} path=/`},getCookie(e){return document.cookie.replace(new RegExp(`(?:(?:^|.*;s*)${e}s*=s*([^;]*).*$)|^.*$`),"$1")},deleteCookie(e){document.cookie=`${e}=; max-age=-1; path=/`},redirect(e,t,i=n=>{window.location.href=n}){t&&this.setCookie("__phoenix_flash__",t,60),i(e)},localKey(e,t){return`${e}-${t}`},getHashTargetEl(e){let t=e.toString().substring(1);if(t!=="")return document.getElementById(t)||document.querySelector(`a[name="${t}"]`)}},H=vn,ue={byId(e){return document.getElementById(e)||x(`no id found for ${e}`)},removeClass(e,t){e.classList.remove(t),e.classList.length===0&&e.removeAttribute("class")},all(e,t,i){if(!e)return[];let n=Array.from(e.querySelectorAll(t));return i&&n.forEach(i),n},childNodeLength(e){let t=document.createElement("template");return t.innerHTML=e,t.content.childElementCount},isUploadInput(e){return e.type==="file"&&e.getAttribute(se)!==null},isAutoUpload(e){return e.hasAttribute("data-phx-auto-upload")},findUploadInputs(e){let t=e.id,i=this.all(document,`input[type="file"][${se}][form="${t}"]`);return this.all(e,`input[type="file"][${se}]`).concat(i)},findComponentNodeList(e,t,i=document){return this.all(i,`[${Ge}="${e}"][${ne}="${t}"]`)},isPhxDestroyed(e){return!!(e.id&&ue.private(e,"destroyed"))},wantsNewTab(e){let t=e.ctrlKey||e.shiftKey||e.metaKey||e.button&&e.button===1,i=e.target instanceof HTMLAnchorElement&&e.target.hasAttribute("download"),n=e.target.hasAttribute("target")&&e.target.getAttribute("target").toLowerCase()==="_blank",s=e.target.hasAttribute("target")&&!e.target.getAttribute("target").startsWith("_");return t||n||i||s},isUnloadableFormSubmit(e){return e.target&&e.target.getAttribute("method")==="dialog"||e.submitter&&e.submitter.getAttribute("formmethod")==="dialog"?!1:!e.defaultPrevented&&!this.wantsNewTab(e)},isNewPageClick(e,t){let i=e.target instanceof HTMLAnchorElement?e.target.getAttribute("href"):null,n;if(e.defaultPrevented||i===null||this.wantsNewTab(e)||i.startsWith("mailto:")||i.startsWith("tel:")||e.target.isContentEditable)return!1;try{n=new URL(i)}catch(s){try{n=new URL(i,t)}catch(o){return!0}}return n.host===t.host&&n.protocol===t.protocol&&n.pathname===t.pathname&&n.search===t.search?n.hash===""&&!n.href.endsWith("#"):n.protocol.startsWith("http")},markPhxChildDestroyed(e){this.isPhxChild(e)&&e.setAttribute(Z,""),this.putPrivate(e,"destroyed",!0)},findPhxChildrenInFragment(e,t){let i=document.createElement("template");return i.innerHTML=e,this.findPhxChildren(i.content,t)},isIgnored(e,t){return(e.getAttribute(t)||e.getAttribute("data-phx-update"))==="ignore"},isPhxUpdate(e,t,i){return e.getAttribute&&i.indexOf(e.getAttribute(t))>=0},findPhxSticky(e){return this.all(e,`[${Tt}]`)},findPhxChildren(e,t){return this.all(e,`${ke}[${pe}="${t}"]`)},findExistingParentCIDs(e,t){let i=new Set,n=new Set;return t.forEach(s=>{this.all(document,`[${Ge}="${e}"][${ne}="${s}"]`).forEach(o=>{i.add(s),this.all(o,`[${Ge}="${e}"][${ne}]`).map(r=>parseInt(r.getAttribute(ne))).forEach(r=>n.add(r))})}),n.forEach(s=>i.delete(s)),i},private(e,t){return e[G]&&e[G][t]},deletePrivate(e,t){e[G]&&delete e[G][t]},putPrivate(e,t,i){e[G]||(e[G]={}),e[G][t]=i},updatePrivate(e,t,i,n){let s=this.private(e,t);s===void 0?this.putPrivate(e,t,n(i)):this.putPrivate(e,t,n(s))},syncPendingAttrs(e,t){e.hasAttribute(W)&&(di.forEach(i=>{e.classList.contains(i)&&t.classList.add(i)}),Xt.filter(i=>e.hasAttribute(i)).forEach(i=>{t.setAttribute(i,e.getAttribute(i))}))},copyPrivates(e,t){t[G]&&(e[G]=t[G])},putTitle(e){let t=document.querySelector("title");if(t){let{prefix:i,suffix:n,default:s}=t.dataset,o=typeof e!="string"||e.trim()==="";if(o&&typeof s!="string")return;let r=o?s:e;document.title=`${i||""}${r||""}${n||""}`}else document.title=e},debounce(e,t,i,n,s,o,r,a){let l=e.getAttribute(i),c=e.getAttribute(s);l===""&&(l=n),c===""&&(c=o);let h=l||c;switch(h){case null:return a();case"blur":this.incCycle(e,"debounce-blur-cycle",()=>{r()&&a()}),this.once(e,"debounce-blur")&&e.addEventListener("blur",()=>this.triggerCycle(e,"debounce-blur-cycle"));return;default:let f=parseInt(h),g=()=>c?this.deletePrivate(e,Ie):a(),m=this.incCycle(e,Re,g);if(isNaN(f))return x(`invalid throttle/debounce value: ${h}`);if(c){let y=!1;if(t.type==="keydown"){let v=this.private(e,qt);this.putPrivate(e,qt,t.key),y=v!==t.key}if(!y&&this.private(e,Ie))return!1;{a();let v=setTimeout(()=>{r()&&this.triggerCycle(e,Re)},f);this.putPrivate(e,Ie,v)}}else setTimeout(()=>{r()&&this.triggerCycle(e,Re,m)},f);let d=e.form;d&&this.once(d,"bind-debounce")&&d.addEventListener("submit",()=>{Array.from(new FormData(d).entries(),([y])=>{let v=d.querySelector(`[name="${y}"]`);this.incCycle(v,Re),this.deletePrivate(v,Ie)})}),this.once(e,"bind-debounce")&&e.addEventListener("blur",()=>{clearTimeout(this.private(e,Ie)),this.triggerCycle(e,Re)})}},triggerCycle(e,t,i){let[n,s]=this.private(e,t);i||(i=n),i===n&&(this.incCycle(e,t),s())},once(e,t){return this.private(e,t)===!0?!1:(this.putPrivate(e,t,!0),!0)},incCycle(e,t,i=function(){}){let[n]=this.private(e,t)||[0,i];return n++,this.putPrivate(e,t,[n,i]),n},maintainPrivateHooks(e,t,i,n){e.hasAttribute&&e.hasAttribute("data-phx-hook")&&!t.hasAttribute("data-phx-hook")&&t.setAttribute("data-phx-hook",e.getAttribute("data-phx-hook")),t.hasAttribute&&(t.hasAttribute(i)||t.hasAttribute(n))&&t.setAttribute("data-phx-hook","Phoenix.InfiniteScroll")},putCustomElHook(e,t){e.isConnected?e.setAttribute("data-phx-hook",""):console.error(`
        hook attached to non-connected DOM element
        ensure you are calling createHook within your connectedCallback. ${e.outerHTML}
      `),this.putPrivate(e,"custom-el-hook",t)},getCustomElHook(e){return this.private(e,"custom-el-hook")},isUsedInput(e){return e.nodeType===Node.ELEMENT_NODE&&(this.private(e,tt)||this.private(e,Ne))},resetForm(e){Array.from(e.elements).forEach(t=>{this.deletePrivate(t,tt),this.deletePrivate(t,Ne)})},isPhxChild(e){return e.getAttribute&&e.getAttribute(pe)},isPhxSticky(e){return e.getAttribute&&e.getAttribute(Tt)!==null},isChildOfAny(e,t){return!!t.find(i=>i.contains(e))},firstPhxChild(e){return this.isPhxChild(e)?e:this.all(e,`[${pe}]`)[0]},isPortalTemplate(e){return e.tagName==="TEMPLATE"&&e.hasAttribute(gi)},closestViewEl(e){let t=e.closest(`[${Se}],${ke}`);return t?t.hasAttribute(Se)?this.byId(t.getAttribute(Se)):t.hasAttribute(Z)?t:null:null},dispatchEvent(e,t,i={}){let n=!0;e.nodeName==="INPUT"&&e.type==="file"&&t==="click"&&(n=!1);let r={bubbles:i.bubbles===void 0?n:!!i.bubbles,cancelable:!0,detail:i.detail||{}},a=t==="click"?new MouseEvent("click",r):new CustomEvent(t,r);e.dispatchEvent(a)},cloneNode(e,t){if(typeof t=="undefined")return e.cloneNode(!0);{let i=e.cloneNode(!1);return i.innerHTML=t,i}},mergeAttrs(e,t,i={}){let n=new Set(i.exclude||[]),s=i.isIgnored,o=t.attributes;for(let a=o.length-1;a>=0;a--){let l=o[a].name;if(n.has(l))l==="value"&&e.value===t.value&&e.setAttribute("value",t.getAttribute(l));else{let c=t.getAttribute(l);e.getAttribute(l)!==c&&(!s||s&&l.startsWith("data-"))&&e.setAttribute(l,c)}}let r=e.attributes;for(let a=r.length-1;a>=0;a--){let l=r[a].name;s?l.startsWith("data-")&&!t.hasAttribute(l)&&!Xt.includes(l)&&e.removeAttribute(l):t.hasAttribute(l)||e.removeAttribute(l)}},mergeFocusedInput(e,t){e instanceof HTMLSelectElement||ue.mergeAttrs(e,t,{exclude:["value"]}),t.readOnly?e.setAttribute("readonly",!0):e.removeAttribute("readonly")},hasSelectionRange(e){return e.setSelectionRange&&(e.type==="text"||e.type==="textarea")},restoreFocus(e,t,i){if(e instanceof HTMLSelectElement&&e.focus(),!ue.isTextualInput(e))return;e.matches(":focus")||e.focus(),this.hasSelectionRange(e)&&e.setSelectionRange(t,i)},isFormInput(e){return e.localName&&customElements.get(e.localName)?customElements.get(e.localName).formAssociated:/^(?:input|select|textarea)$/i.test(e.tagName)&&e.type!=="button"},syncAttrsToProps(e){e instanceof HTMLInputElement&&pi.indexOf(e.type.toLocaleLowerCase())>=0&&(e.checked=e.getAttribute("checked")!==null)},isTextualInput(e){return Qi.indexOf(e.type)>=0},isNowTriggerFormExternal(e,t){return e.getAttribute&&e.getAttribute(t)!==null&&document.body.contains(e)},cleanChildNodes(e,t){if(ue.isPhxUpdate(e,t,["append","prepend",Ze])){let i=[];e.childNodes.forEach(n=>{n.id||(!(n.nodeType===Node.TEXT_NODE&&n.nodeValue.trim()==="")&&n.nodeType!==Node.COMMENT_NODE&&x(`only HTML element tags with an id are allowed inside containers with phx-update.

removing illegal node: "${(n.outerHTML||n.nodeValue).trim()}"

`),i.push(n))}),i.forEach(n=>n.remove())}},replaceRootContainer(e,t,i){let n=new Set(["id",Z,fe,zt,ce]);if(e.tagName.toLowerCase()===t.toLowerCase())return Array.from(e.attributes).filter(s=>!n.has(s.name.toLowerCase())).forEach(s=>e.removeAttribute(s.name)),Object.keys(i).filter(s=>!n.has(s.toLowerCase())).forEach(s=>e.setAttribute(s,i[s])),e;{let s=document.createElement(t);return Object.keys(i).forEach(o=>s.setAttribute(o,i[o])),n.forEach(o=>s.setAttribute(o,e.getAttribute(o))),s.innerHTML=e.innerHTML,e.replaceWith(s),s}},getSticky(e,t,i){let n=(ue.private(e,"sticky")||[]).find(([s])=>t===s);if(n){let[s,o,r]=n;return r}else return typeof i=="function"?i():i},deleteSticky(e,t){this.updatePrivate(e,"sticky",[],i=>i.filter(([n,s])=>n!==t))},putSticky(e,t,i){let n=i(e);this.updatePrivate(e,"sticky",[],s=>{let o=s.findIndex(([r])=>t===r);return o>=0?s[o]=[t,i,n]:s.push([t,i,n]),s})},applyStickyOperations(e){let t=ue.private(e,"sticky");t&&t.forEach(([i,n,s])=>this.putSticky(e,i,n))},isLocked(e){return e.hasAttribute&&e.hasAttribute(I)}},u=ue,$e=class{static isActive(e,t){let i=t._phxRef===void 0,s=e.getAttribute(bt).split(",").indexOf(O.genFileRef(t))>=0;return t.size>0&&(i||s)}static isPreflighted(e,t){return e.getAttribute(Pt).split(",").indexOf(O.genFileRef(t))>=0&&this.isActive(e,t)}static isPreflightInProgress(e){return e._preflightInProgress===!0}static markPreflightInProgress(e){e._preflightInProgress=!0}constructor(e,t,i,n){this.ref=O.genFileRef(t),this.fileEl=e,this.file=t,this.view=i,this.meta=null,this._isCancelled=!1,this._isDone=!1,this._progress=0,this._lastProgressSent=-1,this._onDone=function(){},this._onElUpdated=this.onElUpdated.bind(this),this.fileEl.addEventListener(Ye,this._onElUpdated),this.autoUpload=n}metadata(){return this.meta}progress(e){this._progress=Math.floor(e),this._progress>this._lastProgressSent&&(this._progress>=100?(this._progress=100,this._lastProgressSent=100,this._isDone=!0,this.view.pushFileProgress(this.fileEl,this.ref,100,()=>{O.untrackFile(this.fileEl,this.file),this._onDone()})):(this._lastProgressSent=this._progress,this.view.pushFileProgress(this.fileEl,this.ref,this._progress)))}isCancelled(){return this._isCancelled}cancel(){this.file._preflightInProgress=!1,this._isCancelled=!0,this._isDone=!0,this._onDone()}isDone(){return this._isDone}error(e="failed"){this.fileEl.removeEventListener(Ye,this._onElUpdated),this.view.pushFileProgress(this.fileEl,this.ref,{error:e}),this.isAutoUpload()||O.clearFiles(this.fileEl)}isAutoUpload(){return this.autoUpload}onDone(e){this._onDone=()=>{this.fileEl.removeEventListener(Ye,this._onElUpdated),e()}}onElUpdated(){this.fileEl.getAttribute(bt).split(",").indexOf(this.ref)===-1&&(O.untrackFile(this.fileEl,this.file),this.cancel())}toPreflightPayload(){return{last_modified:this.file.lastModified,name:this.file.name,relative_path:this.file.webkitRelativePath,size:this.file.size,type:this.file.type,ref:this.ref,meta:typeof this.file.meta=="function"?this.file.meta():void 0}}uploader(e){if(this.meta.uploader){let t=e[this.meta.uploader]||x(`no uploader configured for ${this.meta.uploader}`);return{name:this.meta.uploader,callback:t}}else return{name:"channel",callback:yn}}zipPostFlight(e){this.meta=e.entries[this.ref],this.meta||x(`no preflight upload response returned with ref ${this.ref}`,{input:this.fileEl,response:e})}},bn=0,O=class St{static genFileRef(t){let i=t._phxRef;return i!==void 0?i:(t._phxRef=(bn++).toString(),t._phxRef)}static getEntryDataURL(t,i,n){let s=this.activeFiles(t).find(o=>this.genFileRef(o)===i);n(URL.createObjectURL(s))}static hasUploadsInProgress(t){let i=0;return u.findUploadInputs(t).forEach(n=>{n.getAttribute(Pt)!==n.getAttribute(Yi)&&i++}),i>0}static serializeUploads(t){let i=this.activeFiles(t),n={};return i.forEach(s=>{let o={path:t.name},r=t.getAttribute(se);n[r]=n[r]||[],o.ref=this.genFileRef(s),o.last_modified=s.lastModified,o.name=s.name||o.ref,o.relative_path=s.webkitRelativePath,o.type=s.type,o.size=s.size,typeof s.meta=="function"&&(o.meta=s.meta()),n[r].push(o)}),n}static clearFiles(t){t.value=null,t.removeAttribute(se),u.putPrivate(t,"files",[])}static untrackFile(t,i){u.putPrivate(t,"files",u.private(t,"files").filter(n=>!Object.is(n,i)))}static trackFiles(t,i,n){if(t.getAttribute("multiple")!==null){let s=i.filter(o=>!this.activeFiles(t).find(r=>Object.is(r,o)));u.updatePrivate(t,"files",[],o=>o.concat(s)),t.value=null}else n&&n.files.length>0&&(t.files=n.files),u.putPrivate(t,"files",i)}static activeFileInputs(t){let i=u.findUploadInputs(t);return Array.from(i).filter(n=>n.files&&this.activeFiles(n).length>0)}static activeFiles(t){return(u.private(t,"files")||[]).filter(i=>$e.isActive(t,i))}static inputsAwaitingPreflight(t){let i=u.findUploadInputs(t);return Array.from(i).filter(n=>this.filesAwaitingPreflight(n).length>0)}static filesAwaitingPreflight(t){return this.activeFiles(t).filter(i=>!$e.isPreflighted(t,i)&&!$e.isPreflightInProgress(i))}static markPreflightInProgress(t){t.forEach(i=>$e.markPreflightInProgress(i.file))}constructor(t,i,n){this.autoUpload=u.isAutoUpload(t),this.view=i,this.onComplete=n,this._entries=Array.from(St.filesAwaitingPreflight(t)||[]).map(s=>new $e(t,s,i,this.autoUpload)),St.markPreflightInProgress(this._entries),this.numEntriesInProgress=this._entries.length}isAutoUpload(){return this.autoUpload}entries(){return this._entries}initAdapterUpload(t,i,n){this._entries=this._entries.map(o=>(o.isCancelled()?(this.numEntriesInProgress--,this.numEntriesInProgress===0&&this.onComplete()):(o.zipPostFlight(t),o.onDone(()=>{this.numEntriesInProgress--,this.numEntriesInProgress===0&&this.onComplete()})),o));let s=this._entries.reduce((o,r)=>{if(!r.meta)return o;let{name:a,callback:l}=r.uploader(n.uploaders);return o[a]=o[a]||{callback:l,entries:[]},o[a].entries.push(r),o},{});for(let o in s){let{callback:r,entries:a}=s[o];r(a,i,t,n)}}},An={anyOf(e,t){return t.find(i=>e instanceof i)},isFocusable(e,t){return e instanceof HTMLAnchorElement&&e.rel!=="ignore"||e instanceof HTMLAreaElement&&e.href!==void 0||!e.disabled&&this.anyOf(e,[HTMLInputElement,HTMLSelectElement,HTMLTextAreaElement,HTMLButtonElement])||e instanceof HTMLIFrameElement||e.tabIndex>=0&&e.getAttribute("aria-hidden")!=="true"||!t&&e.getAttribute("tabindex")!==null&&e.getAttribute("aria-hidden")!=="true"},attemptFocus(e,t){if(this.isFocusable(e,t))try{e.focus()}catch(i){}return!!document.activeElement&&document.activeElement.isSameNode(e)},focusFirstInteractive(e){let t=e.firstElementChild;for(;t;){if(this.attemptFocus(t,!0)||this.focusFirstInteractive(t))return!0;t=t.nextElementSibling}},focusFirst(e){let t=e.firstElementChild;for(;t;){if(this.attemptFocus(t)||this.focusFirst(t))return!0;t=t.nextElementSibling}},focusLast(e){let t=e.lastElementChild;for(;t;){if(this.attemptFocus(t)||this.focusLast(t))return!0;t=t.previousElementSibling}}},B=An,yi={LiveFileUpload:{activeRefs(){return this.el.getAttribute(bt)},preflightedRefs(){return this.el.getAttribute(Pt)},mounted(){this.preflightedWas=this.preflightedRefs()},updated(){let e=this.preflightedRefs();this.preflightedWas!==e&&(this.preflightedWas=e,e===""&&this.__view().cancelSubmit(this.el.form)),this.activeRefs()===""&&(this.el.value=null),this.el.dispatchEvent(new CustomEvent(Ye))}},LiveImgPreview:{mounted(){this.ref=this.el.getAttribute("data-phx-entry-ref"),this.inputEl=document.getElementById(this.el.getAttribute(se)),O.getEntryDataURL(this.inputEl,this.ref,e=>{this.url=e,this.el.src=e})},destroyed(){URL.revokeObjectURL(this.url)}},FocusWrap:{mounted(){this.focusStart=this.el.firstElementChild,this.focusEnd=this.el.lastElementChild,this.focusStart.addEventListener("focus",e=>{if(!e.relatedTarget||!this.el.contains(e.relatedTarget)){let t=e.target.nextElementSibling;B.attemptFocus(t)||B.focusFirst(t)}else B.focusLast(this.el)}),this.focusEnd.addEventListener("focus",e=>{if(!e.relatedTarget||!this.el.contains(e.relatedTarget)){let t=e.target.previousElementSibling;B.attemptFocus(t)||B.focusLast(t)}else B.focusFirst(this.el)}),this.el.contains(document.activeElement)||(this.el.addEventListener("phx:show-end",()=>this.el.focus()),window.getComputedStyle(this.el).display!=="none"&&B.focusFirst(this.el))}}},vi=e=>["HTML","BODY"].indexOf(e.nodeName.toUpperCase())>=0?null:["scroll","auto"].indexOf(getComputedStyle(e).overflowY)>=0?e:vi(e.parentElement),Qt=e=>e?e.scrollTop:document.documentElement.scrollTop||document.body.scrollTop,xt=e=>e?e.getBoundingClientRect().bottom:window.innerHeight||document.documentElement.clientHeight,Lt=e=>e?e.getBoundingClientRect().top:0,wn=(e,t)=>{let i=e.getBoundingClientRect();return Math.ceil(i.top)>=Lt(t)&&Math.ceil(i.left)>=0&&Math.floor(i.top)<=xt(t)},Tn=(e,t)=>{let i=e.getBoundingClientRect();return Math.ceil(i.bottom)>=Lt(t)&&Math.ceil(i.left)>=0&&Math.floor(i.bottom)<=xt(t)},ei=(e,t)=>{let i=e.getBoundingClientRect();return Math.ceil(i.top)>=Lt(t)&&Math.ceil(i.left)>=0&&Math.floor(i.top)<=xt(t)};yi.InfiniteScroll={mounted(){this.scrollContainer=vi(this.el);let e=Qt(this.scrollContainer),t=!1,i=500,n=null,s=this.throttle(i,(a,l)=>{n=()=>!0,this.liveSocket.js().push(this.el,a,{value:{id:l.id,_overran:!0},callback:()=>{n=null}})}),o=this.throttle(i,(a,l)=>{n=()=>l.scrollIntoView({block:"start"}),this.liveSocket.js().push(this.el,a,{value:{id:l.id},callback:()=>{n=null,window.requestAnimationFrame(()=>{ei(l,this.scrollContainer)||l.scrollIntoView({block:"start"})})}})}),r=this.throttle(i,(a,l)=>{n=()=>l.scrollIntoView({block:"end"}),this.liveSocket.js().push(this.el,a,{value:{id:l.id},callback:()=>{n=null,window.requestAnimationFrame(()=>{ei(l,this.scrollContainer)||l.scrollIntoView({block:"end"})})}})});this.onScroll=a=>{let l=Qt(this.scrollContainer);if(n)return e=l,n();let c=this.el.getBoundingClientRect(),h=this.el.getAttribute(this.liveSocket.binding("viewport-top")),f=this.el.getAttribute(this.liveSocket.binding("viewport-bottom")),g=this.el.lastElementChild,m=this.el.firstElementChild,d=l<e,y=l>e;d&&h&&!t&&c.top>=0?(t=!0,s(h,m)):y&&t&&c.top<=0&&(t=!1),h&&d&&wn(m,this.scrollContainer)?o(h,m):f&&y&&Tn(g,this.scrollContainer)&&r(f,g),e=l},this.scrollContainer?this.scrollContainer.addEventListener("scroll",this.onScroll):window.addEventListener("scroll",this.onScroll)},destroyed(){this.scrollContainer?this.scrollContainer.removeEventListener("scroll",this.onScroll):window.removeEventListener("scroll",this.onScroll)},throttle(e,t){let i=0,n;return(...s)=>{let o=Date.now(),r=e-(o-i);r<=0||r>e?(n&&(clearTimeout(n),n=null),i=o,t(...s)):n||(n=setTimeout(()=>{i=Date.now(),n=null,t(...s)},r))}}};var Cn=yi,kt=class{static onUnlock(e,t){if(!u.isLocked(e)&&!e.closest(`[${I}]`))return t();let i=e.closest(`[${I}]`),n=i.closest(`[${I}]`).getAttribute(I);i.addEventListener(`phx:undo-lock:${n}`,()=>{t()},{once:!0})}constructor(e){this.el=e,this.loadingRef=e.hasAttribute(Ce)?parseInt(e.getAttribute(Ce),10):null,this.lockRef=e.hasAttribute(I)?parseInt(e.getAttribute(I),10):null}maybeUndo(e,t,i){if(!this.isWithin(e)){u.updatePrivate(this.el,Mt,[],n=>(n.push(e),n));return}this.undoLocks(e,t,i),this.undoLoading(e,t),u.updatePrivate(this.el,Mt,[],n=>n.filter(s=>{let o={detail:{ref:s,event:t},bubbles:!0,cancelable:!1};return this.loadingRef&&this.loadingRef>s&&this.el.dispatchEvent(new CustomEvent(`phx:undo-loading:${s}`,o)),this.lockRef&&this.lockRef>s&&this.el.dispatchEvent(new CustomEvent(`phx:undo-lock:${s}`,o)),s>e})),this.isFullyResolvedBy(e)&&this.el.removeAttribute(W)}isWithin(e){return!(this.loadingRef!==null&&this.loadingRef>e&&this.lockRef!==null&&this.lockRef>e)}undoLocks(e,t,i){if(!this.isLockUndoneBy(e))return;let n=u.private(this.el,I);n&&(i(n),u.deletePrivate(this.el,I)),this.el.removeAttribute(I);let s={detail:{ref:e,event:t},bubbles:!0,cancelable:!1};this.el.dispatchEvent(new CustomEvent(`phx:undo-lock:${this.lockRef}`,s))}undoLoading(e,t){if(!this.isLoadingUndoneBy(e)){this.canUndoLoading(e)&&this.el.classList.contains("phx-submit-loading")&&this.el.classList.remove("phx-change-loading");return}if(this.canUndoLoading(e)){this.el.removeAttribute(Ce);let i=this.el.getAttribute(Te),n=this.el.getAttribute(Ct);n!==null&&(this.el.readOnly=n==="true",this.el.removeAttribute(Ct)),i!==null&&(this.el.disabled=i==="true",this.el.removeAttribute(Te));let s=this.el.getAttribute(it);s!==null&&(this.el.innerText=s,this.el.removeAttribute(it));let o={detail:{ref:e,event:t},bubbles:!0,cancelable:!1};this.el.dispatchEvent(new CustomEvent(`phx:undo-loading:${this.loadingRef}`,o))}di.forEach(i=>{(i!=="phx-submit-loading"||this.canUndoLoading(e))&&u.removeClass(this.el,i)})}isLoadingUndoneBy(e){return this.loadingRef===null?!1:this.loadingRef<=e}isLockUndoneBy(e){return this.lockRef===null?!1:this.lockRef<=e}isFullyResolvedBy(e){return(this.loadingRef===null||this.loadingRef<=e)&&(this.lockRef===null||this.lockRef<=e)}canUndoLoading(e){return this.lockRef===null||this.lockRef<=e}},Sn=class{constructor(e,t,i){let n=new Set,s=new Set([...t.children].map(r=>r.id)),o=[];Array.from(e.children).forEach(r=>{if(r.id&&(n.add(r.id),s.has(r.id))){let a=r.previousElementSibling&&r.previousElementSibling.id;o.push({elementId:r.id,previousElementId:a})}}),this.containerId=t.id,this.updateType=i,this.elementsToModify=o,this.elementIdsToAdd=[...s].filter(r=>!n.has(r))}perform(){let e=u.byId(this.containerId);e&&(this.elementsToModify.forEach(t=>{t.previousElementId?me(document.getElementById(t.previousElementId),i=>{me(document.getElementById(t.elementId),n=>{n.previousElementSibling&&n.previousElementSibling.id==i.id||i.insertAdjacentElement("afterend",n)})}):me(document.getElementById(t.elementId),i=>{i.previousElementSibling==null||e.insertAdjacentElement("afterbegin",i)})}),this.updateType=="prepend"&&this.elementIdsToAdd.reverse().forEach(t=>{me(document.getElementById(t),i=>e.insertAdjacentElement("afterbegin",i))}))}},ti=11;function kn(e,t){var i=t.attributes,n,s,o,r,a;if(!(t.nodeType===ti||e.nodeType===ti)){for(var l=i.length-1;l>=0;l--)n=i[l],s=n.name,o=n.namespaceURI,r=n.value,o?(s=n.localName||s,a=e.getAttributeNS(o,s),a!==r&&(n.prefix==="xmlns"&&(s=n.name),e.setAttributeNS(o,s,r))):(a=e.getAttribute(s),a!==r&&e.setAttribute(s,r));for(var c=e.attributes,h=c.length-1;h>=0;h--)n=c[h],s=n.name,o=n.namespaceURI,o?(s=n.localName||s,t.hasAttributeNS(o,s)||e.removeAttributeNS(o,s)):t.hasAttribute(s)||e.removeAttribute(s)}}var We,En="http://www.w3.org/1999/xhtml",F=typeof document=="undefined"?void 0:document,Pn=!!F&&"content"in F.createElement("template"),zn=!!F&&F.createRange&&"createContextualFragment"in F.createRange();function xn(e){var t=F.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}function Ln(e){We||(We=F.createRange(),We.selectNode(F.body));var t=We.createContextualFragment(e);return t.childNodes[0]}function _n(e){var t=F.createElement("body");return t.innerHTML=e,t.childNodes[0]}function Rn(e){return e=e.trim(),Pn?xn(e):zn?Ln(e):_n(e)}function qe(e,t){var i=e.nodeName,n=t.nodeName,s,o;return i===n?!0:(s=i.charCodeAt(0),o=n.charCodeAt(0),s<=90&&o>=97?i===n.toUpperCase():o<=90&&s>=97?n===i.toUpperCase():!1)}function In(e,t){return!t||t===En?F.createElement(e):F.createElementNS(t,e)}function On(e,t){for(var i=e.firstChild;i;){var n=i.nextSibling;t.appendChild(i),i=n}return t}function yt(e,t,i){e[i]!==t[i]&&(e[i]=t[i],e[i]?e.setAttribute(i,""):e.removeAttribute(i))}var ii={OPTION:function(e,t){var i=e.parentNode;if(i){var n=i.nodeName.toUpperCase();n==="OPTGROUP"&&(i=i.parentNode,n=i&&i.nodeName.toUpperCase()),n==="SELECT"&&!i.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),i.selectedIndex=-1)}yt(e,t,"selected")},INPUT:function(e,t){yt(e,t,"checked"),yt(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var i=t.value;e.value!==i&&(e.value=i);var n=e.firstChild;if(n){var s=n.nodeValue;if(s==i||!i&&s==e.placeholder)return;n.nodeValue=i}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var i=-1,n=0,s=e.firstChild,o,r;s;)if(r=s.nodeName&&s.nodeName.toUpperCase(),r==="OPTGROUP")o=s,s=o.firstChild,s||(s=o.nextSibling,o=null);else{if(r==="OPTION"){if(s.hasAttribute("selected")){i=n;break}n++}s=s.nextSibling,!s&&o&&(s=o.nextSibling,o=null)}e.selectedIndex=i}}},De=1,ni=11,si=3,oi=8;function le(){}function $n(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function Dn(e){return function(i,n,s){if(s||(s={}),typeof n=="string")if(i.nodeName==="#document"||i.nodeName==="HTML"||i.nodeName==="BODY"){var o=n;n=F.createElement("html"),n.innerHTML=o}else n=Rn(n);else n.nodeType===ni&&(n=n.firstElementChild);var r=s.getNodeKey||$n,a=s.onBeforeNodeAdded||le,l=s.onNodeAdded||le,c=s.onBeforeElUpdated||le,h=s.onElUpdated||le,f=s.onBeforeNodeDiscarded||le,g=s.onNodeDiscarded||le,m=s.onBeforeElChildrenUpdated||le,d=s.skipFromChildren||le,y=s.addChild||function(w,T){return w.appendChild(T)},v=s.childrenOnly===!0,E=Object.create(null),L=[];function A(w){L.push(w)}function P(w,T){if(w.nodeType===De)for(var _=w.firstChild;_;){var S=void 0;T&&(S=r(_))?A(S):(g(_),_.firstChild&&P(_,T)),_=_.nextSibling}}function $(w,T,_){f(w)!==!1&&(T&&T.removeChild(w),g(w),P(w,_))}function D(w){if(w.nodeType===De||w.nodeType===ni)for(var T=w.firstChild;T;){var _=r(T);_&&(E[_]=T),D(T),T=T.nextSibling}}D(i);function p(w){l(w);for(var T=w.firstChild;T;){var _=T.nextSibling,S=r(T);if(S){var z=E[S];z&&qe(T,z)?(T.parentNode.replaceChild(z,T),M(z,T)):p(T)}else p(T);T=_}}function b(w,T,_){for(;T;){var S=T.nextSibling;(_=r(T))?A(_):$(T,w,!0),T=S}}function M(w,T,_){var S=r(T);if(S&&delete E[S],!_){var z=c(w,T);if(z===!1||(z instanceof HTMLElement&&(w=z,D(w)),e(w,T),h(w),m(w,T)===!1))return}w.nodeName!=="TEXTAREA"?q(w,T):ii.TEXTAREA(w,T)}function q(w,T){var _=d(w,T),S=T.firstChild,z=w.firstChild,ge,ee,ye,Ue,oe;e:for(;S;){for(Ue=S.nextSibling,ge=r(S);!_&&z;){if(ye=z.nextSibling,S.isSameNode&&S.isSameNode(z)){S=Ue,z=ye;continue e}ee=r(z);var He=z.nodeType,re=void 0;if(He===S.nodeType&&(He===De?(ge?ge!==ee&&((oe=E[ge])?ye===oe?re=!1:(w.insertBefore(oe,z),ee?A(ee):$(z,w,!0),z=oe,ee=r(z)):re=!1):ee&&(re=!1),re=re!==!1&&qe(z,S),re&&M(z,S)):(He===si||He==oi)&&(re=!0,z.nodeValue!==S.nodeValue&&(z.nodeValue=S.nodeValue))),re){S=Ue,z=ye;continue e}ee?A(ee):$(z,w,!0),z=ye}if(ge&&(oe=E[ge])&&qe(oe,S))_||y(w,oe),M(oe,S);else{var lt=a(S);lt!==!1&&(lt&&(S=lt),S.actualize&&(S=S.actualize(w.ownerDocument||F)),y(w,S),p(S))}S=Ue,z=ye}b(w,z,ee);var _t=ii[w.nodeName];_t&&_t(w,T)}var C=i,Q=C.nodeType,J=n.nodeType;if(!v){if(Q===De)J===De?qe(i,n)||(g(i),C=On(i,In(n.nodeName,n.namespaceURI))):C=n;else if(Q===si||Q===oi){if(J===Q)return C.nodeValue!==n.nodeValue&&(C.nodeValue=n.nodeValue),C;C=n}}if(C===n)g(i);else{if(n.isSameNode&&n.isSameNode(C))return;if(M(C,n,v),L)for(var rt=0,Pi=L.length;rt<Pi;rt++){var at=E[L[rt]];at&&$(at,at.parentNode,!1)}}return!v&&C!==i&&i.parentNode&&(C.actualize&&(C=C.actualize(i.ownerDocument||F)),i.parentNode.replaceChild(C,i)),C}}var Mn=Dn(kn),Et=Mn,Xe=class{constructor(e,t,i,n,s,o,r={}){this.view=e,this.liveSocket=e.liveSocket,this.container=t,this.id=i,this.rootID=e.root.id,this.html=n,this.streams=s,this.streamInserts={},this.streamComponentRestore={},this.targetCID=o,this.cidPatch=ie(this.targetCID),this.pendingRemoves=[],this.phxRemove=this.liveSocket.binding("remove"),this.targetContainer=this.isCIDPatch()?this.targetCIDContainer(n):t,this.callbacks={beforeadded:[],beforeupdated:[],beforephxChildAdded:[],afteradded:[],afterupdated:[],afterdiscarded:[],afterphxChildAdded:[],aftertransitionsDiscarded:[]},this.withChildren=r.withChildren||r.undoRef||!1,this.undoRef=r.undoRef}before(e,t){this.callbacks[`before${e}`].push(t)}after(e,t){this.callbacks[`after${e}`].push(t)}trackBefore(e,...t){this.callbacks[`before${e}`].forEach(i=>i(...t))}trackAfter(e,...t){this.callbacks[`after${e}`].forEach(i=>i(...t))}markPrunableContentForRemoval(){let e=this.liveSocket.binding(nt);u.all(this.container,`[${e}=append] > *, [${e}=prepend] > *`,t=>{t.setAttribute(Ut,"")})}perform(e){let{view:t,liveSocket:i,html:n,container:s}=this,o=this.targetContainer;if(this.isCIDPatch()&&!this.targetContainer)return;if(this.isCIDPatch()){let A=o.closest(`[${I}]`);if(A){let P=u.private(A,I);P&&(o=P.querySelector(`[data-phx-component="${this.targetCID}"]`))}}let r=i.getActiveElement(),{selectionStart:a,selectionEnd:l}=r&&u.hasSelectionRange(r)?r:{},c=i.binding(nt),h=i.binding(At),f=i.binding(wt),g=i.binding(Zi),m=[],d=[],y=[],v=[],E=null,L=(A,P,$=this.withChildren)=>{let D={childrenOnly:A.getAttribute(ne)===null&&!$,getNodeKey:p=>u.isPhxDestroyed(p)?null:e?p.id:p.id||p.getAttribute&&p.getAttribute(mi),skipFromChildren:p=>p.getAttribute(c)===Ze,addChild:(p,b)=>{let{ref:M,streamAt:q}=this.getStreamInsert(b);if(M===void 0)return p.appendChild(b);if(this.setStreamRef(b,M),q===0)p.insertAdjacentElement("afterbegin",b);else if(q===-1){let C=p.lastElementChild;if(C&&!C.hasAttribute(_e)){let Q=Array.from(p.children).find(J=>!J.hasAttribute(_e));p.insertBefore(b,Q)}else p.appendChild(b)}else if(q>0){let C=Array.from(p.children)[q];p.insertBefore(b,C)}},onBeforeNodeAdded:p=>{var M;if((M=this.getStreamInsert(p))!=null&&M.updateOnly&&!this.streamComponentRestore[p.id])return!1;u.maintainPrivateHooks(p,p,h,f),this.trackBefore("added",p);let b=p;return this.streamComponentRestore[p.id]&&(b=this.streamComponentRestore[p.id],delete this.streamComponentRestore[p.id],L(b,p,!0)),b},onNodeAdded:p=>{p.getAttribute&&this.maybeReOrderStream(p,!0),u.isPortalTemplate(p)&&v.push(()=>this.teleport(p,L)),p instanceof HTMLImageElement&&p.srcset?p.srcset=p.srcset:p instanceof HTMLVideoElement&&p.autoplay&&p.play(),u.isNowTriggerFormExternal(p,g)&&(E=p),(u.isPhxChild(p)&&t.ownsElement(p)||u.isPhxSticky(p)&&t.ownsElement(p.parentNode))&&this.trackAfter("phxChildAdded",p),p.nodeName==="SCRIPT"&&p.hasAttribute(Qe)&&this.handleRuntimeHook(p,P),m.push(p)},onNodeDiscarded:p=>this.onNodeDiscarded(p),onBeforeNodeDiscarded:p=>{if(p.getAttribute&&p.getAttribute(Ut)!==null)return!0;if(p.parentElement!==null&&p.id&&u.isPhxUpdate(p.parentElement,c,[Ze,"append","prepend"])||p.getAttribute&&p.getAttribute(Se)||this.maybePendingRemove(p)||this.skipCIDSibling(p))return!1;if(u.isPortalTemplate(p)){let b=document.getElementById(p.content.firstElementChild.id);b&&(b.remove(),D.onNodeDiscarded(b),this.view.dropPortalElementId(b.id))}return!0},onElUpdated:p=>{u.isNowTriggerFormExternal(p,g)&&(E=p),d.push(p),this.maybeReOrderStream(p,!1)},onBeforeElUpdated:(p,b)=>{if(p.id&&p.isSameNode(A)&&p.id!==b.id)return D.onNodeDiscarded(p),p.replaceWith(b),D.onNodeAdded(b);if(u.syncPendingAttrs(p,b),u.maintainPrivateHooks(p,b,h,f),u.cleanChildNodes(b,c),this.skipCIDSibling(b))return this.maybeReOrderStream(p),!1;if(u.isPhxSticky(p))return[Z,fe,ce].map(C=>[C,p.getAttribute(C),b.getAttribute(C)]).forEach(([C,Q,J])=>{J&&Q!==J&&p.setAttribute(C,J)}),!1;if(u.isIgnored(p,c)||p.form&&p.form.isSameNode(E))return this.trackBefore("updated",p,b),u.mergeAttrs(p,b,{isIgnored:u.isIgnored(p,c)}),d.push(p),u.applyStickyOperations(p),!1;if(p.type==="number"&&p.validity&&p.validity.badInput)return!1;let M=r&&p.isSameNode(r)&&u.isFormInput(p),q=M&&this.isChangedSelect(p,b);if(p.hasAttribute(W)){let C=new kt(p);if(C.lockRef&&(!this.undoRef||!C.isLockUndoneBy(this.undoRef))){u.isUploadInput(p)&&(u.mergeAttrs(p,b,{isIgnored:!0}),this.trackBefore("updated",p,b),d.push(p)),u.applyStickyOperations(p);let J=p.hasAttribute(I)?u.private(p,I)||p.cloneNode(!0):null;J&&(u.putPrivate(p,I,J),M||(p=J))}}if(u.isPhxChild(b)){let C=p.getAttribute(Z);return u.mergeAttrs(p,b,{exclude:[fe]}),C!==""&&p.setAttribute(Z,C),p.setAttribute(ce,this.rootID),u.applyStickyOperations(p),!1}return this.undoRef&&u.private(b,I)&&u.putPrivate(p,I,u.private(b,I)),u.copyPrivates(b,p),u.isPortalTemplate(b)?(v.push(()=>this.teleport(b,L)),!1):M&&p.type!=="hidden"&&!q?(this.trackBefore("updated",p,b),u.mergeFocusedInput(p,b),u.syncAttrsToProps(p),d.push(p),u.applyStickyOperations(p),!1):(q&&p.blur(),u.isPhxUpdate(b,c,["append","prepend"])&&y.push(new Sn(p,b,b.getAttribute(c))),u.syncAttrsToProps(b),u.applyStickyOperations(b),this.trackBefore("updated",p,b),p)}};Et(A,P,D)};if(this.trackBefore("added",s),this.trackBefore("updated",s,s),i.time("morphdom",()=>{this.streams.forEach(([A,P,$,D])=>{P.forEach(([p,b,M,q])=>{this.streamInserts[p]={ref:A,streamAt:b,limit:M,reset:D,updateOnly:q}}),D!==void 0&&u.all(s,`[${_e}="${A}"]`,p=>{this.removeStreamChildElement(p)}),$.forEach(p=>{let b=s.querySelector(`[id="${p}"]`);b&&this.removeStreamChildElement(b)})}),e&&u.all(this.container,`[${c}=${Ze}]`).filter(A=>this.view.ownsElement(A)).forEach(A=>{Array.from(A.children).forEach(P=>{this.removeStreamChildElement(P,!0)})}),L(o,n),v.forEach(A=>A()),this.view.portalElementIds.forEach(A=>{let P=document.getElementById(A);P&&(document.getElementById(P.getAttribute(ft))||(P.remove(),this.onNodeDiscarded(P),this.view.dropPortalElementId(A)))})}),i.isDebugEnabled()&&(fn(),mn(this.streamInserts),Array.from(document.querySelectorAll("input[name=id]")).forEach(A=>{A instanceof HTMLInputElement&&A.form&&console.error(`Detected an input with name="id" inside a form! This will cause problems when patching the DOM.
`,A)})),y.length>0&&i.time("post-morph append/prepend restoration",()=>{y.forEach(A=>A.perform())}),i.silenceEvents(()=>u.restoreFocus(r,a,l)),u.dispatchEvent(document,"phx:update"),m.forEach(A=>this.trackAfter("added",A)),d.forEach(A=>this.trackAfter("updated",A)),this.transitionPendingRemoves(),E){i.unload();let A=u.private(E,"submitter");if(A&&A.name&&o.contains(A)){let P=document.createElement("input");P.type="hidden";let $=A.getAttribute("form");$&&P.setAttribute("form",$),P.name=A.name,P.value=A.value,A.parentElement.insertBefore(P,A)}Object.getPrototypeOf(E).submit.call(E)}return!0}onNodeDiscarded(e){(u.isPhxChild(e)||u.isPhxSticky(e))&&this.liveSocket.destroyViewByEl(e),this.trackAfter("discarded",e)}maybePendingRemove(e){return e.getAttribute&&e.getAttribute(this.phxRemove)!==null?(this.pendingRemoves.push(e),!0):!1}removeStreamChildElement(e,t=!1){!t&&!this.view.ownsElement(e)||(this.streamInserts[e.id]?(this.streamComponentRestore[e.id]=e,e.remove()):this.maybePendingRemove(e)||(e.remove(),this.onNodeDiscarded(e)))}getStreamInsert(e){return(e.id?this.streamInserts[e.id]:{})||{}}setStreamRef(e,t){u.putSticky(e,_e,i=>i.setAttribute(_e,t))}maybeReOrderStream(e,t){let{ref:i,streamAt:n,reset:s}=this.getStreamInsert(e);if(n!==void 0&&(this.setStreamRef(e,i),!(!s&&!t)&&e.parentElement)){if(n===0)e.parentElement.insertBefore(e,e.parentElement.firstElementChild);else if(n>0){let o=Array.from(e.parentElement.children),r=o.indexOf(e);if(n>=o.length-1)e.parentElement.appendChild(e);else{let a=o[n];r>n?e.parentElement.insertBefore(e,a):e.parentElement.insertBefore(e,a.nextElementSibling)}}this.maybeLimitStream(e)}}maybeLimitStream(e){let{limit:t}=this.getStreamInsert(e),i=t!==null&&Array.from(e.parentElement.children);t&&t<0&&i.length>t*-1?i.slice(0,i.length+t).forEach(n=>this.removeStreamChildElement(n)):t&&t>=0&&i.length>t&&i.slice(t).forEach(n=>this.removeStreamChildElement(n))}transitionPendingRemoves(){let{pendingRemoves:e,liveSocket:t}=this;e.length>0&&t.transitionRemoves(e,()=>{e.forEach(i=>{let n=u.firstPhxChild(i);n&&t.destroyViewByEl(n),i.remove()}),this.trackAfter("transitionsDiscarded",e)})}isChangedSelect(e,t){return!(e instanceof HTMLSelectElement)||e.multiple?!1:e.options.length!==t.options.length?!0:(t.value=e.value,!e.isEqualNode(t))}isCIDPatch(){return this.cidPatch}skipCIDSibling(e){return e.nodeType===Node.ELEMENT_NODE&&e.hasAttribute(fi)}targetCIDContainer(e){if(!this.isCIDPatch())return;let[t,...i]=u.findComponentNodeList(this.view.id,this.targetCID);return i.length===0&&u.childNodeLength(e)===1?t:t&&t.parentNode}indexOf(e,t){return Array.from(e.children).indexOf(t)}teleport(e,t){let i=e.getAttribute(gi),n=document.querySelector(i);if(!n)throw new Error("portal target with selector "+i+" not found");let s=e.content.firstElementChild;if(this.skipCIDSibling(s))return;if(!(s!=null&&s.id))throw new Error("phx-portal template must have a single root element with ID!");let o=document.getElementById(s.id),r;o?(n.contains(o)||n.appendChild(o),r=o):(r=document.createElement(s.tagName),n.appendChild(r)),s.setAttribute(Se,this.view.id),s.setAttribute(ft,e.id),t(r,s,!0),s.removeAttribute(Se),s.removeAttribute(ft),this.view.pushPortalElementId(s.id)}handleRuntimeHook(e,t){let i=e.getAttribute(Qe),n=e.hasAttribute("nonce")?e.getAttribute("nonce"):null;if(e.hasAttribute("nonce")){let o=document.createElement("template");o.innerHTML=t,n=o.content.querySelector(`script[${Qe}="${CSS.escape(i)}"]`).getAttribute("nonce")}let s=document.createElement("script");s.textContent=e.textContent,u.mergeAttrs(s,e,{isIgnored:!1}),n&&(s.nonce=n),e.replaceWith(s),e=s}},Nn=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]),Un=new Set(["'",'"']),ri=(e,t,i)=>{let n=0,s=!1,o,r,a,l,c,h,f=e.match(/^(\s*(?:<!--.*?-->\s*)*)<([^\s\/>]+)/);if(f===null)throw new Error(`malformed html ${e}`);for(n=f[0].length,o=f[1],a=f[2],l=n,n;n<e.length&&e.charAt(n)!==">";n++)if(e.charAt(n)==="="){let d=e.slice(n-3,n)===" id";n++;let y=e.charAt(n);if(Un.has(y)){let v=n;for(n++,n;n<e.length&&e.charAt(n)!==y;n++);if(d){c=e.slice(v+1,n);break}}}let g=e.length-1;for(s=!1;g>=o.length+a.length;){let d=e.charAt(g);if(s)d==="-"&&e.slice(g-3,g)==="<!-"?(s=!1,g-=4):g-=1;else if(d===">"&&e.slice(g-2,g)==="--")s=!0,g-=3;else{if(d===">")break;g-=1}}r=e.slice(g+1,e.length);let m=Object.keys(t).map(d=>t[d]===!0?d:`${d}="${t[d]}"`).join(" ");if(i){let d=c?` id="${c}"`:"";Nn.has(a)?h=`<${a}${d}${m===""?"":" "}${m}/>`:h=`<${a}${d}${m===""?"":" "}${m}></${a}>`}else{let d=e.slice(l,g+1);h=`<${a}${m===""?"":" "}${m}${d}`}return[h,o,r]},ai=class{static extract(e){let{[Gt]:t,[Kt]:i,[Yt]:n}=e;return delete e[Gt],delete e[Kt],delete e[Yt],{diff:e,title:n,reply:t||null,events:i||[]}}constructor(e,t){this.viewId=e,this.rendered={},this.magicId=0,this.mergeDiff(t)}parentViewId(){return this.viewId}toString(e){let{buffer:t,streams:i}=this.recursiveToString(this.rendered,this.rendered[U],e,!0,{});return{buffer:t,streams:i}}recursiveToString(e,t=e[U],i,n,s){i=i?new Set(i):null;let o={buffer:"",components:t,onlyCids:i,streams:new Set};return this.toOutputBuffer(e,null,o,n,s),{buffer:o.buffer,streams:o.streams}}componentCIDs(e){return Object.keys(e[U]||{}).map(t=>parseInt(t))}isComponentOnlyDiff(e){return e[U]?Object.keys(e).length===1:!1}getComponent(e,t){return e[U][t]}resetRender(e){this.rendered[U][e]&&(this.rendered[U][e].reset=!0)}mergeDiff(e){let t=e[U],i={};if(delete e[U],this.rendered=this.mutableMerge(this.rendered,e),this.rendered[U]=this.rendered[U]||{},t){let n=this.rendered[U];for(let s in t)t[s]=this.cachedFindComponent(s,t[s],n,t,i);for(let s in t)n[s]=t[s];e[U]=t}}cachedFindComponent(e,t,i,n,s){if(s[e])return s[e];{let o,r,a=t[V];if(ie(a)){let l;a>0?l=this.cachedFindComponent(a,n[a],i,n,s):l=i[-a],r=l[V],o=this.cloneMerge(l,t,!0),o[V]=r}else o=t[V]!==void 0||i[e]===void 0?t:this.cloneMerge(i[e],t,!1);return s[e]=o,o}}mutableMerge(e,t){return t[V]!==void 0?t:(this.doMutableMerge(e,t),e)}doMutableMerge(e,t){if(t[R])this.mergeKeyed(e,t);else for(let i in t){let n=t[i],s=e[i];Ae(n)&&n[V]===void 0&&Ae(s)?this.doMutableMerge(s,n):e[i]=n}e[gt]&&(e.newRender=!0)}clone(e){return"structuredClone"in window?structuredClone(e):JSON.parse(JSON.stringify(e))}mergeKeyed(e,t){let i=this.clone(e);if(Object.entries(t[R]).forEach(([n,s])=>{if(n!==Y)if(Array.isArray(s)){let[o,r]=s;e[R][n]=i[R][o],this.doMutableMerge(e[R][n],r)}else if(typeof s=="number"){let o=s;e[R][n]=i[R][o]}else typeof s=="object"&&(e[R][n]||(e[R][n]={}),this.doMutableMerge(e[R][n],s))}),t[R][Y]<e[R][Y])for(let n=t[R][Y];n<e[R][Y];n++)delete e[R][n];e[R][Y]=t[R][Y],t[be]&&(e[be]=t[be]),t[ae]&&(e[ae]=t[ae])}cloneMerge(e,t,i){let n=N(N({},e),t);for(let s in n){let o=t[s],r=e[s];Ae(o)&&o[V]===void 0&&Ae(r)?n[s]=this.cloneMerge(r,o,i):o===void 0&&Ae(r)&&(n[s]=this.cloneMerge(r,{},i))}return i?(delete n.magicId,delete n.newRender):e[gt]&&(n.newRender=!0),n}componentToString(e){let{buffer:t,streams:i}=this.recursiveCIDToString(this.rendered[U],e,null),[n,s,o]=ri(t,{});return{buffer:n,streams:i}}pruneCIDs(e){e.forEach(t=>delete this.rendered[U][t])}get(){return this.rendered}isNewFingerprint(e={}){return!!e[V]}templateStatic(e,t){return typeof e=="number"?t[e]:e}nextMagicID(){return this.magicId++,`m${this.magicId}-${this.parentViewId()}`}toOutputBuffer(e,t,i,n,s={}){if(e[R])return this.comprehensionToBuffer(e,t,i,n);e[ae]&&(t=e[ae],delete e[ae]);let{[V]:o}=e;o=this.templateStatic(o,t),e[V]=o;let r=e[gt],a=i.buffer;r&&(i.buffer=""),n&&r&&!e.magicId&&(e.newRender=!0,e.magicId=this.nextMagicID()),i.buffer+=o[0];for(let l=1;l<o.length;l++)this.dynamicToBuffer(e[l-1],t,i,n),i.buffer+=o[l];if(r){let l=!1,c;n||e.magicId?(l=n&&!e.newRender,c=N({[mi]:e.magicId},s)):c=s,l&&(c[fi]=!0);let[h,f,g]=ri(i.buffer,c,l);e.newRender=!1,i.buffer=a+f+h+g}}comprehensionToBuffer(e,t,i,n){let s=t||e[ae],o=this.templateStatic(e[V],t);e[V]=o,delete e[ae];for(let r=0;r<e[R][Y];r++){i.buffer+=o[0];for(let a=1;a<o.length;a++)this.dynamicToBuffer(e[R][r][a-1],s,i,n),i.buffer+=o[a]}if(e[be]){let r=e[be],[a,l,c,h]=r||[null,{},[],null];r!==void 0&&(e[R][Y]>0||c.length>0||h)&&(delete e[be],e[R]={[Y]:0},i.streams.add(r))}}dynamicToBuffer(e,t,i,n){if(typeof e=="number"){let{buffer:s,streams:o}=this.recursiveCIDToString(i.components,e,i.onlyCids);i.buffer+=s,i.streams=new Set([...i.streams,...o])}else Ae(e)?this.toOutputBuffer(e,t,i,n,{}):i.buffer+=e}recursiveCIDToString(e,t,i){let n=e[t]||x(`no component for CID ${t}`,e),s={[ne]:t,[Ge]:this.viewId},o=i&&!i.has(t);n.newRender=!o,n.magicId=`c${t}-${this.parentViewId()}`;let r=!n.reset,{buffer:a,streams:l}=this.recursiveToString(n,e,i,r,s);return delete n.reset,{buffer:a,streams:l}}},li=[],ci=200,Hn={exec(e,t,i,n,s,o){let[r,a]=o||[null,{callback:o&&o.callback}];(i.charAt(0)==="["?JSON.parse(i):[[r,a]]).forEach(([c,h])=>{c===r&&(h=N(N({},a),h),h.callback=h.callback||a.callback),this.filterToEls(n.liveSocket,s,h).forEach(f=>{this[`exec_${c}`](e,t,i,n,s,f,h)})})},isVisible(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length>0)},isInViewport(e){let t=e.getBoundingClientRect(),i=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth;return t.right>0&&t.bottom>0&&t.left<n&&t.top<i},exec_exec(e,t,i,n,s,o,{attr:r,to:a}){let l=o.getAttribute(r);if(!l)throw new Error(`expected ${r} to contain JS command on "${a}"`);n.liveSocket.execJS(o,l,t)},exec_dispatch(e,t,i,n,s,o,{event:r,detail:a,bubbles:l,blocking:c}){if(a=a||{},a.dispatcher=s,c){let h=new Promise((f,g)=>{a.done=f});n.liveSocket.asyncTransition(h)}u.dispatchEvent(o,r,{detail:a,bubbles:l})},exec_push(e,t,i,n,s,o,r){let{event:a,data:l,target:c,page_loading:h,loading:f,value:g,dispatcher:m,callback:d}=r,y={loading:f,value:g,target:c,page_loading:!!h,originalEvent:e},v=t==="change"&&m?m:s,E=c||v.getAttribute(n.binding("target"))||v,L=(A,P)=>{if(A.isConnected())if(t==="change"){let{newCid:$,_target:D}=r;D=D||(u.isFormInput(s)?s.name:void 0),D&&(y._target=D),A.pushInput(s,P,$,a||i,y,d)}else if(t==="submit"){let{submitter:$}=r;A.submitForm(s,P,a||i,$,y,d)}else A.pushEvent(t,s,P,a||i,l,y,d)};r.targetView&&r.targetCtx?L(r.targetView,r.targetCtx):n.withinTargets(E,L)},exec_navigate(e,t,i,n,s,o,{href:r,replace:a}){n.liveSocket.historyRedirect(e,r,a?"replace":"push",null,s)},exec_patch(e,t,i,n,s,o,{href:r,replace:a}){n.liveSocket.pushHistoryPatch(e,r,a?"replace":"push",s)},exec_focus(e,t,i,n,s,o){B.attemptFocus(o),window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>B.attemptFocus(o))})},exec_focus_first(e,t,i,n,s,o){B.focusFirstInteractive(o)||B.focusFirst(o),window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>B.focusFirstInteractive(o)||B.focusFirst(o))})},exec_push_focus(e,t,i,n,s,o){li.push(o||s)},exec_pop_focus(e,t,i,n,s,o){let r=li.pop();r&&(r.focus(),window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>r.focus())}))},exec_add_class(e,t,i,n,s,o,{names:r,transition:a,time:l,blocking:c}){this.addOrRemoveClasses(o,r,[],a,l,n,c)},exec_remove_class(e,t,i,n,s,o,{names:r,transition:a,time:l,blocking:c}){this.addOrRemoveClasses(o,[],r,a,l,n,c)},exec_toggle_class(e,t,i,n,s,o,{names:r,transition:a,time:l,blocking:c}){this.toggleClasses(o,r,a,l,n,c)},exec_toggle_attr(e,t,i,n,s,o,{attr:[r,a,l]}){this.toggleAttr(o,r,a,l)},exec_ignore_attrs(e,t,i,n,s,o,{attrs:r}){this.ignoreAttrs(o,r)},exec_transition(e,t,i,n,s,o,{time:r,transition:a,blocking:l}){this.addOrRemoveClasses(o,[],[],a,r,n,l)},exec_toggle(e,t,i,n,s,o,{display:r,ins:a,outs:l,time:c,blocking:h}){this.toggle(t,n,o,r,a,l,c,h)},exec_show(e,t,i,n,s,o,{display:r,transition:a,time:l,blocking:c}){this.show(t,n,o,r,a,l,c)},exec_hide(e,t,i,n,s,o,{display:r,transition:a,time:l,blocking:c}){this.hide(t,n,o,r,a,l,c)},exec_set_attr(e,t,i,n,s,o,{attr:[r,a]}){this.setOrRemoveAttrs(o,[[r,a]],[])},exec_remove_attr(e,t,i,n,s,o,{attr:r}){this.setOrRemoveAttrs(o,[],[r])},ignoreAttrs(e,t){u.putPrivate(e,"JS:ignore_attrs",{apply:(i,n)=>{Array.from(i.attributes).forEach(s=>{t.some(o=>s.name==o||o.includes("*")&&s.name.match(o)!=null)&&n.setAttribute(s.name,s.value)})}})},onBeforeElUpdated(e,t){let i=u.private(e,"JS:ignore_attrs");i&&i.apply(e,t)},show(e,t,i,n,s,o,r){this.isVisible(i)||this.toggle(e,t,i,n,s,null,o,r)},hide(e,t,i,n,s,o,r){this.isVisible(i)&&this.toggle(e,t,i,n,null,s,o,r)},toggle(e,t,i,n,s,o,r,a){r=r||ci;let[l,c,h]=s||[[],[],[]],[f,g,m]=o||[[],[],[]];if(l.length>0||f.length>0)if(this.isVisible(i)){let d=()=>{this.addOrRemoveClasses(i,g,l.concat(c).concat(h)),window.requestAnimationFrame(()=>{this.addOrRemoveClasses(i,f,[]),window.requestAnimationFrame(()=>this.addOrRemoveClasses(i,m,g))})},y=()=>{this.addOrRemoveClasses(i,[],f.concat(m)),u.putSticky(i,"toggle",v=>v.style.display="none"),i.dispatchEvent(new Event("phx:hide-end"))};i.dispatchEvent(new Event("phx:hide-start")),a===!1?(d(),setTimeout(y,r)):t.transition(r,d,y)}else{if(e==="remove")return;let d=()=>{this.addOrRemoveClasses(i,c,f.concat(g).concat(m));let v=n||this.defaultDisplay(i);window.requestAnimationFrame(()=>{this.addOrRemoveClasses(i,l,[]),window.requestAnimationFrame(()=>{u.putSticky(i,"toggle",E=>E.style.display=v),this.addOrRemoveClasses(i,h,c)})})},y=()=>{this.addOrRemoveClasses(i,[],l.concat(h)),i.dispatchEvent(new Event("phx:show-end"))};i.dispatchEvent(new Event("phx:show-start")),a===!1?(d(),setTimeout(y,r)):t.transition(r,d,y)}else this.isVisible(i)?window.requestAnimationFrame(()=>{i.dispatchEvent(new Event("phx:hide-start")),u.putSticky(i,"toggle",d=>d.style.display="none"),i.dispatchEvent(new Event("phx:hide-end"))}):window.requestAnimationFrame(()=>{i.dispatchEvent(new Event("phx:show-start"));let d=n||this.defaultDisplay(i);u.putSticky(i,"toggle",y=>y.style.display=d),i.dispatchEvent(new Event("phx:show-end"))})},toggleClasses(e,t,i,n,s,o){window.requestAnimationFrame(()=>{let[r,a]=u.getSticky(e,"classes",[[],[]]),l=t.filter(h=>r.indexOf(h)<0&&!e.classList.contains(h)),c=t.filter(h=>a.indexOf(h)<0&&e.classList.contains(h));this.addOrRemoveClasses(e,l,c,i,n,s,o)})},toggleAttr(e,t,i,n){e.hasAttribute(t)?n!==void 0?e.getAttribute(t)===i?this.setOrRemoveAttrs(e,[[t,n]],[]):this.setOrRemoveAttrs(e,[[t,i]],[]):this.setOrRemoveAttrs(e,[],[t]):this.setOrRemoveAttrs(e,[[t,i]],[])},addOrRemoveClasses(e,t,i,n,s,o,r){s=s||ci;let[a,l,c]=n||[[],[],[]];if(a.length>0){let h=()=>{this.addOrRemoveClasses(e,l,[].concat(a).concat(c)),window.requestAnimationFrame(()=>{this.addOrRemoveClasses(e,a,[]),window.requestAnimationFrame(()=>this.addOrRemoveClasses(e,c,l))})},f=()=>this.addOrRemoveClasses(e,t.concat(c),i.concat(a).concat(l));r===!1?(h(),setTimeout(f,s)):o.transition(s,h,f);return}window.requestAnimationFrame(()=>{let[h,f]=u.getSticky(e,"classes",[[],[]]),g=t.filter(v=>h.indexOf(v)<0&&!e.classList.contains(v)),m=i.filter(v=>f.indexOf(v)<0&&e.classList.contains(v)),d=h.filter(v=>i.indexOf(v)<0).concat(g),y=f.filter(v=>t.indexOf(v)<0).concat(m);u.putSticky(e,"classes",v=>(v.classList.remove(...y),v.classList.add(...d),[d,y]))})},setOrRemoveAttrs(e,t,i){let[n,s]=u.getSticky(e,"attrs",[[],[]]),o=t.map(([l,c])=>l).concat(i),r=n.filter(([l,c])=>!o.includes(l)).concat(t),a=s.filter(l=>!o.includes(l)).concat(i);u.putSticky(e,"attrs",l=>(a.forEach(c=>l.removeAttribute(c)),r.forEach(([c,h])=>l.setAttribute(c,h)),[r,a]))},hasAllClasses(e,t){return t.every(i=>e.classList.contains(i))},isToggledOut(e,t){return!this.isVisible(e)||this.hasAllClasses(e,t)},filterToEls(e,t,{to:i}){let n=()=>{if(typeof i=="string")return document.querySelectorAll(i);if(i.closest){let s=t.closest(i.closest);return s?[s]:[]}else if(i.inner)return t.querySelectorAll(i.inner)};return i?e.jsQuerySelectorAll(t,i,n):[t]},defaultDisplay(e){return{tr:"table-row",td:"table-cell"}[e.tagName.toLowerCase()]||"block"},transitionClasses(e){if(!e)return null;let[t,i,n]=Array.isArray(e)?e:[e.split(" "),[],[]];return t=Array.isArray(t)?t:t.split(" "),i=Array.isArray(i)?i:i.split(" "),n=Array.isArray(n)?n:n.split(" "),[t,i,n]}},k=Hn,bi=(e,t)=>({exec(i,n){e.execJS(i,n,t)},show(i,n={}){let s=e.owner(i);k.show(t,s,i,n.display,k.transitionClasses(n.transition),n.time,n.blocking)},hide(i,n={}){let s=e.owner(i);k.hide(t,s,i,null,k.transitionClasses(n.transition),n.time,n.blocking)},toggle(i,n={}){let s=e.owner(i),o=k.transitionClasses(n.in),r=k.transitionClasses(n.out);k.toggle(t,s,i,n.display,o,r,n.time,n.blocking)},addClass(i,n,s={}){let o=Array.isArray(n)?n:n.split(" "),r=e.owner(i);k.addOrRemoveClasses(i,o,[],k.transitionClasses(s.transition),s.time,r,s.blocking)},removeClass(i,n,s={}){let o=Array.isArray(n)?n:n.split(" "),r=e.owner(i);k.addOrRemoveClasses(i,[],o,k.transitionClasses(s.transition),s.time,r,s.blocking)},toggleClass(i,n,s={}){let o=Array.isArray(n)?n:n.split(" "),r=e.owner(i);k.toggleClasses(i,o,k.transitionClasses(s.transition),s.time,r,s.blocking)},transition(i,n,s={}){let o=e.owner(i);k.addOrRemoveClasses(i,[],[],k.transitionClasses(n),s.time,o,s.blocking)},setAttribute(i,n,s){k.setOrRemoveAttrs(i,[[n,s]],[])},removeAttribute(i,n){k.setOrRemoveAttrs(i,[],[n])},toggleAttribute(i,n,s,o){k.toggleAttr(i,n,s,o)},push(i,n,s={}){e.withinOwners(i,o=>{let r=s.value||{};delete s.value;let a=new CustomEvent("phx:exec",{detail:{sourceElement:i}});k.exec(a,t,n,o,i,["push",N({data:r},s)])})},navigate(i,n={}){let s=new CustomEvent("phx:exec");e.historyRedirect(s,i,n.replace?"replace":"push",null,null)},patch(i,n={}){let s=new CustomEvent("phx:exec");e.pushHistoryPatch(s,i,n.replace?"replace":"push",null)},ignoreAttributes(i,n){k.ignoreAttrs(i,Array.isArray(n)?n:[n])}}),vt="hookId",Fn=1,we=class Ai{static makeID(){return Fn++}static elementID(t){return u.private(t,vt)}constructor(t,i,n){if(this.el=i,this.__attachView(t),this.__listeners=new Set,this.__isDisconnected=!1,u.putPrivate(this.el,vt,Ai.makeID()),n){let s=new Set(["el","liveSocket","__view","__listeners","__isDisconnected","constructor","js","pushEvent","pushEventTo","handleEvent","removeHandleEvent","upload","uploadTo","__mounted","__updated","__beforeUpdate","__destroyed","__reconnected","__disconnected","__cleanup__"]);for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(this[r]=n[r],s.has(r)&&console.warn(`Hook object for element #${i.id} overwrites core property '${r}'!`));["mounted","beforeUpdate","updated","destroyed","disconnected","reconnected"].forEach(r=>{n[r]&&typeof n[r]=="function"&&(this[r]=n[r])})}}__attachView(t){t?(this.__view=()=>t,this.liveSocket=t.liveSocket):(this.__view=()=>{throw new Error(`hook not yet attached to a live view: ${this.el.outerHTML}`)},this.liveSocket=null)}mounted(){}beforeUpdate(){}updated(){}destroyed(){}disconnected(){}reconnected(){}__mounted(){this.mounted()}__updated(){this.updated()}__beforeUpdate(){this.beforeUpdate()}__destroyed(){this.destroyed(),u.deletePrivate(this.el,vt)}__reconnected(){this.__isDisconnected&&(this.__isDisconnected=!1,this.reconnected())}__disconnected(){this.__isDisconnected=!0,this.disconnected()}js(){return he(N({},bi(this.__view().liveSocket,"hook")),{exec:t=>{this.__view().liveSocket.execJS(this.el,t,"hook")}})}pushEvent(t,i,n){let s=this.__view().pushHookEvent(this.el,null,t,i||{});if(n===void 0)return s.then(({reply:o})=>o);s.then(({reply:o,ref:r})=>n(o,r)).catch(()=>{})}pushEventTo(t,i,n,s){if(s===void 0){let o=[];this.__view().withinTargets(t,(a,l)=>{o.push({view:a,targetCtx:l})});let r=o.map(({view:a,targetCtx:l})=>a.pushHookEvent(this.el,l,i,n||{}));return Promise.allSettled(r)}this.__view().withinTargets(t,(o,r)=>{o.pushHookEvent(this.el,r,i,n||{}).then(({reply:a,ref:l})=>s(a,l)).catch(()=>{})})}handleEvent(t,i){let n={event:t,callback:s=>i(s.detail)};return window.addEventListener(`phx:${t}`,n.callback),this.__listeners.add(n),n}removeHandleEvent(t){window.removeEventListener(`phx:${t.event}`,t.callback),this.__listeners.delete(t)}upload(t,i){return this.__view().dispatchUploads(null,t,i)}uploadTo(t,i,n){return this.__view().withinTargets(t,(s,o)=>{s.dispatchUploads(o,i,n)})}__cleanup__(){this.__listeners.forEach(t=>this.removeHandleEvent(t))}},jn=(e,t)=>{let i=e.endsWith("[]"),n=i?e.slice(0,-2):e;return n=n.replace(/([^\[\]]+)(\]?$)/,`${t}$1$2`),i&&(n+="[]"),n},Ke=(e,t,i=[])=>{let{submitter:n}=t,s;if(n&&n.name){let h=document.createElement("input");h.type="hidden";let f=n.getAttribute("form");f&&h.setAttribute("form",f),h.name=n.name,h.value=n.value,n.parentElement.insertBefore(h,n),s=h}let o=new FormData(e),r=[];o.forEach((h,f,g)=>{h instanceof File&&r.push(f)}),r.forEach(h=>o.delete(h));let a=new URLSearchParams,{inputsUnused:l,onlyHiddenInputs:c}=Array.from(e.elements).reduce((h,f)=>{let{inputsUnused:g,onlyHiddenInputs:m}=h,d=f.name;if(!d)return h;g[d]===void 0&&(g[d]=!0),m[d]===void 0&&(m[d]=!0);let y=u.private(f,tt)||u.private(f,Ne),v=f.type==="hidden";return g[d]=g[d]&&!y,m[d]=m[d]&&v,h},{inputsUnused:{},onlyHiddenInputs:{}});for(let[h,f]of o.entries())if(i.length===0||i.indexOf(h)>=0){let g=l[h],m=c[h];g&&!(n&&n.name==h)&&!m&&a.append(jn(h,"_unused_"),""),typeof f=="string"&&a.append(h,f)}return n&&s&&n.parentElement.removeChild(s),a.toString()},Bn=class wi{static closestView(t){let i=t.closest(ke);return i?u.private(i,"view"):null}constructor(t,i,n,s,o){this.isDead=!1,this.liveSocket=i,this.flash=s,this.parent=n,this.root=n?n.root:this,this.el=t;let r=u.private(this.el,"view");if(r!==void 0&&r.isDead!==!0)throw x(`The DOM element for this view has already been bound to a view.

        An element can only ever be associated with a single view!
        Please ensure that you are not trying to initialize multiple LiveSockets on the same page.
        This could happen if you're accidentally trying to render your root layout more than once.
        Ensure that the template set on the LiveView is different than the root layout.
      `,{view:r}),new Error("Cannot bind multiple views to the same DOM element.");u.putPrivate(this.el,"view",this),this.id=this.el.id,this.ref=0,this.lastAckRef=null,this.childJoins=0,this.loaderTimer=null,this.disconnectedTimer=null,this.pendingDiffs=[],this.pendingForms=new Set,this.redirect=!1,this.href=null,this.joinCount=this.parent?this.parent.joinCount-1:0,this.joinAttempts=0,this.joinPending=!0,this.destroyed=!1,this.joinCallback=function(a){a&&a()},this.stopCallback=function(){},this.pendingJoinOps=this.parent?null:[],this.viewHooks={},this.formSubmits=[],this.children=this.parent?null:{},this.root.children[this.id]={},this.formsForRecovery={},this.channel=this.liveSocket.channel(`lv:${this.id}`,()=>{let a=this.href&&this.expandURL(this.href);return{redirect:this.redirect?a:void 0,url:this.redirect?void 0:a||void 0,params:this.connectParams(o),session:this.getSession(),static:this.getStatic(),flash:this.flash,sticky:this.el.hasAttribute(Tt)}}),this.portalElementIds=new Set}setHref(t){this.href=t}setRedirect(t){this.redirect=!0,this.href=t}isMain(){return this.el.hasAttribute(zt)}connectParams(t){let i=this.liveSocket.params(this.el),n=u.all(document,`[${this.binding(Ki)}]`).map(s=>s.src||s.href).filter(s=>typeof s=="string");return n.length>0&&(i._track_static=n),i._mounts=this.joinCount,i._mount_attempts=this.joinAttempts,i._live_referer=t,this.joinAttempts++,i}isConnected(){return this.channel.canPush()}getSession(){return this.el.getAttribute(Z)}getStatic(){let t=this.el.getAttribute(fe);return t===""?null:t}destroy(t=function(){}){this.destroyAllChildren(),this.destroyPortalElements(),this.destroyed=!0,u.deletePrivate(this.el,"view"),delete this.root.children[this.id],this.parent&&delete this.root.children[this.parent.id][this.id],clearTimeout(this.loaderTimer);let i=()=>{t();for(let n in this.viewHooks)this.destroyHook(this.viewHooks[n])};u.markPhxChildDestroyed(this.el),this.log("destroyed",()=>["the child has been removed from the parent"]),this.channel.leave().receive("ok",i).receive("error",i).receive("timeout",i)}setContainerClasses(...t){this.el.classList.remove(Ht,de,ve,Ft,xe),this.el.classList.add(...t)}showLoader(t){if(clearTimeout(this.loaderTimer),t)this.loaderTimer=setTimeout(()=>this.showLoader(),t);else{for(let i in this.viewHooks)this.viewHooks[i].__disconnected();this.setContainerClasses(de)}}execAll(t){u.all(this.el,`[${t}]`,i=>this.liveSocket.execJS(i,i.getAttribute(t)))}hideLoader(){clearTimeout(this.loaderTimer),clearTimeout(this.disconnectedTimer),this.setContainerClasses(Ht),this.execAll(this.binding("connected"))}triggerReconnected(){for(let t in this.viewHooks)this.viewHooks[t].__reconnected()}log(t,i){this.liveSocket.log(this,t,i)}transition(t,i,n=function(){}){this.liveSocket.transition(t,i,n)}withinTargets(t,i,n=document){if(t instanceof HTMLElement||t instanceof SVGElement)return this.liveSocket.owner(t,s=>i(s,t));if(ie(t))u.findComponentNodeList(this.id,t,n).length===0?x(`no component found matching phx-target of ${t}`):i(this,parseInt(t));else{let s=Array.from(n.querySelectorAll(t));s.length===0&&x(`nothing found matching the phx-target selector "${t}"`),s.forEach(o=>this.liveSocket.owner(o,r=>i(r,o)))}}applyDiff(t,i,n){this.log(t,()=>["",et(i)]);let{diff:s,reply:o,events:r,title:a}=ai.extract(i);n({diff:s,reply:o,events:r}),(typeof a=="string"||t=="mount")&&window.requestAnimationFrame(()=>u.putTitle(a))}onJoin(t){let{rendered:i,container:n,liveview_version:s,pid:o}=t;if(n){let[r,a]=n;this.el=u.replaceRootContainer(this.el,r,a)}this.childJoins=0,this.joinPending=!0,this.flash=null,this.root===this&&(this.formsForRecovery=this.getFormsForRecovery()),this.isMain()&&window.history.state===null&&H.pushState("replace",{type:"patch",id:this.id,position:this.liveSocket.currentHistoryPosition}),s!==this.liveSocket.version()&&console.error(`LiveView asset version mismatch. JavaScript version ${this.liveSocket.version()} vs. server ${s}. To avoid issues, please ensure that your assets use the same version as the server.`),o&&this.el.setAttribute(nn,o),H.dropLocal(this.liveSocket.localStorage,window.location.pathname,hi),this.applyDiff("mount",i,({diff:r,events:a})=>{this.rendered=new ai(this.id,r);let[l,c]=this.renderContainer(null,"join");this.dropPendingRefs(),this.joinCount++,this.joinAttempts=0,this.maybeRecoverForms(l,()=>{this.onJoinComplete(t,l,c,a)})})}dropPendingRefs(){u.all(document,`[${W}="${this.refSrc()}"]`,t=>{t.removeAttribute(Ce),t.removeAttribute(W),t.removeAttribute(I)})}onJoinComplete({live_patch:t},i,n,s){if(this.joinCount>1||this.parent&&!this.parent.isJoinPending())return this.applyJoinPatch(t,i,n,s);u.findPhxChildrenInFragment(i,this.id).filter(r=>{let a=r.id&&this.el.querySelector(`[id="${r.id}"]`),l=a&&a.getAttribute(fe);return l&&r.setAttribute(fe,l),a&&a.setAttribute(ce,this.root.id),this.joinChild(r)}).length===0?this.parent?(this.root.pendingJoinOps.push([this,()=>this.applyJoinPatch(t,i,n,s)]),this.parent.ackJoin(this)):(this.onAllChildJoinsComplete(),this.applyJoinPatch(t,i,n,s)):this.root.pendingJoinOps.push([this,()=>this.applyJoinPatch(t,i,n,s)])}attachTrueDocEl(){this.el=u.byId(this.id),this.el.setAttribute(ce,this.root.id)}execNewMounted(t=document){let i=this.binding(At),n=this.binding(wt);this.all(t,`[${i}], [${n}]`,s=>{u.maintainPrivateHooks(s,s,i,n),this.maybeAddNewHook(s)}),this.all(t,`[${this.binding(Le)}], [data-phx-${Le}]`,s=>{this.maybeAddNewHook(s)}),this.all(t,`[${this.binding(Jt)}]`,s=>{this.maybeMounted(s)})}all(t,i,n){u.all(t,i,s=>{this.ownsElement(s)&&n(s)})}applyJoinPatch(t,i,n,s){this.attachTrueDocEl();let o=new Xe(this,this.el,this.id,i,n,null);if(o.markPrunableContentForRemoval(),this.performPatch(o,!1,!0),this.joinNewChildren(),this.execNewMounted(),this.joinPending=!1,this.liveSocket.dispatchEvents(s),this.applyPendingUpdates(),t){let{kind:r,to:a}=t;this.liveSocket.historyPatch(a,r)}this.hideLoader(),this.joinCount>1&&this.triggerReconnected(),this.stopCallback()}triggerBeforeUpdateHook(t,i){this.liveSocket.triggerDOM("onBeforeElUpdated",[t,i]);let n=this.getHook(t),s=n&&u.isIgnored(t,this.binding(nt));if(n&&!t.isEqualNode(i)&&!(s&&gn(t.dataset,i.dataset)))return n.__beforeUpdate(),n}maybeMounted(t){let i=t.getAttribute(this.binding(Jt)),n=i&&u.private(t,"mounted");i&&!n&&(this.liveSocket.execJS(t,i),u.putPrivate(t,"mounted",!0))}maybeAddNewHook(t){let i=this.addHook(t);i&&i.__mounted()}performPatch(t,i,n=!1){let s=[],o=!1,r=new Set;return this.liveSocket.triggerDOM("onPatchStart",[t.targetContainer]),t.after("added",a=>{this.liveSocket.triggerDOM("onNodeAdded",[a]);let l=this.binding(At),c=this.binding(wt);u.maintainPrivateHooks(a,a,l,c),this.maybeAddNewHook(a),a.getAttribute&&this.maybeMounted(a)}),t.after("phxChildAdded",a=>{u.isPhxSticky(a)?this.liveSocket.joinRootViews():o=!0}),t.before("updated",(a,l)=>{this.triggerBeforeUpdateHook(a,l)&&r.add(a.id),k.onBeforeElUpdated(a,l)}),t.after("updated",a=>{r.has(a.id)&&this.getHook(a).__updated()}),t.after("discarded",a=>{a.nodeType===Node.ELEMENT_NODE&&s.push(a)}),t.after("transitionsDiscarded",a=>this.afterElementsRemoved(a,i)),t.perform(n),this.afterElementsRemoved(s,i),this.liveSocket.triggerDOM("onPatchEnd",[t.targetContainer]),o}afterElementsRemoved(t,i){let n=[];t.forEach(s=>{let o=u.all(s,`[${ne}]`),r=u.all(s,`[${this.binding(Le)}], [data-phx-hook]`);o.concat(s).forEach(a=>{let l=this.componentID(a);ie(l)&&n.indexOf(l)===-1&&n.push(l)}),r.concat(s).forEach(a=>{let l=this.getHook(a);l&&this.destroyHook(l)})}),i&&this.maybePushComponentsDestroyed(n)}joinNewChildren(){u.findPhxChildren(document,this.id).forEach(t=>this.joinChild(t))}maybeRecoverForms(t,i){let n=this.binding("change"),s=this.root.formsForRecovery,o=document.createElement("template");o.innerHTML=t;let r=o.content.firstElementChild;r.id=this.id,r.setAttribute(ce,this.root.id),r.setAttribute(Z,this.getSession()),r.setAttribute(fe,this.getStatic()),r.setAttribute(pe,this.parent?this.parent.id:null);let a=u.all(o.content,"form").filter(l=>l.id&&s[l.id]).filter(l=>!this.pendingForms.has(l.id)).filter(l=>s[l.id].getAttribute(n)===l.getAttribute(n)).map(l=>[s[l.id],l]);if(a.length===0)return i();a.forEach(([l,c],h)=>{this.pendingForms.add(c.id),this.pushFormRecovery(l,c,o.content.firstElementChild,()=>{this.pendingForms.delete(c.id),h===a.length-1&&i()})})}getChildById(t){return this.root.children[this.id][t]}getDescendentByEl(t){var i;return t.id===this.id?this:(i=this.children[t.getAttribute(pe)])==null?void 0:i[t.id]}destroyDescendent(t){for(let i in this.root.children)for(let n in this.root.children[i])if(n===t)return this.root.children[i][n].destroy()}joinChild(t){if(!this.getChildById(t.id)){let n=new wi(t,this.liveSocket,this);return this.root.children[this.id][n.id]=n,n.join(),this.childJoins++,!0}}isJoinPending(){return this.joinPending}ackJoin(t){this.childJoins--,this.childJoins===0&&(this.parent?this.parent.ackJoin(this):this.onAllChildJoinsComplete())}onAllChildJoinsComplete(){this.pendingForms.clear(),this.formsForRecovery={},this.joinCallback(()=>{this.pendingJoinOps.forEach(([t,i])=>{t.isDestroyed()||i()}),this.pendingJoinOps=[]})}update(t,i){if(this.isJoinPending()||this.liveSocket.hasPendingLink()&&this.root.isMain())return this.pendingDiffs.push({diff:t,events:i});this.rendered.mergeDiff(t);let n=!1;this.rendered.isComponentOnlyDiff(t)?this.liveSocket.time("component patch complete",()=>{u.findExistingParentCIDs(this.id,this.rendered.componentCIDs(t)).forEach(o=>{this.componentPatch(this.rendered.getComponent(t,o),o)&&(n=!0)})}):Zt(t)||this.liveSocket.time("full patch complete",()=>{let[s,o]=this.renderContainer(t,"update"),r=new Xe(this,this.el,this.id,s,o,null);n=this.performPatch(r,!0)}),this.liveSocket.dispatchEvents(i),n&&this.joinNewChildren()}renderContainer(t,i){return this.liveSocket.time(`toString diff (${i})`,()=>{let n=this.el.tagName,s=t?this.rendered.componentCIDs(t):null,{buffer:o,streams:r}=this.rendered.toString(s);return[`<${n}>${o}</${n}>`,r]})}componentPatch(t,i){if(Zt(t))return!1;let{buffer:n,streams:s}=this.rendered.componentToString(i),o=new Xe(this,this.el,this.id,n,s,i);return this.performPatch(o,!0)}getHook(t){return this.viewHooks[we.elementID(t)]}addHook(t){let i=we.elementID(t);if(!(t.getAttribute&&!this.ownsElement(t)))if(i&&!this.viewHooks[i]){let n=u.getCustomElHook(t)||x(`no hook found for custom element: ${t.id}`);return this.viewHooks[i]=n,n.__attachView(this),n}else{if(i||!t.getAttribute)return;{let n=t.getAttribute(`data-phx-${Le}`)||t.getAttribute(this.binding(Le));if(!n)return;let s=this.liveSocket.getHookDefinition(n);if(s){if(!t.id){x(`no DOM ID for hook "${n}". Hooks require a unique ID on each element.`,t);return}let o;try{if(typeof s=="function"&&s.prototype instanceof we)o=new s(this,t);else if(typeof s=="object"&&s!==null)o=new we(this,t,s);else{x(`Invalid hook definition for "${n}". Expected a class extending ViewHook or an object definition.`,t);return}}catch(r){let a=r instanceof Error?r.message:String(r);x(`Failed to create hook "${n}": ${a}`,t);return}return this.viewHooks[we.elementID(o.el)]=o,o}else n!==null&&x(`unknown hook found for "${n}"`,t)}}}destroyHook(t){let i=we.elementID(t.el);t.__destroyed(),t.__cleanup__(),delete this.viewHooks[i]}applyPendingUpdates(){this.liveSocket.hasPendingLink()&&this.root.isMain()||(this.pendingDiffs.forEach(({diff:t,events:i})=>this.update(t,i)),this.pendingDiffs=[],this.eachChild(t=>t.applyPendingUpdates()))}eachChild(t){let i=this.root.children[this.id]||{};for(let n in i)t(this.getChildById(n))}onChannel(t,i){this.liveSocket.onChannel(this.channel,t,n=>{this.isJoinPending()?this.root.pendingJoinOps.push([this,()=>i(n)]):this.liveSocket.requestDOMUpdate(()=>i(n))})}bindChannel(){this.liveSocket.onChannel(this.channel,"diff",t=>{this.liveSocket.requestDOMUpdate(()=>{this.applyDiff("update",t,({diff:i,events:n})=>this.update(i,n))})}),this.onChannel("redirect",({to:t,flash:i})=>this.onRedirect({to:t,flash:i})),this.onChannel("live_patch",t=>this.onLivePatch(t)),this.onChannel("live_redirect",t=>this.onLiveRedirect(t)),this.channel.onError(t=>this.onError(t)),this.channel.onClose(t=>this.onClose(t))}destroyAllChildren(){this.eachChild(t=>t.destroy())}onLiveRedirect(t){let{to:i,kind:n,flash:s}=t,o=this.expandURL(i),r=new CustomEvent("phx:server-navigate",{detail:{to:i,kind:n,flash:s}});this.liveSocket.historyRedirect(r,o,n,s)}onLivePatch(t){let{to:i,kind:n}=t;this.href=this.expandURL(i),this.liveSocket.historyPatch(i,n)}expandURL(t){return t.startsWith("/")?`${window.location.protocol}//${window.location.host}${t}`:t}onRedirect({to:t,flash:i,reloadToken:n}){this.liveSocket.redirect(t,i,n)}isDestroyed(){return this.destroyed}joinDead(){this.isDead=!0}joinPush(){return this.joinPush=this.joinPush||this.channel.join(),this.joinPush}join(t){this.showLoader(this.liveSocket.loaderTimeout),this.bindChannel(),this.isMain()&&(this.stopCallback=this.liveSocket.withPageLoading({to:this.href,kind:"initial"})),this.joinCallback=i=>{i=i||function(){},t?t(this.joinCount,i):i()},this.wrapPush(()=>this.channel.join(),{ok:i=>this.liveSocket.requestDOMUpdate(()=>this.onJoin(i)),error:i=>this.onJoinError(i),timeout:()=>this.onJoinError({reason:"timeout"})})}onJoinError(t){if(t.reason==="reload"){this.log("error",()=>[`failed mount with ${t.status}. Falling back to page reload`,t]),this.onRedirect({to:this.root.href,reloadToken:t.token});return}else if(t.reason==="unauthorized"||t.reason==="stale"){this.log("error",()=>["unauthorized live_redirect. Falling back to page request",t]),this.onRedirect({to:this.root.href,flash:this.flash});return}if((t.redirect||t.live_redirect)&&(this.joinPending=!1,this.channel.leave()),t.redirect)return this.onRedirect(t.redirect);if(t.live_redirect)return this.onLiveRedirect(t.live_redirect);if(this.log("error",()=>["unable to join",t]),this.isMain())this.displayError([de,ve,xe]),this.liveSocket.isConnected()&&this.liveSocket.reloadWithJitter(this);else{this.joinAttempts>=Wt&&(this.root.displayError([de,ve,xe]),this.log("error",()=>[`giving up trying to mount after ${Wt} tries`,t]),this.destroy());let i=u.byId(this.el.id);i?(u.mergeAttrs(i,this.el),this.displayError([de,ve,xe]),this.el=i):this.destroy()}}onClose(t){if(!this.isDestroyed()){if(this.isMain()&&this.liveSocket.hasPendingLink()&&t!=="leave")return this.liveSocket.reloadWithJitter(this);this.destroyAllChildren(),this.liveSocket.dropActiveElement(this),this.liveSocket.isUnloaded()&&this.showLoader(an)}}onError(t){this.onClose(t),this.liveSocket.isConnected()&&this.log("error",()=>["view crashed",t]),this.liveSocket.isUnloaded()||(this.liveSocket.isConnected()?this.displayError([de,ve,xe]):this.displayError([de,ve,Ft]))}displayError(t){this.isMain()&&u.dispatchEvent(window,"phx:page-loading-start",{detail:{to:this.href,kind:"error"}}),this.showLoader(),this.setContainerClasses(...t),this.delayedDisconnected()}delayedDisconnected(){this.disconnectedTimer=setTimeout(()=>{this.execAll(this.binding("disconnected"))},this.liveSocket.disconnectedTimeout)}wrapPush(t,i){let n=this.liveSocket.getLatencySim(),s=n?o=>setTimeout(()=>!this.isDestroyed()&&o(),n):o=>!this.isDestroyed()&&o();s(()=>{t().receive("ok",o=>s(()=>i.ok&&i.ok(o))).receive("error",o=>s(()=>i.error&&i.error(o))).receive("timeout",()=>s(()=>i.timeout&&i.timeout()))})}pushWithReply(t,i,n){if(!this.isConnected())return Promise.reject(new Error("no connection"));let[s,[o],r]=t?t({payload:n}):[null,[],{}],a=this.joinCount,l=function(){};return r.page_loading&&(l=this.liveSocket.withPageLoading({kind:"element",target:o})),typeof n.cid!="number"&&delete n.cid,new Promise((c,h)=>{this.wrapPush(()=>this.channel.push(i,n,hn),{ok:f=>{s!==null&&(this.lastAckRef=s);let g=m=>{f.redirect&&this.onRedirect(f.redirect),f.live_patch&&this.onLivePatch(f.live_patch),f.live_redirect&&this.onLiveRedirect(f.live_redirect),l(),c({resp:f,reply:m,ref:s})};f.diff?this.liveSocket.requestDOMUpdate(()=>{this.applyDiff("update",f.diff,({diff:m,reply:d,events:y})=>{s!==null&&this.undoRefs(s,n.event),this.update(m,y),g(d)})}):(s!==null&&this.undoRefs(s,n.event),g(null))},error:f=>h(new Error(`failed with reason: ${f}`)),timeout:()=>{h(new Error("timeout")),this.joinCount===a&&this.liveSocket.reloadWithJitter(this,()=>{this.log("timeout",()=>["received timeout while communicating with server. Falling back to hard refresh for recovery"])})}})})}undoRefs(t,i,n){if(!this.isConnected())return;let s=`[${W}="${this.refSrc()}"]`;n?(n=new Set(n),u.all(document,s,o=>{n&&!n.has(o)||(u.all(o,s,r=>this.undoElRef(r,t,i)),this.undoElRef(o,t,i))})):u.all(document,s,o=>this.undoElRef(o,t,i))}undoElRef(t,i,n){new kt(t).maybeUndo(i,n,o=>{let r=new Xe(this,t,this.id,o,[],null,{undoRef:i}),a=this.performPatch(r,!0);u.all(t,`[${W}="${this.refSrc()}"]`,l=>this.undoElRef(l,i,n)),a&&this.joinNewChildren()})}refSrc(){return this.el.id}putRef(t,i,n,s={}){let o=this.ref++,r=this.binding(jt);if(s.loading){let a=u.all(document,s.loading).map(l=>({el:l,lock:!0,loading:!0}));t=t.concat(a)}for(let{el:a,lock:l,loading:c}of t){if(!l&&!c)throw new Error("putRef requires lock or loading");if(a.setAttribute(W,this.refSrc()),c&&a.setAttribute(Ce,o),l&&a.setAttribute(I,o),!c||s.submitter&&!(a===s.submitter||a===s.form))continue;let h=new Promise(d=>{a.addEventListener(`phx:undo-lock:${o}`,()=>d(m),{once:!0})}),f=new Promise(d=>{a.addEventListener(`phx:undo-loading:${o}`,()=>d(m),{once:!0})});a.classList.add(`phx-${n}-loading`);let g=a.getAttribute(r);g!==null&&(a.getAttribute(it)||a.setAttribute(it,a.innerText),g!==""&&(a.innerText=g),a.setAttribute(Te,a.getAttribute(Te)||a.disabled),a.setAttribute("disabled",""));let m={event:i,eventType:n,ref:o,isLoading:c,isLocked:l,lockElements:t.filter(({lock:d})=>d).map(({el:d})=>d),loadingElements:t.filter(({loading:d})=>d).map(({el:d})=>d),unlock:d=>{d=Array.isArray(d)?d:[d],this.undoRefs(o,i,d)},lockComplete:h,loadingComplete:f,lock:d=>new Promise(y=>{if(this.isAcked(o))return y(m);d.setAttribute(I,o),d.setAttribute(W,this.refSrc()),d.addEventListener(`phx:lock-stop:${o}`,()=>y(m),{once:!0})})};s.payload&&(m.payload=s.payload),s.target&&(m.target=s.target),s.originalEvent&&(m.originalEvent=s.originalEvent),a.dispatchEvent(new CustomEvent("phx:push",{detail:m,bubbles:!0,cancelable:!1})),i&&a.dispatchEvent(new CustomEvent(`phx:push:${i}`,{detail:m,bubbles:!0,cancelable:!1}))}return[o,t.map(({el:a})=>a),s]}isAcked(t){return this.lastAckRef!==null&&this.lastAckRef>=t}componentID(t){let i=t.getAttribute&&t.getAttribute(ne);return i?parseInt(i):null}targetComponentID(t,i,n={}){if(ie(i))return i;let s=n.target||t.getAttribute(this.binding("target"));return ie(s)?parseInt(s):i&&(s!==null||n.target)?this.closestComponentID(i):null}closestComponentID(t){return ie(t)?t:t?me(t.closest(`[${ne}]`),i=>this.ownsElement(i)&&this.componentID(i)):null}pushHookEvent(t,i,n,s){if(!this.isConnected())return this.log("hook",()=>["unable to push hook event. LiveView not connected",n,s]),Promise.reject(new Error("unable to push hook event. LiveView not connected"));let o=()=>this.putRef([{el:t,loading:!0,lock:!0}],n,"hook",{payload:s,target:i});return this.pushWithReply(o,"event",{type:"hook",event:n,value:s,cid:this.closestComponentID(i)}).then(({resp:r,reply:a,ref:l})=>({reply:a,ref:l}))}extractMeta(t,i,n){let s=this.binding("value-");for(let o=0;o<t.attributes.length;o++){i||(i={});let r=t.attributes[o].name;r.startsWith(s)&&(i[r.replace(s,"")]=t.getAttribute(r))}if(t.value!==void 0&&!(t instanceof HTMLFormElement)&&(i||(i={}),i.value=t.value,t.tagName==="INPUT"&&pi.indexOf(t.type)>=0&&!t.checked&&delete i.value),n){i||(i={});for(let o in n)i[o]=n[o]}return i}pushEvent(t,i,n,s,o,r={},a){this.pushWithReply(l=>this.putRef([{el:i,loading:!0,lock:!0}],s,t,he(N({},r),{payload:l==null?void 0:l.payload})),"event",{type:t,event:s,value:this.extractMeta(i,o,r.value),cid:this.targetComponentID(i,n,r)}).then(({reply:l})=>a&&a(l)).catch(l=>x("Failed to push event",l))}pushFileProgress(t,i,n,s=function(){}){this.liveSocket.withinOwners(t.form,(o,r)=>{o.pushWithReply(null,"progress",{event:t.getAttribute(o.binding(on)),ref:t.getAttribute(se),entry_ref:i,progress:n,cid:o.targetComponentID(t.form,r)}).then(()=>s()).catch(a=>x("Failed to push file progress",a))})}pushInput(t,i,n,s,o,r){if(!t.form)throw new Error("form events require the input to be inside a form");let a,l=ie(n)?n:this.targetComponentID(t.form,i,o),c=d=>this.putRef([{el:t,loading:!0,lock:!0},{el:t.form,loading:!0,lock:!0}],s,"change",he(N({},o),{payload:d==null?void 0:d.payload})),h,f=this.extractMeta(t.form,{},o.value),g={};t instanceof HTMLButtonElement&&(g.submitter=t),t.getAttribute(this.binding("change"))?h=Ke(t.form,g,[t.name]):h=Ke(t.form,g),u.isUploadInput(t)&&t.files&&t.files.length>0&&O.trackFiles(t,Array.from(t.files)),a=O.serializeUploads(t);let m={type:"form",event:s,value:h,meta:N({_target:o._target||"undefined"},f),uploads:a,cid:l};this.pushWithReply(c,"event",m).then(({resp:d})=>{u.isUploadInput(t)&&u.isAutoUpload(t)?kt.onUnlock(t,()=>{if(O.filesAwaitingPreflight(t).length>0){let[y,v]=c();this.undoRefs(y,s,[t.form]),this.uploadFiles(t.form,s,i,y,l,E=>{r&&r(d),this.triggerAwaitingSubmit(t.form,s),this.undoRefs(y,s)})}}):r&&r(d)}).catch(d=>x("Failed to push input event",d))}triggerAwaitingSubmit(t,i){let n=this.getScheduledSubmit(t);if(n){let[s,o,r,a]=n;this.cancelSubmit(t,i),a()}}getScheduledSubmit(t){return this.formSubmits.find(([i,n,s,o])=>i.isSameNode(t))}scheduleSubmit(t,i,n,s){if(this.getScheduledSubmit(t))return!0;this.formSubmits.push([t,i,n,s])}cancelSubmit(t,i){this.formSubmits=this.formSubmits.filter(([n,s,o,r])=>n.isSameNode(t)?(this.undoRefs(s,i),!1):!0)}disableForm(t,i,n={}){let s=d=>!(Me(d,`${this.binding(nt)}=ignore`,d.form)||Me(d,"data-phx-update=ignore",d.form)),o=d=>d.hasAttribute(this.binding(jt)),r=d=>d.tagName=="BUTTON",a=d=>["INPUT","TEXTAREA","SELECT"].includes(d.tagName),l=Array.from(t.elements),c=l.filter(o),h=l.filter(r).filter(s),f=l.filter(a).filter(s);h.forEach(d=>{d.setAttribute(Te,d.disabled),d.disabled=!0}),f.forEach(d=>{d.setAttribute(Ct,d.readOnly),d.readOnly=!0,d.files&&(d.setAttribute(Te,d.disabled),d.disabled=!0)});let g=c.concat(h).concat(f).map(d=>({el:d,loading:!0,lock:!0})),m=[{el:t,loading:!0,lock:!1}].concat(g).reverse();return this.putRef(m,i,"submit",n)}pushFormSubmit(t,i,n,s,o,r){let a=c=>this.disableForm(t,n,he(N({},o),{form:t,payload:c==null?void 0:c.payload,submitter:s}));u.putPrivate(t,"submitter",s);let l=this.targetComponentID(t,i);if(O.hasUploadsInProgress(t)){let[c,h]=a(),f=()=>this.pushFormSubmit(t,i,n,s,o,r);return this.scheduleSubmit(t,c,o,f)}else if(O.inputsAwaitingPreflight(t).length>0){let[c,h]=a(),f=()=>[c,h,o];this.uploadFiles(t,n,i,c,l,g=>{if(O.inputsAwaitingPreflight(t).length>0)return this.undoRefs(c,n);let m=this.extractMeta(t,{},o.value),d=Ke(t,{submitter:s});this.pushWithReply(f,"event",{type:"form",event:n,value:d,meta:m,cid:l}).then(({resp:y})=>r(y)).catch(y=>x("Failed to push form submit",y))})}else if(!(t.hasAttribute(W)&&t.classList.contains("phx-submit-loading"))){let c=this.extractMeta(t,{},o.value),h=Ke(t,{submitter:s});this.pushWithReply(a,"event",{type:"form",event:n,value:h,meta:c,cid:l}).then(({resp:f})=>r(f)).catch(f=>x("Failed to push form submit",f))}}uploadFiles(t,i,n,s,o,r){let a=this.joinCount,l=O.activeFileInputs(t),c=l.length;l.forEach(h=>{let f=new O(h,this,()=>{c--,c===0&&r()}),g=f.entries().map(d=>d.toPreflightPayload());if(g.length===0){c--;return}let m={ref:h.getAttribute(se),entries:g,cid:this.targetComponentID(h.form,n)};this.log("upload",()=>["sending preflight request",m]),this.pushWithReply(null,"allow_upload",m).then(({resp:d})=>{if(this.log("upload",()=>["got preflight response",d]),f.entries().forEach(y=>{d.entries&&!d.entries[y.ref]&&this.handleFailedEntryPreflight(y.ref,"failed preflight",f)}),d.error||Object.keys(d.entries).length===0)this.undoRefs(s,i),(d.error||[]).map(([v,E])=>{this.handleFailedEntryPreflight(v,E,f)});else{let y=v=>{this.channel.onError(()=>{this.joinCount===a&&v()})};f.initAdapterUpload(d,y,this.liveSocket)}}).catch(d=>x("Failed to push upload",d))})}handleFailedEntryPreflight(t,i,n){if(n.isAutoUpload()){let s=n.entries().find(o=>o.ref===t.toString());s&&s.cancel()}else n.entries().map(s=>s.cancel());this.log("upload",()=>[`error for entry ${t}`,i])}dispatchUploads(t,i,n){let s=this.targetCtxElement(t)||this.el,o=u.findUploadInputs(s).filter(r=>r.name===i);o.length===0?x(`no live file inputs found matching the name "${i}"`):o.length>1?x(`duplicate live file inputs found matching the name "${i}"`):u.dispatchEvent(o[0],ui,{detail:{files:n}})}targetCtxElement(t){if(ie(t)){let[i]=u.findComponentNodeList(this.id,t);return i}else return t||null}pushFormRecovery(t,i,n,s){let o=this.binding("change"),r=i.getAttribute(this.binding("target"))||i,a=i.getAttribute(this.binding(Bt))||i.getAttribute(this.binding("change")),l=Array.from(t.elements).filter(f=>u.isFormInput(f)&&f.name&&!f.hasAttribute(o));if(l.length===0){s();return}l.forEach(f=>f.hasAttribute(se)&&O.clearFiles(f));let c=l.find(f=>f.type!=="hidden")||l[0],h=0;this.withinTargets(r,(f,g)=>{let m=this.targetComponentID(i,g);h++;let d=new CustomEvent("phx:form-recovery",{detail:{sourceElement:t}});k.exec(d,"change",a,this,c,["push",{_target:c.name,targetView:f,targetCtx:g,newCid:m,callback:()=>{h--,h===0&&s()}}])},n)}pushLinkPatch(t,i,n,s){let o=this.liveSocket.setPendingLink(i),r=t.isTrusted&&t.type!=="popstate",a=n?()=>this.putRef([{el:n,loading:r,lock:!0}],null,"click"):null,l=()=>this.liveSocket.redirect(window.location.href),c=i.startsWith("/")?`${location.protocol}//${location.host}${i}`:i;this.pushWithReply(a,"live_patch",{url:c}).then(({resp:h})=>{this.liveSocket.requestDOMUpdate(()=>{h.link_redirect?this.liveSocket.replaceMain(i,null,s,o):(this.liveSocket.commitPendingLink(o)&&(this.href=i),this.applyPendingUpdates(),s&&s(o))})},({error:h,timeout:f})=>l())}getFormsForRecovery(){if(this.joinCount===0)return{};let t=this.binding("change");return u.all(this.el,`form[${t}]`).filter(i=>i.id).filter(i=>i.elements.length>0).filter(i=>i.getAttribute(this.binding(Bt))!=="ignore").map(i=>{let n=i.cloneNode(!0);Et(n,i,{onBeforeElUpdated:(o,r)=>(u.copyPrivates(o,r),!0)});let s=document.querySelectorAll(`[form="${i.id}"]`);return Array.from(s).forEach(o=>{if(i.contains(o))return;let r=o.cloneNode(!0);Et(r,o),u.copyPrivates(r,o),n.appendChild(r)}),n}).reduce((i,n)=>(i[n.id]=n,i),{})}maybePushComponentsDestroyed(t){let i=t.filter(s=>u.findComponentNodeList(this.el,s).length===0),n=s=>{this.isDestroyed()||x("Failed to push components destroyed",s)};i.length>0&&(i.forEach(s=>this.rendered.resetRender(s)),this.pushWithReply(null,"cids_will_destroy",{cids:i}).then(()=>{this.liveSocket.requestDOMUpdate(()=>{let s=i.filter(o=>u.findComponentNodeList(this.el,o).length===0);s.length>0&&this.pushWithReply(null,"cids_destroyed",{cids:s}).then(({resp:o})=>{this.rendered.pruneCIDs(o.cids)}).catch(n)})}).catch(n))}ownsElement(t){let i=t.closest(ke);return t.getAttribute(pe)===this.id||i&&i.id===this.id||!i&&this.isDead}submitForm(t,i,n,s,o={}){u.putPrivate(t,Ne,!0),Array.from(t.elements).forEach(a=>u.putPrivate(a,Ne,!0)),this.liveSocket.blurActiveElement(this),this.pushFormSubmit(t,i,n,s,o,()=>{this.liveSocket.restorePreviouslyActiveFocus()})}binding(t){return this.liveSocket.binding(t)}pushPortalElementId(t){this.portalElementIds.add(t)}dropPortalElementId(t){this.portalElementIds.delete(t)}destroyPortalElements(){this.portalElementIds.forEach(t=>{let i=document.getElementById(t);i&&i.remove()})}};var Jn=class{constructor(e,t,i={}){if(this.unloaded=!1,!t||t.constructor.name==="Object")throw new Error(`
      a phoenix Socket must be provided as the second argument to the LiveSocket constructor. For example:

          import {Socket} from "phoenix"
          import {LiveSocket} from "phoenix_live_view"
          let liveSocket = new LiveSocket("/live", Socket, {...})
      `);this.socket=new t(e,i),this.bindingPrefix=i.bindingPrefix||cn,this.opts=i,this.params=Oe(i.params||{}),this.viewLogger=i.viewLogger,this.metadataCallbacks=i.metadata||{},this.defaults=Object.assign(et(dn),i.defaults||{}),this.prevActive=null,this.silenced=!1,this.main=null,this.outgoingMainEl=null,this.clickStartedAtTarget=null,this.linkRef=1,this.roots={},this.href=window.location.href,this.pendingLink=null,this.currentLocation=et(window.location),this.hooks=i.hooks||{},this.uploaders=i.uploaders||{},this.loaderTimeout=i.loaderTimeout||rn,this.disconnectedTimeout=i.disconnectedTimeout||ln,this.reloadWithJitterTimer=null,this.maxReloads=i.maxReloads||Vi,this.reloadJitterMin=i.reloadJitterMin||Wi,this.reloadJitterMax=i.reloadJitterMax||qi,this.failsafeJitter=i.failsafeJitter||Xi,this.localStorage=i.localStorage||window.localStorage,this.sessionStorage=i.sessionStorage||window.sessionStorage,this.boundTopLevelEvents=!1,this.boundEventNames=new Set,this.blockPhxChangeWhileComposing=i.blockPhxChangeWhileComposing||!1,this.serverCloseRef=null,this.domCallbacks=Object.assign({jsQuerySelectorAll:null,onPatchStart:Oe(),onPatchEnd:Oe(),onNodeAdded:Oe(),onBeforeElUpdated:Oe()},i.dom||{}),this.transitions=new Vn,this.currentHistoryPosition=parseInt(this.sessionStorage.getItem(Ve))||0,window.addEventListener("pagehide",n=>{this.unloaded=!0}),this.socket.onOpen(()=>{this.isUnloaded()&&window.location.reload()})}version(){return"1.1.4"}isProfileEnabled(){return this.sessionStorage.getItem(mt)==="true"}isDebugEnabled(){return this.sessionStorage.getItem(Je)==="true"}isDebugDisabled(){return this.sessionStorage.getItem(Je)==="false"}enableDebug(){this.sessionStorage.setItem(Je,"true")}enableProfiling(){this.sessionStorage.setItem(mt,"true")}disableDebug(){this.sessionStorage.setItem(Je,"false")}disableProfiling(){this.sessionStorage.removeItem(mt)}enableLatencySim(e){this.enableDebug(),console.log("latency simulator enabled for the duration of this browser session. Call disableLatencySim() to disable"),this.sessionStorage.setItem(pt,e)}disableLatencySim(){this.sessionStorage.removeItem(pt)}getLatencySim(){let e=this.sessionStorage.getItem(pt);return e?parseInt(e):null}getSocket(){return this.socket}connect(){window.location.hostname==="localhost"&&!this.isDebugDisabled()&&this.enableDebug();let e=()=>{this.resetReloadStatus(),this.joinRootViews()?(this.bindTopLevelEvents(),this.socket.connect()):this.main?this.socket.connect():this.bindTopLevelEvents({dead:!0}),this.joinDeadView()};["complete","loaded","interactive"].indexOf(document.readyState)>=0?e():document.addEventListener("DOMContentLoaded",()=>e())}disconnect(e){clearTimeout(this.reloadWithJitterTimer),this.serverCloseRef&&(this.socket.off(this.serverCloseRef),this.serverCloseRef=null),this.socket.disconnect(e)}replaceTransport(e){clearTimeout(this.reloadWithJitterTimer),this.socket.replaceTransport(e),this.connect()}execJS(e,t,i=null){let n=new CustomEvent("phx:exec",{detail:{sourceElement:e}});this.owner(e,s=>k.exec(n,i,t,s,e))}js(){return bi(this,"js")}unload(){this.unloaded||(this.main&&this.isConnected()&&this.log(this.main,"socket",()=>["disconnect for page nav"]),this.unloaded=!0,this.destroyAllViews(),this.disconnect())}triggerDOM(e,t){this.domCallbacks[e](...t)}time(e,t){if(!this.isProfileEnabled()||!console.time)return t();console.time(e);let i=t();return console.timeEnd(e),i}log(e,t,i){if(this.viewLogger){let[n,s]=i();this.viewLogger(e,t,n,s)}else if(this.isDebugEnabled()){let[n,s]=i();pn(e,t,n,s)}}requestDOMUpdate(e){this.transitions.after(e)}asyncTransition(e){this.transitions.addAsyncTransition(e)}transition(e,t,i=function(){}){this.transitions.addTransition(e,t,i)}onChannel(e,t,i){e.on(t,n=>{let s=this.getLatencySim();s?setTimeout(()=>i(n),s):i(n)})}reloadWithJitter(e,t){clearTimeout(this.reloadWithJitterTimer),this.disconnect();let i=this.reloadJitterMin,n=this.reloadJitterMax,s=Math.floor(Math.random()*(n-i+1))+i,o=H.updateLocal(this.localStorage,window.location.pathname,hi,0,r=>r+1);o>=this.maxReloads&&(s=this.failsafeJitter),this.reloadWithJitterTimer=setTimeout(()=>{e.isDestroyed()||e.isConnected()||(e.destroy(),t?t():this.log(e,"join",()=>[`encountered ${o} consecutive reloads`]),o>=this.maxReloads&&this.log(e,"join",()=>[`exceeded ${this.maxReloads} consecutive reloads. Entering failsafe mode`]),this.hasPendingLink()?window.location=this.pendingLink:window.location.reload())},s)}getHookDefinition(e){if(e)return this.maybeInternalHook(e)||this.hooks[e]||this.maybeRuntimeHook(e)}maybeInternalHook(e){return e&&e.startsWith("Phoenix.")&&Cn[e.split(".")[1]]}maybeRuntimeHook(e){let t=document.querySelector(`script[${Qe}="${CSS.escape(e)}"]`);if(!t)return;let i=window[`phx_hook_${e}`];if(!i||typeof i!="function"){x("a runtime hook must be a function",t);return}let n=i();if(n&&(typeof n=="object"||typeof n=="function"))return n;x("runtime hook must return an object with hook callbacks or an instance of ViewHook",t)}isUnloaded(){return this.unloaded}isConnected(){return this.socket.isConnected()}getBindingPrefix(){return this.bindingPrefix}binding(e){return`${this.getBindingPrefix()}${e}`}channel(e,t){return this.socket.channel(e,t)}joinDeadView(){let e=document.body;if(e&&!this.isPhxView(e)&&!this.isPhxView(document.firstElementChild)){let t=this.newRootView(e);t.setHref(this.getHref()),t.joinDead(),this.main||(this.main=t),window.requestAnimationFrame(()=>{var i;t.execNewMounted(),this.maybeScroll((i=history.state)==null?void 0:i.scroll)})}}joinRootViews(){let e=!1;return u.all(document,`${ke}:not([${pe}])`,t=>{if(!this.getRootById(t.id)){let i=this.newRootView(t);u.isPhxSticky(t)||i.setHref(this.getHref()),i.join(),t.hasAttribute(zt)&&(this.main=i)}e=!0}),e}redirect(e,t,i){i&&H.setCookie(Vt,i,60),this.unload(),H.redirect(e,t)}replaceMain(e,t,i=null,n=this.setPendingLink(e)){let s=this.currentLocation.href;this.outgoingMainEl=this.outgoingMainEl||this.main.el;let o=u.findPhxSticky(document)||[],r=u.all(this.outgoingMainEl,`[${this.binding("remove")}]`).filter(l=>!u.isChildOfAny(l,o)),a=u.cloneNode(this.outgoingMainEl,"");this.main.showLoader(this.loaderTimeout),this.main.destroy(),this.main=this.newRootView(a,t,s),this.main.setRedirect(e),this.transitionRemoves(r),this.main.join((l,c)=>{l===1&&this.commitPendingLink(n)&&this.requestDOMUpdate(()=>{r.forEach(h=>h.remove()),o.forEach(h=>a.appendChild(h)),this.outgoingMainEl.replaceWith(a),this.outgoingMainEl=null,i&&i(n),c()})})}transitionRemoves(e,t){let i=this.binding("remove"),n=s=>{s.preventDefault(),s.stopImmediatePropagation()};e.forEach(s=>{for(let o of this.boundEventNames)s.addEventListener(o,n,!0);this.execJS(s,s.getAttribute(i),"remove")}),this.requestDOMUpdate(()=>{e.forEach(s=>{for(let o of this.boundEventNames)s.removeEventListener(o,n,!0)}),t&&t()})}isPhxView(e){return e.getAttribute&&e.getAttribute(Z)!==null}newRootView(e,t,i){let n=new Bn(e,this,null,t,i);return this.roots[n.id]=n,n}owner(e,t){let i,n=u.closestViewEl(e);return n?i=this.getViewByEl(n):i=this.main,i&&t?t(i):i}withinOwners(e,t){this.owner(e,i=>t(i,e))}getViewByEl(e){let t=e.getAttribute(ce);return me(this.getRootById(t),i=>i.getDescendentByEl(e))}getRootById(e){return this.roots[e]}destroyAllViews(){for(let e in this.roots)this.roots[e].destroy(),delete this.roots[e];this.main=null}destroyViewByEl(e){let t=this.getRootById(e.getAttribute(ce));t&&t.id===e.id?(t.destroy(),delete this.roots[t.id]):t&&t.destroyDescendent(e.id)}getActiveElement(){return document.activeElement}dropActiveElement(e){this.prevActive&&e.ownsElement(this.prevActive)&&(this.prevActive=null)}restorePreviouslyActiveFocus(){this.prevActive&&this.prevActive!==document.body&&this.prevActive instanceof HTMLElement&&this.prevActive.focus()}blurActiveElement(){this.prevActive=this.getActiveElement(),this.prevActive!==document.body&&this.prevActive instanceof HTMLElement&&this.prevActive.blur()}bindTopLevelEvents({dead:e}={}){this.boundTopLevelEvents||(this.boundTopLevelEvents=!0,this.serverCloseRef=this.socket.onClose(t=>{if(t&&t.code===1e3&&this.main)return this.reloadWithJitter(this.main)}),document.body.addEventListener("click",function(){}),window.addEventListener("pageshow",t=>{t.persisted&&(this.getSocket().disconnect(),this.withPageLoading({to:window.location.href,kind:"redirect"}),window.location.reload())},!0),e||this.bindNav(),this.bindClicks(),e||this.bindForms(),this.bind({keyup:"keyup",keydown:"keydown"},(t,i,n,s,o,r)=>{let a=s.getAttribute(this.binding(sn)),l=t.key&&t.key.toLowerCase();if(a&&a.toLowerCase()!==l)return;let c=N({key:t.key},this.eventMeta(i,t,s));k.exec(t,i,o,n,s,["push",{data:c}])}),this.bind({blur:"focusout",focus:"focusin"},(t,i,n,s,o,r)=>{if(!r){let a=N({key:t.key},this.eventMeta(i,t,s));k.exec(t,i,o,n,s,["push",{data:a}])}}),this.bind({blur:"blur",focus:"focus"},(t,i,n,s,o,r)=>{if(r==="window"){let a=this.eventMeta(i,t,s);k.exec(t,i,o,n,s,["push",{data:a}])}}),this.on("dragover",t=>t.preventDefault()),this.on("drop",t=>{t.preventDefault();let i=me(Me(t.target,this.binding(Nt)),o=>o.getAttribute(this.binding(Nt))),n=i&&document.getElementById(i),s=Array.from(t.dataTransfer.files||[]);!n||!(n instanceof HTMLInputElement)||n.disabled||s.length===0||!(n.files instanceof FileList)||(O.trackFiles(n,s,t.dataTransfer),n.dispatchEvent(new Event("input",{bubbles:!0})))}),this.on(ui,t=>{let i=t.target;if(!u.isUploadInput(i))return;let n=Array.from(t.detail.files||[]).filter(s=>s instanceof File||s instanceof Blob);O.trackFiles(i,n),i.dispatchEvent(new Event("input",{bubbles:!0}))}))}eventMeta(e,t,i){let n=this.metadataCallbacks[e];return n?n(t,i):{}}setPendingLink(e){return this.linkRef++,this.pendingLink=e,this.resetReloadStatus(),this.linkRef}resetReloadStatus(){H.deleteCookie(Vt)}commitPendingLink(e){return this.linkRef!==e?!1:(this.href=this.pendingLink,this.pendingLink=null,!0)}getHref(){return this.href}hasPendingLink(){return!!this.pendingLink}bind(e,t){for(let i in e){let n=e[i];this.on(n,s=>{let o=this.binding(i),r=this.binding(`window-${i}`),a=s.target.getAttribute&&s.target.getAttribute(o);a?this.debounce(s.target,s,n,()=>{this.withinOwners(s.target,l=>{t(s,i,l,s.target,a,null)})}):u.all(document,`[${r}]`,l=>{let c=l.getAttribute(r);this.debounce(l,s,n,()=>{this.withinOwners(l,h=>{t(s,i,h,l,c,"window")})})})})}}bindClicks(){this.on("mousedown",e=>this.clickStartedAtTarget=e.target),this.bindClick("click","click")}bindClick(e,t){let i=this.binding(t);window.addEventListener(e,n=>{let s=null;n.detail===0&&(this.clickStartedAtTarget=n.target);let o=this.clickStartedAtTarget||n.target;s=Me(n.target,i),this.dispatchClickAway(n,o),this.clickStartedAtTarget=null;let r=s&&s.getAttribute(i);if(!r){u.isNewPageClick(n,window.location)&&this.unload();return}s.getAttribute("href")==="#"&&n.preventDefault(),!s.hasAttribute(W)&&this.debounce(s,n,"click",()=>{this.withinOwners(s,a=>{k.exec(n,"click",r,a,s,["push",{data:this.eventMeta("click",n,s)}])})})},!1)}dispatchClickAway(e,t){let i=this.binding("click-away");u.all(document,`[${i}]`,n=>{n.isSameNode(t)||n.contains(t)||this.withinOwners(n,s=>{let o=n.getAttribute(i);k.isVisible(n)&&k.isInViewport(n)&&k.exec(e,"click",o,s,n,["push",{data:this.eventMeta("click",e,e.target)}])})})}bindNav(){if(!H.canPushState())return;history.scrollRestoration&&(history.scrollRestoration="manual");let e=null;window.addEventListener("scroll",t=>{clearTimeout(e),e=setTimeout(()=>{H.updateCurrentState(i=>Object.assign(i,{scroll:window.scrollY}))},100)}),window.addEventListener("popstate",t=>{if(!this.registerNewLocation(window.location))return;let{type:i,backType:n,id:s,scroll:o,position:r}=t.state||{},a=window.location.href,l=r>this.currentHistoryPosition,c=l?i:n||i;this.currentHistoryPosition=r||0,this.sessionStorage.setItem(Ve,this.currentHistoryPosition.toString()),u.dispatchEvent(window,"phx:navigate",{detail:{href:a,patch:c==="patch",pop:!0,direction:l?"forward":"backward"}}),this.requestDOMUpdate(()=>{let h=()=>{this.maybeScroll(o)};this.main.isConnected()&&c==="patch"&&s===this.main.id?this.main.pushLinkPatch(t,a,null,h):this.replaceMain(a,null,h)})},!1),window.addEventListener("click",t=>{let i=Me(t.target,ut),n=i&&i.getAttribute(ut);if(!n||!this.isConnected()||!this.main||u.wantsNewTab(t))return;let s=i.href instanceof SVGAnimatedString?i.href.baseVal:i.href,o=i.getAttribute(Gi);t.preventDefault(),t.stopImmediatePropagation(),this.pendingLink!==s&&this.requestDOMUpdate(()=>{if(n==="patch")this.pushHistoryPatch(t,s,o,i);else if(n==="redirect")this.historyRedirect(t,s,o,null,i);else throw new Error(`expected ${ut} to be "patch" or "redirect", got: ${n}`);let r=i.getAttribute(this.binding("click"));r&&this.requestDOMUpdate(()=>this.execJS(i,r,"click"))})},!1)}maybeScroll(e){typeof e=="number"&&requestAnimationFrame(()=>{window.scrollTo(0,e)})}dispatchEvent(e,t={}){u.dispatchEvent(window,`phx:${e}`,{detail:t})}dispatchEvents(e){e.forEach(([t,i])=>this.dispatchEvent(t,i))}withPageLoading(e,t){u.dispatchEvent(window,"phx:page-loading-start",{detail:e});let i=()=>u.dispatchEvent(window,"phx:page-loading-stop",{detail:e});return t?t(i):i}pushHistoryPatch(e,t,i,n){if(!this.isConnected()||!this.main.isMain())return H.redirect(t);this.withPageLoading({to:t,kind:"patch"},s=>{this.main.pushLinkPatch(e,t,n,o=>{this.historyPatch(t,i,o),s()})})}historyPatch(e,t,i=this.setPendingLink(e)){this.commitPendingLink(i)&&(this.currentHistoryPosition++,this.sessionStorage.setItem(Ve,this.currentHistoryPosition.toString()),H.updateCurrentState(n=>he(N({},n),{backType:"patch"})),H.pushState(t,{type:"patch",id:this.main.id,position:this.currentHistoryPosition},e),u.dispatchEvent(window,"phx:navigate",{detail:{patch:!0,href:e,pop:!1,direction:"forward"}}),this.registerNewLocation(window.location))}historyRedirect(e,t,i,n,s){let o=s&&e.isTrusted&&e.type!=="popstate";if(o&&s.classList.add("phx-click-loading"),!this.isConnected()||!this.main.isMain())return H.redirect(t,n);if(/^\/$|^\/[^\/]+.*$/.test(t)){let{protocol:a,host:l}=window.location;t=`${a}//${l}${t}`}let r=window.scrollY;this.withPageLoading({to:t,kind:"redirect"},a=>{this.replaceMain(t,n,l=>{l===this.linkRef&&(this.currentHistoryPosition++,this.sessionStorage.setItem(Ve,this.currentHistoryPosition.toString()),H.updateCurrentState(c=>he(N({},c),{backType:"redirect"})),H.pushState(i,{type:"redirect",id:this.main.id,scroll:r,position:this.currentHistoryPosition},t),u.dispatchEvent(window,"phx:navigate",{detail:{href:t,patch:!1,pop:!1,direction:"forward"}}),this.registerNewLocation(window.location)),o&&s.classList.remove("phx-click-loading"),a()})})}registerNewLocation(e){let{pathname:t,search:i}=this.currentLocation;return t+i===e.pathname+e.search?!1:(this.currentLocation=et(e),!0)}bindForms(){let e=0,t=!1;this.on("submit",i=>{let n=i.target.getAttribute(this.binding("submit")),s=i.target.getAttribute(this.binding("change"));!t&&s&&!n&&(t=!0,i.preventDefault(),this.withinOwners(i.target,o=>{o.disableForm(i.target),window.requestAnimationFrame(()=>{u.isUnloadableFormSubmit(i)&&this.unload(),i.target.submit()})}))}),this.on("submit",i=>{let n=i.target.getAttribute(this.binding("submit"));if(!n){u.isUnloadableFormSubmit(i)&&this.unload();return}i.preventDefault(),i.target.disabled=!0,this.withinOwners(i.target,s=>{k.exec(i,"submit",n,s,i.target,["push",{submitter:i.submitter}])})});for(let i of["change","input"])this.on(i,n=>{if(n instanceof CustomEvent&&(n.target instanceof HTMLInputElement||n.target instanceof HTMLSelectElement||n.target instanceof HTMLTextAreaElement)&&n.target.form===void 0){if(n.detail&&n.detail.dispatcher)throw new Error(`dispatching a custom ${i} event is only supported on input elements inside a form`);return}let s=this.binding("change"),o=n.target;if(this.blockPhxChangeWhileComposing&&n.isComposing){let m=`composition-listener-${i}`;u.private(o,m)||(u.putPrivate(o,m,!0),o.addEventListener("compositionend",()=>{o.dispatchEvent(new Event(i,{bubbles:!0})),u.deletePrivate(o,m)},{once:!0}));return}let r=o.getAttribute(s),a=o.form&&o.form.getAttribute(s),l=r||a;if(!l||o.type==="number"&&o.validity&&o.validity.badInput)return;let c=r?o:o.form,h=e;e++;let{at:f,type:g}=u.private(o,"prev-iteration")||{};f===h-1&&i==="change"&&g==="input"||(u.putPrivate(o,"prev-iteration",{at:h,type:i}),this.debounce(o,n,i,()=>{this.withinOwners(c,m=>{u.putPrivate(o,tt,!0),k.exec(n,"change",l,m,o,["push",{_target:n.target.name,dispatcher:c}])})}))});this.on("reset",i=>{let n=i.target;u.resetForm(n);let s=Array.from(n.elements).find(o=>o.type==="reset");s&&window.requestAnimationFrame(()=>{s.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!1}))})})}debounce(e,t,i,n){if(i==="blur"||i==="focusout")return n();let s=this.binding(en),o=this.binding(tn),r=this.defaults.debounce.toString(),a=this.defaults.throttle.toString();this.withinOwners(e,l=>{let c=()=>!l.isDestroyed()&&document.body.contains(e);u.debounce(e,t,s,r,o,a,c,()=>{n()})})}silenceEvents(e){this.silenced=!0,e(),this.silenced=!1}on(e,t){this.boundEventNames.add(e),window.addEventListener(e,i=>{this.silenced||t(i)})}jsQuerySelectorAll(e,t,i){let n=this.domCallbacks.jsQuerySelectorAll;return n?n(e,t,i):i()}},Vn=class{constructor(){this.transitions=new Set,this.promises=new Set,this.pendingOps=[]}reset(){this.transitions.forEach(e=>{clearTimeout(e),this.transitions.delete(e)}),this.promises.clear(),this.flushPendingOps()}after(e){this.size()===0?e():this.pushPendingOp(e)}addTransition(e,t,i){t();let n=setTimeout(()=>{this.transitions.delete(n),i(),this.flushPendingOps()},e);this.transitions.add(n)}addAsyncTransition(e){this.promises.add(e),e.then(()=>{this.promises.delete(e),this.flushPendingOps()})}pushPendingOp(e){this.pendingOps.push(e)}size(){return this.transitions.size+this.promises.size}flushPendingOps(){if(this.size()>0)return;let e=this.pendingOps.shift();e&&(e(),this.flushPendingOps())}},Ti=Jn;var ot=Mi(Si()),ki={};ki.TeamMap={mounted(){console.log("TeamMap hook mounted!");let e=this.el.dataset.apiKey,t=JSON.parse(this.el.dataset.users);console.log("API Key:",e),console.log("Users:",t),console.log("Container element:",this.el);let i;try{i=new maplibregl.Map({container:this.el,style:`https://api.maptiler.com/maps/streets/style.json?key=${e}`,center:[0,20],zoom:1.5,projection:"mercator"}),console.log("Map initialized successfully:",i),this.map=i}catch(n){console.error("Error initializing map:",n);return}i.on("load",()=>{this.addTimezoneOverlay(i),this.addSunlightOverlay(i),t.forEach(n=>{let s=this.getCityFromCoordinates(n.latitude,n.longitude)||n.country,o=document.createElement("div");o.className="team-marker-pin",o.innerHTML=`
          <div class="relative flex flex-col items-center">
            <!-- Avatar Pin -->
            <div class="relative">
              <img 
                src="${n.profile_picture}" 
                alt="${n.name}" 
                class="w-12 h-12 rounded-full border-3 border-white shadow-lg object-cover cursor-pointer transition-all duration-200 hover:scale-110 hover:border-blue-400"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
              />
              <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full border-3 border-white shadow-lg flex items-center justify-center cursor-pointer transition-all duration-200 hover:scale-110 hover:border-blue-400" style="display: none;">
                <span class="text-white font-bold text-lg">
                  ${n.name.charAt(0)}
                </span>
              </div>
            </div>
            
            <!-- City Name -->
            <div class="mt-1 bg-white px-2 py-1 rounded shadow-md text-xs font-medium text-gray-800 whitespace-nowrap">
              ${s}
            </div>
            
            <!-- Hidden expandable card for hover -->
            <div class="team-card-expanded absolute bottom-full mb-2 bg-white rounded-lg shadow-xl border border-gray-200 p-4 min-w-64 opacity-0 invisible transition-all duration-300 transform scale-95 z-50">
              <div class="flex items-center space-x-3 mb-3">
                <!-- Avatar -->
                <div class="flex-shrink-0">
                  <img 
                    src="${n.profile_picture}" 
                    alt="${n.name}" 
                    class="w-14 h-14 rounded-full shadow-md object-cover"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                  />
                  <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-md" style="display: none;">
                    <span class="text-white font-bold text-xl">
                      ${n.name.charAt(0)}
                    </span>
                  </div>
                </div>
                
                <!-- User Info -->
                <div class="flex-1 min-w-0">
                  <div class="text-base font-semibold text-gray-900 truncate">
                    ${n.name}
                  </div>
                  <div class="text-sm text-gray-600 truncate">
                    ${n.role}
                  </div>
                  <div class="text-sm text-gray-500 mt-1">
                    ${s}
                  </div>
                </div>
              </div>
              
              <!-- Detailed Info -->
              <div class="space-y-2 text-xs">
                <div>
                  <span class="font-medium text-gray-700">Working Hours:</span>
                  <span class="text-gray-600">${n.work_start} - ${n.work_end}</span>
                </div>
                <div>
                  <span class="font-medium text-gray-700">Timezone:</span>
                  <span class="text-gray-600">${n.timezone}</span>
                </div>
                ${n.pronouns?`
                <div>
                  <span class="font-medium text-gray-700">Pronouns:</span>
                  <span class="text-gray-600">${n.pronouns}</span>
                </div>
                `:""}
              </div>
              
              <!-- Arrow pointing to pin -->
              <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-8 border-r-8 border-t-8 border-l-transparent border-r-transparent border-t-white"></div>
            </div>
          </div>
        `,new maplibregl.Marker({element:o,anchor:"bottom"}).setLngLat([n.longitude,n.latitude]).addTo(i);let r=o.querySelector(".team-card-expanded"),a;o.addEventListener("mouseenter",()=>{clearTimeout(a),r.classList.remove("opacity-0","invisible","scale-95"),r.classList.add("opacity-100","visible","scale-100")}),o.addEventListener("mouseleave",()=>{a=setTimeout(()=>{r.classList.add("opacity-0","invisible","scale-95"),r.classList.remove("opacity-100","visible","scale-100")},100)}),o.addEventListener("click",()=>{this.pushEvent("show_profile",{user_id:n.id})})}),i.addControl(new maplibregl.NavigationControl,"bottom-right"),i.addControl(new maplibregl.ScaleControl({maxWidth:100,unit:"metric"}),"bottom-left")}),window.addEventListener("phx:show-profile",n=>{this.pushEvent("show_profile",{user_id:n.detail.userId})})},getCityFromCoordinates(e,t){let i=[{lat:40.7128,lng:-74.006,city:"New York"},{lat:34.0522,lng:-118.2437,city:"Los Angeles"},{lat:41.8781,lng:-87.6298,city:"Chicago"},{lat:29.7604,lng:-95.3698,city:"Houston"},{lat:33.4484,lng:-112.074,city:"Phoenix"},{lat:39.9526,lng:-75.1652,city:"Philadelphia"},{lat:29.4241,lng:-98.4936,city:"San Antonio"},{lat:32.7767,lng:-96.797,city:"Dallas"},{lat:37.3382,lng:-121.8863,city:"San Jose"},{lat:30.2672,lng:-97.7431,city:"Austin"},{lat:43.6532,lng:-79.3832,city:"Toronto"},{lat:45.5017,lng:-73.5673,city:"Montreal"},{lat:49.2827,lng:-123.1207,city:"Vancouver"},{lat:51.0447,lng:-114.0719,city:"Calgary"},{lat:53.5461,lng:-113.4938,city:"Edmonton"},{lat:45.4215,lng:-75.6972,city:"Ottawa"},{lat:51.5074,lng:-.1278,city:"London"},{lat:53.4808,lng:-2.2426,city:"Manchester"},{lat:55.9533,lng:-3.1883,city:"Edinburgh"},{lat:53.3498,lng:-6.2603,city:"Dublin"},{lat:52.52,lng:13.405,city:"Berlin"},{lat:48.8566,lng:2.3522,city:"Paris"},{lat:41.9028,lng:12.4964,city:"Rome"},{lat:40.4168,lng:-3.7038,city:"Madrid"},{lat:52.3676,lng:4.9041,city:"Amsterdam"},{lat:47.3769,lng:8.5417,city:"Zurich"},{lat:48.2082,lng:16.3738,city:"Vienna"},{lat:50.0755,lng:14.4378,city:"Prague"},{lat:59.3293,lng:18.0686,city:"Stockholm"},{lat:60.1699,lng:24.9384,city:"Helsinki"},{lat:55.6761,lng:12.5683,city:"Copenhagen"},{lat:59.9139,lng:10.7522,city:"Oslo"},{lat:35.6762,lng:139.6503,city:"Tokyo"},{lat:37.5665,lng:126.978,city:"Seoul"},{lat:39.9042,lng:116.4074,city:"Beijing"},{lat:31.2304,lng:121.4737,city:"Shanghai"},{lat:22.3193,lng:114.1694,city:"Hong Kong"},{lat:1.3521,lng:103.8198,city:"Singapore"},{lat:28.6139,lng:77.209,city:"New Delhi"},{lat:19.076,lng:72.8777,city:"Mumbai"},{lat:13.7563,lng:100.5018,city:"Bangkok"},{lat:-6.2088,lng:106.8456,city:"Jakarta"},{lat:14.5995,lng:120.9842,city:"Manila"},{lat:-33.8688,lng:151.2093,city:"Sydney"},{lat:-37.8136,lng:144.9631,city:"Melbourne"},{lat:-27.4698,lng:153.0251,city:"Brisbane"},{lat:-31.9505,lng:115.8605,city:"Perth"},{lat:-34.9285,lng:138.6007,city:"Adelaide"},{lat:-36.8485,lng:174.7633,city:"Auckland"},{lat:-41.2865,lng:174.7762,city:"Wellington"},{lat:-23.5505,lng:-46.6333,city:"S\xE3o Paulo"},{lat:-22.9068,lng:-43.1729,city:"Rio de Janeiro"},{lat:-34.6037,lng:-58.3816,city:"Buenos Aires"},{lat:-33.4489,lng:-70.6693,city:"Santiago"},{lat:4.711,lng:-74.0721,city:"Bogot\xE1"},{lat:-12.0464,lng:-77.0428,city:"Lima"},{lat:30.0444,lng:31.2357,city:"Cairo"},{lat:-26.2041,lng:28.0473,city:"Johannesburg"},{lat:-33.9249,lng:18.4241,city:"Cape Town"},{lat:6.5244,lng:3.3792,city:"Lagos"},{lat:-1.2921,lng:36.8219,city:"Nairobi"},{lat:25.2048,lng:55.2708,city:"Dubai"},{lat:31.7683,lng:35.2137,city:"Jerusalem"},{lat:33.8938,lng:35.5018,city:"Beirut"},{lat:35.6892,lng:51.389,city:"Tehran"}],n=null,s=1/0;return i.forEach(o=>{let r=Math.sqrt(Math.pow(e-o.lat,2)+Math.pow(t-o.lng,2));r<s&&r<1&&(s=r,n=o.city)}),n},addTimezoneOverlay(e){console.log("\u{1F30D} Loading timezone overlay from reliable CDN sources..."),this.loadTimezoneFromReliableCDN(e)},async loadTimezoneFromReliableCDN(e){var n,s,o;console.log("\u{1F310} Loading timezone boundaries from reliable CDN sources...");let t=["https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world_timezone.geojson","https://data.geocode.earth/boundary/timezone/timezone.geojson","https://cdn.jsdelivr.net/npm/world-atlas@3/world/50m.json","https://unpkg.com/world-atlas@2/world/50m.json","https://raw.githubusercontent.com/evansiroky/timezone-boundary-builder/master/timezones.geojson","https://raw.githubusercontent.com/evansiroky/timezone-boundary-builder/master/dist/timezones.geojson","https://raw.githubusercontent.com/evansiroky/timezone-boundary-builder/master/releases/2024b/timezones.geojson","https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_10m_time_zones.geojson","https://cdn.jsdelivr.net/npm/world-atlas@2/world/110m.json","https://cdn.jsdelivr.net/gh/evansiroky/timezone-boundary-builder@master/timezones.geojson"],i=null;for(let r of t)try{console.log(`\u{1F504} Attempting to load timezone data from: ${r}`);let a=r.includes("?")?`${r}&t=${Date.now()}`:`${r}?t=${Date.now()}`,l=await fetch(a,{method:"GET",mode:"cors"});if(l.ok){let c=l.headers.get("content-type")||"";console.log(`\u{1F4C4} Content-Type: ${c} from ${r}`);try{let h=await l.json();if(console.log(`\u{1F4CA} Data structure from ${r}:`,{type:h.type,featuresCount:(n=h.features)==null?void 0:n.length,firstFeatureProps:(o=(s=h.features)==null?void 0:s[0])!=null&&o.properties?Object.keys(h.features[0].properties):[]}),h&&h.features&&Array.isArray(h.features)&&h.features.length>0){let f=h.features[0];if(f.properties&&(f.properties.tzid||f.properties.TZID||f.properties.tz||f.properties.time_zone||f.properties.zone||f.properties.timezone||f.properties.ZONE||f.properties.NAME||f.properties.name)||h.features.length>50){i=h,console.log(`\u2705 Successfully loaded ${h.features.length} geographic boundaries from: ${r}`);break}else console.warn(`\u26A0\uFE0F Data from ${r} lacks geographic identifiers:`,Object.keys(f.properties||{}))}else h&&h.objects?(console.log(`\u{1F5FA}\uFE0F TopoJSON data detected from ${r}, converting...`),console.warn("\u26A0\uFE0F TopoJSON format not yet supported, trying next source...")):console.warn(`\u26A0\uFE0F Invalid GeoJSON structure from ${r}:`,{hasFeatures:!!h.features,featuresType:typeof h.features,dataKeys:Object.keys(h||{})})}catch(h){console.warn(`\u26A0\uFE0F JSON parse error from ${r}:`,h.message)}}else console.warn(`\u274C HTTP ${l.status} ${l.statusText} from ${r}`)}catch(a){console.warn(`\u274C Failed to load from ${r}:`,a.message);continue}i?(console.log("\u{1F3AF} Creating timezone regions from reliable CDN data..."),await this.createOfficialTimezoneRegions(e,i)):(console.error("\u274C All reliable CDN sources failed. Falling back to static regions."),await this.createStaticTimezoneRegions(e))},loadTimezoneRegionsFromBackend(e){console.log("\u{1F4CD} Using timezone regions from backend...");let t=document.getElementById("map-container");if(!t){console.error("Map container not found");return}let i=t.getAttribute("data-timezone-regions");if(!i){console.error("No timezone regions data found in data attribute");return}let n;try{n=JSON.parse(i),console.log(`\u2705 Loaded ${n.length} timezone regions from backend`)}catch(o){console.error("Failed to parse timezone regions data:",o);return}let s=this.getTimezoneColors();n.forEach((o,r)=>{let a=`backend-timezone-${r}`,l=`backend-timezone-layer-${r}`,c=`backend-timezone-border-${r}`,h=`backend-timezone-hover-${r}`,f=this.getColorForOffset(o.offset,s),g={type:"Feature",geometry:{type:"Polygon",coordinates:[o.coordinates]},properties:{timezone:o.timezone,name:o.name,offset:o.offset}};console.log(`Adding ${o.name} (${o.timezone}) with UTC${o.offset>=0?"+":""}${o.offset}`),e.addSource(a,{type:"geojson",data:g}),e.addLayer({id:l,type:"fill",source:a,paint:{"fill-color":f,"fill-opacity":.4}}),e.addLayer({id:h,type:"fill",source:a,paint:{"fill-color":f,"fill-opacity":.8},layout:{visibility:"none"}}),e.addLayer({id:c,type:"line",source:a,paint:{"line-color":f.replace("0.3","0.9"),"line-width":2,"line-opacity":.9}}),e.on("mouseenter",l,()=>{e.getCanvas().style.cursor="pointer",e.setLayoutProperty(h,"visibility","visible")}),e.on("mouseleave",l,()=>{e.getCanvas().style.cursor="",e.setLayoutProperty(h,"visibility","none")}),e.on("click",l,m=>{if(!this.shouldShowTimezonePopup(e,m))return;let d=this.getCurrentTimeInTimezone(o.timezone);new maplibregl.Popup().setLngLat(m.lngLat).setHTML(`
            <div class="p-3">
              <div class="font-semibold text-gray-900">${o.name}</div>
              <div class="text-xs text-gray-600 mt-1">UTC ${o.offset>=0?"+":""}${o.offset}</div>
              <div class="text-xs text-gray-500 mt-1">${o.timezone}</div>
              <div class="text-xs text-gray-700 mt-1">Current time: ${d}</div>
              <div class="text-xs text-gray-500 mt-2">Timezone boundaries</div>
            </div>
          `).addTo(e)})}),console.log(`\u2705 Added ${n.length} timezone regions from backend with hover effects!`)},async loadPreciseTimezonesBoundaries(e){try{console.log("Loading precise timezone boundaries from timezone-boundary-builder...");let t=["https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson"],i=null;for(let n of t)try{console.log(`Attempting to load timezone data from: ${n}`);let s=await fetch(n,{headers:{Accept:"application/json","User-Agent":"Mozilla/5.0 (compatible; Timezone Map)"},mode:"cors"});if(s.ok){let o=await s.json();if(o&&o.features&&o.features.length>0){console.log(`\u2705 Successfully loaded ${o.features.length} country boundaries from: ${n}`),console.log("Sample country:",o.features[0].properties.NAME||o.features[0].properties.name),await this.createTimezoneRegionsFromWorldBoundaries(e,o);return}else console.warn(`\u274C Invalid or empty data from ${n}`)}else console.warn(`\u274C HTTP ${s.status} from ${n}`)}catch(s){console.warn(`\u274C Failed to load from ${n}:`,s.message);continue}throw console.error("\u274C All timezone data sources failed, falling back to administrative boundaries"),new Error("All timezone data sources failed")}catch(t){console.error("Failed to load precise timezone boundaries:",t),await this.loadRealisticTimezoneShapes(e)}},async loadRealisticTimezoneShapes(e){console.log("\u{1F30D} Loading official timezone boundaries that follow administrative borders...");try{let t=["https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world_timezone.geojson","https://raw.githubusercontent.com/evansiroky/timezone-boundary-builder/master/dist/timezones.geojson","https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_50m_time_zones.geojson","https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/DATA/world_timezone.geojson"],i=null;for(let n of t)try{console.log(`\u{1F504} Attempting to load official timezone boundaries from: ${n}`);let s=await fetch(n,{headers:{Accept:"application/json","User-Agent":"Mozilla/5.0 (compatible; TimezoneMap/1.0)","Cache-Control":"no-cache",Pragma:"no-cache"},cache:"no-cache"});if(s.ok){let o=await s.json();if(o&&o.features&&o.features.length>0){let r=o.features[0];if(r.properties&&(r.properties.tzid||r.properties.TZID||r.properties.tz||r.properties.time_zone||r.properties.timezone||r.properties.tz_name1st||r.properties.zone||r.properties.ZONE)){i=o,console.log(`\u2705 Successfully loaded ${o.features.length} official timezone boundaries from: ${n}`);break}else console.warn(`\u274C Data from ${n} lacks timezone identifiers`)}}else console.warn(`\u274C HTTP ${s.status} from ${n}`)}catch(s){console.warn(`\u274C Failed to load from ${n}:`,s.message);continue}i?await this.createOfficialTimezoneRegions(e,i):(console.error("\u274C All official timezone sources failed, using reliable country-based fallback"),await this.createTimezoneRegionsFromWorldBoundaries(e,null))}catch(t){console.error("Failed to load official timezone boundaries:",t),await this.loadAdministrativeTimezones(e)}},async createOfficialTimezoneRegions(e,t){console.log("\u{1F5FA}\uFE0F Creating timezone regions from official boundary data with state-line precision...");let i=this.getTimezoneColors(),n={};t.features.forEach(s=>{let o=s.properties.tzid||s.properties.TZID||s.properties.tz||s.properties.time_zone||s.properties.timezone||s.properties.tz_name1st||s.properties.zone||s.properties.ZONE;if(!o){console.warn("Timezone feature missing identifier:",s.properties);return}let r=new Date,a=this.getTimezoneOffset(o,r),l=Math.floor(a).toString();n[l]||(n[l]={features:[],offset:Math.floor(a),color:this.getColorForOffset(Math.floor(a),i),timezones:[]}),s.properties.tzid=o,n[l].features.push(s),n[l].timezones.includes(o)||n[l].timezones.push(o)}),console.log(`Processing ${Object.keys(n).length} timezone offset groups...`),Object.keys(n).forEach(s=>{let o=n[s],r=o.offset,a=`official-timezone-${s.replace(".","_").replace("-","neg")}`,l=`official-timezone-layer-${s.replace(".","_").replace("-","neg")}`,c=`official-timezone-border-${s.replace(".","_").replace("-","neg")}`,h=`official-timezone-hover-${s.replace(".","_").replace("-","neg")}`,f=o.color,g={type:"FeatureCollection",features:o.features};console.log(`Adding UTC${r>=0?"+":""}${r} timezone region with ${o.features.length} zones: ${o.timezones.slice(0,3).join(", ")}${o.timezones.length>3?"...":""}`),e.addSource(a,{type:"geojson",data:g}),e.addLayer({id:l,type:"fill",source:a,paint:{"fill-color":f,"fill-opacity":.4}}),e.addLayer({id:h,type:"fill",source:a,paint:{"fill-color":f,"fill-opacity":.8},layout:{visibility:"none"}}),e.addLayer({id:c,type:"line",source:a,paint:{"line-color":"#ffffff","line-width":3,"line-opacity":.8}}),e.addLayer({id:`${c}-inner`,type:"line",source:a,paint:{"line-color":"#000000","line-width":1,"line-opacity":.6}});let m=`official-timezone-label-${s.replace(".","_").replace("-","neg")}`;e.addLayer({id:m,type:"symbol",source:a,layout:{"text-field":r>=0?`+${r}`:`${r}`,"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":16,"text-anchor":"top","text-offset":[0,.5],"text-allow-overlap":!0,"text-ignore-placement":!0,"symbol-placement":"point","symbol-sort-key":1},paint:{"text-color":"#1a1a1a","text-halo-color":"#ffffff","text-halo-width":2,"text-opacity":1},filter:["==",["geometry-type"],"Polygon"]}),e.on("mousemove",l,d=>{if(e.getCanvas().style.cursor="pointer",d.features&&d.features.length>0){let y=d.features[0].properties.tzid;try{e.setFilter(h,["==",["get","tzid"],y]),e.setLayoutProperty(h,"visibility","visible")}catch(v){console.warn("Failed to show hover highlight:",v)}}}),e.on("mouseleave",l,()=>{e.getCanvas().style.cursor="";try{e.setLayoutProperty(h,"visibility","none")}catch(d){console.warn("Failed to hide hover highlight:",d)}}),e.on("click",l,d=>{if(!this.shouldShowTimezonePopup(e,d))return;let y=e.queryRenderedFeatures(d.point,{layers:[l]});if(y.length>0){let E=y[0].properties.tzid||"Unknown",L=this.getCurrentTimeInTimezone(E);new maplibregl.Popup().setLngLat(d.lngLat).setHTML(`
              <div class="p-3">
                <div class="font-semibold text-gray-900">${E}</div>
                <div class="text-xs text-gray-600 mt-1">UTC ${r>=0?"+":""}${r}</div>
                <div class="text-xs text-gray-700 mt-1">Current time: ${L}</div>
                <div class="text-xs text-gray-500 mt-2">Official administrative boundaries</div>
              </div>
            `).addTo(e)}})}),console.log(`\u2705 Added ${Object.keys(n).length} official timezone regions with administrative border precision!`),this.debugMapLayers(e)},debugMapLayers(e){console.log("\u{1F5FA}\uFE0F DEBUG: All map layers:");let t=e.getStyle();t&&t.layers?t.layers.forEach((i,n)=>{var s;console.log(`  ${n}: ${i.id} (${i.type}) - visible: ${((s=i.layout)==null?void 0:s.visibility)!=="none"}`)}):console.log("  No layers found in map style")},async createStaticTimezoneRegions(e){console.log("\u{1F3D4}\uFE0F Creating static timezone regions as ultimate fallback...");let t=this.getTimezoneColors(),i=[{name:"Pacific Time (US West Coast)",timezone:"America/Los_Angeles",offset:-8,coordinates:[[-124.4,32.5],[-124.4,49],[-117,49],[-117,42],[-114,39],[-114,32.5],[-124.4,32.5]]},{name:"Mountain Time (US Mountain)",timezone:"America/Denver",offset:-7,coordinates:[[-117,32.5],[-117,49],[-104,49],[-104,37],[-109,37],[-109,32.5],[-117,32.5]]},{name:"Central Time (US Central)",timezone:"America/Chicago",offset:-6,coordinates:[[-104,25.8],[-104,49],[-87.5,49],[-87.5,45.2],[-82.4,41.8],[-96.9,25.8],[-104,25.8]]},{name:"Eastern Time (US East Coast)",timezone:"America/New_York",offset:-5,coordinates:[[-87.5,24.4],[-87.5,49],[-67,49],[-67,44],[-81.4,24.4],[-87.5,24.4]]},{name:"Greenwich Mean Time (UK)",timezone:"Europe/London",offset:0,coordinates:[[-10.8,49.8],[-10.8,60.9],[2.1,60.9],[2.1,49.8],[-10.8,49.8]]},{name:"Central European Time",timezone:"Europe/Berlin",offset:1,coordinates:[[-4.8,36],[29.7,36],[29.7,71.2],[-4.8,71.2],[-4.8,36]]},{name:"China Standard Time",timezone:"Asia/Shanghai",offset:8,coordinates:[[73.5,18.2],[134.8,18.2],[134.8,53.6],[73.5,53.6],[73.5,18.2]]},{name:"Japan Standard Time",timezone:"Asia/Tokyo",offset:9,coordinates:[[129,24],[146,24],[146,46],[129,46],[129,24]]},{name:"Australian Eastern Standard Time",timezone:"Australia/Sydney",offset:10,coordinates:[[140.9,-39.2],[153.6,-39.2],[153.6,-10.7],[140.9,-10.7],[140.9,-39.2]]}];i.forEach((n,s)=>{let o=`static-timezone-${s}`,r=`static-timezone-layer-${s}`,a=`static-timezone-border-${s}`,l=`static-timezone-hover-${s}`,c=this.getColorForOffset(n.offset,t),h={type:"Feature",geometry:{type:"Polygon",coordinates:[n.coordinates]},properties:{timezone:n.timezone,name:n.name,offset:n.offset}};console.log(`Adding static region: ${n.name} (UTC${n.offset>=0?"+":""}${n.offset})`),e.addSource(o,{type:"geojson",data:h}),e.addLayer({id:r,type:"fill",source:o,paint:{"fill-color":c,"fill-opacity":.4}}),e.addLayer({id:l,type:"fill",source:o,paint:{"fill-color":c,"fill-opacity":.8},layout:{visibility:"none"}}),e.addLayer({id:a,type:"line",source:o,paint:{"line-color":"#ffffff","line-width":3,"line-opacity":.8}}),e.addLayer({id:`${a}-inner`,type:"line",source:o,paint:{"line-color":"#000000","line-width":1,"line-opacity":.6}});let f=`static-timezone-label-${s}`;e.addLayer({id:f,type:"symbol",source:o,layout:{"text-field":n.offset>=0?`+${n.offset}`:`${n.offset}`,"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":16,"text-anchor":"top","text-offset":[0,.5],"text-allow-overlap":!0,"text-ignore-placement":!0,"symbol-placement":"point"},paint:{"text-color":"#1a1a1a","text-halo-color":"#ffffff","text-halo-width":2,"text-opacity":1}}),e.on("mouseenter",r,()=>{e.getCanvas().style.cursor="pointer";try{e.setLayoutProperty(l,"visibility","visible")}catch(g){console.warn("Failed to show hover highlight:",g)}}),e.on("mouseleave",r,()=>{e.getCanvas().style.cursor="";try{e.setLayoutProperty(l,"visibility","none")}catch(g){console.warn("Failed to hide hover highlight:",g)}}),e.on("click",r,g=>{if(!this.shouldShowTimezonePopup(e,g))return;let m=this.getCurrentTimeInTimezone(n.timezone);new maplibregl.Popup().setLngLat(g.lngLat).setHTML(`
            <div class="p-3">
              <div class="font-semibold text-gray-900">${n.name}</div>
              <div class="text-xs text-gray-600 mt-1">UTC ${n.offset>=0?"+":""}${n.offset}</div>
              <div class="text-xs text-gray-500 mt-1">${n.timezone}</div>
              <div class="text-xs text-gray-700 mt-1">Current time: ${m}</div>
              <div class="text-xs text-gray-500 mt-2">Static fallback regions</div>
            </div>
          `).addTo(e)})}),console.log(`\u2705 Added ${i.length} static timezone regions as fallback!`)},async createTimezoneRegionsFromWorldBoundaries(e,t){if(console.log("\u{1F5FA}\uFE0F Creating precise timezone regions using real country boundaries..."),!t)try{console.log("Loading world country boundaries for timezone mapping...");let s=await fetch("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson",{cache:"no-cache"});if(s.ok)t=await s.json(),console.log(`\u2705 Loaded ${t.features.length} countries for timezone mapping`);else throw new Error(`Failed to load world data: ${s.status}`)}catch(s){return console.error("Failed to load world data for timezone fallback:",s),this.loadAdministrativeTimezones(e)}let i=this.getTimezoneColors(),n=[{name:"Pacific Time",timezone:"America/Los_Angeles",offset:-8,countries:["United States of America","Canada"],description:"US West Coast & Western Canada"},{name:"Mountain Time",timezone:"America/Denver",offset:-7,countries:["United States of America","Canada"],description:"US Mountain States & Mountain Canada"},{name:"Central Time",timezone:"America/Chicago",offset:-6,countries:["United States of America","Canada","Mexico"],description:"US Central States, Central Canada & Mexico"},{name:"Eastern Time",timezone:"America/New_York",offset:-5,countries:["United States of America","Canada"],description:"US Eastern States & Eastern Canada"},{name:"Greenwich Mean Time",timezone:"Europe/London",offset:0,countries:["United Kingdom"],description:"United Kingdom"},{name:"Central European Time",timezone:"Europe/Berlin",offset:1,countries:["Germany","France","Spain","Italy","Netherlands","Belgium","Poland","Czech Republic","Austria","Switzerland","Norway","Sweden","Denmark"],description:"Central Europe"},{name:"Eastern European Time",timezone:"Europe/Helsinki",offset:2,countries:["Finland","Estonia","Latvia","Lithuania","Romania","Bulgaria","Greece"],description:"Eastern Europe"},{name:"Moscow Time",timezone:"Europe/Moscow",offset:3,countries:["Russia"],description:"Western Russia"},{name:"China Standard Time",timezone:"Asia/Shanghai",offset:8,countries:["China"],description:"China"},{name:"India Standard Time",timezone:"Asia/Kolkata",offset:5.5,countries:["India"],description:"India"},{name:"Japan Standard Time",timezone:"Asia/Tokyo",offset:9,countries:["Japan"],description:"Japan"},{name:"Korea Standard Time",timezone:"Asia/Seoul",offset:9,countries:["South Korea"],description:"South Korea"},{name:"Australian Western Standard Time",timezone:"Australia/Perth",offset:8,countries:["Australia"],description:"Western Australia"},{name:"Australian Eastern Standard Time",timezone:"Australia/Sydney",offset:10,countries:["Australia"],description:"Eastern Australia"},{name:"New Zealand Standard Time",timezone:"Pacific/Auckland",offset:12,countries:["New Zealand"],description:"New Zealand"},{name:"Brazil Time",timezone:"America/Sao_Paulo",offset:-3,countries:["Brazil"],description:"Brazil"},{name:"Argentina Time",timezone:"America/Argentina/Buenos_Aires",offset:-3,countries:["Argentina"],description:"Argentina"},{name:"South Africa Standard Time",timezone:"Africa/Johannesburg",offset:2,countries:["South Africa"],description:"South Africa"}];n.forEach((s,o)=>{let r=[];if(t.features.forEach(d=>{let y=d.properties.NAME||d.properties.name||d.properties.NAME_EN;s.countries.includes(y)&&r.push(d)}),r.length===0){console.log(`No countries found for timezone region: ${s.name}`);return}let a=this.getColorForOffset(s.offset,i),l=`timezone-region-${o}`,c=`timezone-region-layer-${o}`,h=`timezone-region-border-${o}`,f=`timezone-region-hover-${o}`,g={type:"FeatureCollection",features:r};console.log(`Adding timezone region: ${s.name} (UTC${s.offset>=0?"+":""}${s.offset}) with ${r.length} countries`),e.addSource(l,{type:"geojson",data:g}),e.addLayer({id:c,type:"fill",source:l,paint:{"fill-color":a,"fill-opacity":.4}}),e.addLayer({id:f,type:"fill",source:l,paint:{"fill-color":a,"fill-opacity":.8},layout:{visibility:"none"}}),e.addLayer({id:h,type:"line",source:l,paint:{"line-color":"#ffffff","line-width":3,"line-opacity":.8}}),e.addLayer({id:`${h}-inner`,type:"line",source:l,paint:{"line-color":"#000000","line-width":1,"line-opacity":.6}});let m=`timezone-region-label-${o}`;e.addLayer({id:m,type:"symbol",source:l,layout:{"text-field":s.offset>=0?`+${s.offset}`:`${s.offset}`,"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":16,"text-anchor":"top","text-offset":[0,.5],"text-allow-overlap":!0,"text-ignore-placement":!0,"symbol-placement":"point"},paint:{"text-color":"#1a1a1a","text-halo-color":"#ffffff","text-halo-width":2,"text-opacity":1}}),e.on("mouseenter",c,()=>{e.getCanvas().style.cursor="pointer";try{e.setLayoutProperty(f,"visibility","visible")}catch(d){console.warn("Failed to show hover highlight:",d)}}),e.on("mouseleave",c,()=>{e.getCanvas().style.cursor="";try{e.setLayoutProperty(f,"visibility","none")}catch(d){console.warn("Failed to hide hover highlight:",d)}}),e.on("click",c,d=>{if(!this.shouldShowTimezonePopup(e,d))return;let y=e.queryRenderedFeatures(d.point,{layers:[c]});if(y.length>0){let v=y[0],E=v.properties.NAME||v.properties.name||"Unknown",L=this.getCurrentTimeInTimezone(s.timezone);new maplibregl.Popup().setLngLat(d.lngLat).setHTML(`
              <div class="p-3">
                <div class="font-semibold text-gray-900">${s.name}</div>
                <div class="text-xs text-gray-600 mt-1">UTC ${s.offset>=0?"+":""}${s.offset}</div>
                <div class="text-xs text-gray-500 mt-1">${s.timezone}</div>
                <div class="text-xs text-gray-700 mt-1">Current time: ${L}</div>
                <div class="text-xs text-gray-500 mt-2">Country: ${E}</div>
                <div class="text-xs text-gray-400 mt-1">${s.description}</div>
              </div>
            `).addTo(e)}})}),console.log(`\u2705 Added ${n.length} timezone regions with real country boundaries and regional hover effects!`)},async loadAdministrativeTimezones(e){console.log("Loading administrative timezone boundaries as fallback...");let t=this.getAdministrativeTimezoneRegions(),i=this.getTimezoneColors();t.forEach((n,s)=>{let o=`admin-timezone-${s}`,r=`admin-timezone-layer-${s}`,a=`admin-timezone-border-${s}`,l=`admin-timezone-hover-${s}`,c=this.getColorForOffset(n.utcOffset,i);e.addSource(o,{type:"geojson",data:{type:"Feature",geometry:n.geometry,properties:{name:n.name,utcOffset:n.utcOffset,timezoneName:n.timezoneName}}}),e.addLayer({id:r,type:"fill",source:o,paint:{"fill-color":c,"fill-opacity":.3}}),e.addLayer({id:l,type:"fill",source:o,paint:{"fill-color":c,"fill-opacity":.65},layout:{visibility:"none"}}),e.addLayer({id:a,type:"line",source:o,paint:{"line-color":c.replace("0.3","0.9"),"line-width":1.5,"line-opacity":.8}}),e.on("mouseenter",r,()=>{e.getCanvas().style.cursor="pointer",e.setLayoutProperty(l,"visibility","visible")}),e.on("mouseleave",r,()=>{e.getCanvas().style.cursor="",e.setLayoutProperty(l,"visibility","none")}),e.on("click",r,h=>{if(!this.shouldShowTimezonePopup(e,h))return;let f=this.getCurrentTimeInTimezone(n.timezoneName);new maplibregl.Popup().setLngLat(h.lngLat).setHTML(`
            <div class="p-3">
              <div class="font-semibold text-gray-900">${n.name}</div>
              <div class="text-xs text-gray-600 mt-1">UTC ${n.utcOffset>=0?"+":""}${n.utcOffset}</div>
              <div class="text-xs text-gray-500 mt-1">${n.timezoneName}</div>
              <div class="text-xs text-gray-700 mt-1">Current time: ${f}</div>
            </div>
          `).addTo(e)})}),console.log(`Added ${t.length} administrative timezone regions with hover effects`)},async loadAccurateTimezones(e){try{console.log("Loading accurate timezone boundaries from timezone-boundary-builder...");let t=["https://cdn.jsdelivr.net/npm/@timezone-boundary-builder/timezone-boundaries@latest/timezones-now.geojson","https://raw.githubusercontent.com/evansiroky/timezone-boundary-builder/master/dist/timezones-now.geojson","https://cdn.jsdelivr.net/gh/evansiroky/timezone-boundary-builder@master/dist/timezones-now.geojson","https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world_timezone.geojson"],i=null;for(let o of t)try{console.log(`Attempting to load timezone data from: ${o}`);let r=await fetch(o,{headers:{Accept:"application/json"}});if(r.ok){let a=await r.json();if(a&&a.features&&a.features.length>0){i=a,console.log(`Successfully loaded ${a.features.length} timezone boundaries from: ${o}`);break}}}catch(r){console.warn(`Failed to load from ${o}:`,r);continue}if(!i)throw new Error("All timezone data sources failed");let n=this.getTimezoneColors();console.log("Processing timezone boundaries...");let s={};i.features.forEach(o=>{let r=o.properties.tzid||o.properties.TZID||o.properties.tz_name||"Unknown",a=this.calculateCurrentUTCOffset(r);s[a]||(s[a]=[]),s[a].push({feature:o,timezoneName:r,utcOffset:a})}),Object.keys(s).forEach(o=>{let r=parseFloat(o),a=s[o],l=this.getColorForOffset(r,n),c=`timezone-offset-${o.replace(".","_").replace("-","neg")}`,h=`timezone-layer-${o.replace(".","_").replace("-","neg")}`,f=`timezone-border-${o.replace(".","_").replace("-","neg")}`,g={type:"FeatureCollection",features:a.map(m=>m.feature)};e.addSource(c,{type:"geojson",data:g}),e.addLayer({id:h,type:"fill",source:c,paint:{"fill-color":l,"fill-opacity":.3}}),e.addLayer({id:f,type:"line",source:c,paint:{"line-color":l.replace("0.3","0.8"),"line-width":.8,"line-opacity":.7}}),e.on("click",h,m=>{if(!this.shouldShowTimezonePopup(e,m))return;let d=e.queryRenderedFeatures(m.point,{layers:[h]});if(d.length>0){let y=d[0],v=y.properties.tzid||y.properties.TZID||"Unknown",E=this.getCurrentTimeInTimezone(v);new maplibregl.Popup().setLngLat(m.lngLat).setHTML(`
                <div class="p-3">
                  <div class="font-semibold text-gray-900">${v}</div>
                  <div class="text-xs text-gray-600 mt-1">UTC ${r>=0?"+":""}${r}</div>
                  <div class="text-xs text-gray-700 mt-1">Current time: ${E}</div>
                  <div class="text-xs text-gray-500 mt-1">Click for more timezone details</div>
                </div>
              `).addTo(e)}}),e.on("mouseenter",h,()=>{e.getCanvas().style.cursor="pointer"}),e.on("mouseleave",h,()=>{e.getCanvas().style.cursor=""})}),console.log("Accurate timezone overlay loaded successfully")}catch(t){await this.generateTimezoneData(e)}},async generateTimezoneData(e){let t=this.getAccurateTimezoneRegions(),i=this.getTimezoneColors();t.forEach((n,s)=>{let o=`timezone-region-${s}`,r=`timezone-layer-${s}`,a=`timezone-border-${s}`,l=this.getColorForOffset(n.utcOffset,i);e.addSource(o,{type:"geojson",data:{type:"Feature",geometry:n.geometry,properties:{name:n.name,utcOffset:n.utcOffset,timezoneName:n.timezoneName}}}),e.addLayer({id:r,type:"fill",source:o,paint:{"fill-color":l,"fill-opacity":.25}}),e.addLayer({id:a,type:"line",source:o,paint:{"line-color":l.replace("0.3","0.8"),"line-width":.5,"line-opacity":.6}}),e.on("click",r,c=>{this.shouldShowTimezonePopup(e,c)&&new maplibregl.Popup().setLngLat(c.lngLat).setHTML(`
            <div class="p-3">
              <div class="font-semibold text-gray-900">${n.name}</div>
              <div class="text-xs text-gray-600 mt-1">UTC ${n.utcOffset>=0?"+":""}${n.utcOffset}</div>
              <div class="text-xs text-gray-500 mt-1">${n.timezoneName}</div>
            </div>
          `).addTo(e)}),e.on("mouseenter",r,()=>{e.getCanvas().style.cursor="pointer"}),e.on("mouseleave",r,()=>{e.getCanvas().style.cursor=""})}),console.log("Generated timezone overlay added successfully")},getAccurateTimezoneShapes(){return[{name:"US Pacific Time",utcOffset:-8,timezoneName:"America/Los_Angeles",geometry:{type:"Polygon",coordinates:[[[-130,30],[-130,50],[-110,50],[-110,30],[-130,30]]]}},{name:"US Mountain Time",utcOffset:-7,timezoneName:"America/Denver",geometry:{type:"Polygon",coordinates:[[[-110,30],[-110,50],[-95,50],[-95,30],[-110,30]]]}},{name:"US Central Time",utcOffset:-6,timezoneName:"America/Chicago",geometry:{type:"Polygon",coordinates:[[[-95,30],[-95,50],[-80,50],[-80,30],[-95,30]]]}},{name:"US Eastern Time",utcOffset:-5,timezoneName:"America/New_York",geometry:{type:"Polygon",coordinates:[[[-80,30],[-80,50],[-65,50],[-65,30],[-80,30]]]}},{name:"Western Europe",utcOffset:0,timezoneName:"Europe/London",geometry:{type:"Polygon",coordinates:[[[-15,35],[-15,70],[5,70],[5,35],[-15,35]]]}},{name:"Central Europe",utcOffset:1,timezoneName:"Europe/Berlin",geometry:{type:"Polygon",coordinates:[[[5,35],[5,70],[25,70],[25,35],[5,35]]]}},{name:"Eastern Europe",utcOffset:2,timezoneName:"Europe/Helsinki",geometry:{type:"Polygon",coordinates:[[[25,35],[25,70],[45,70],[45,35],[25,35]]]}},{name:"Moscow Time",utcOffset:3,timezoneName:"Europe/Moscow",geometry:{type:"Polygon",coordinates:[[[45,40],[45,75],[65,75],[65,40],[45,40]]]}},{name:"Yekaterinburg Time",utcOffset:5,timezoneName:"Asia/Yekaterinburg",geometry:{type:"Polygon",coordinates:[[[65,40],[65,75],[85,75],[85,40],[65,40]]]}},{name:"China Standard Time",utcOffset:8,timezoneName:"Asia/Shanghai",geometry:{type:"Polygon",coordinates:[[[85,20],[85,55],[125,55],[125,20],[85,20]]]}},{name:"Japan Standard Time",utcOffset:9,timezoneName:"Asia/Tokyo",geometry:{type:"Polygon",coordinates:[[[125,25],[125,50],[150,50],[150,25],[125,25]]]}},{name:"Australian Eastern Time",utcOffset:10,timezoneName:"Australia/Sydney",geometry:{type:"Polygon",coordinates:[[[140,-45],[140,-10],[155,-10],[155,-45],[140,-45]]]}},{name:"Australian Central Time",utcOffset:9.5,timezoneName:"Australia/Adelaide",geometry:{type:"Polygon",coordinates:[[[125,-45],[125,-10],[140,-10],[140,-45],[125,-45]]]}},{name:"Australian Western Time",utcOffset:8,timezoneName:"Australia/Perth",geometry:{type:"Polygon",coordinates:[[[110,-45],[110,-10],[125,-10],[125,-45],[110,-45]]]}}]},getAccurateTimezoneRegions(){return[{name:"International Date Line West",utcOffset:-12,timezoneName:"Pacific/Baker_Island",geometry:{type:"Polygon",coordinates:[[[-180,-70],[-165,-70],[-165,70],[-180,70],[-180,-70]]]}},{name:"Hawaiian Time",utcOffset:-10,timezoneName:"Pacific/Honolulu",geometry:{type:"Polygon",coordinates:[[[-165,15],[-150,15],[-150,25],[-165,25],[-165,15]]]}},{name:"Alaska Time",utcOffset:-9,timezoneName:"America/Anchorage",geometry:{type:"Polygon",coordinates:[[[-180,51],[-130,51],[-130,72],[-180,72],[-180,51]]]}},{name:"Pacific Time",utcOffset:-8,timezoneName:"America/Los_Angeles",geometry:{type:"Polygon",coordinates:[[[-130,32],[-114,32],[-114,49],[-130,49],[-130,32]]]}},{name:"Mountain Time",utcOffset:-7,timezoneName:"America/Denver",geometry:{type:"Polygon",coordinates:[[[-114,31],[-104,31],[-104,49],[-114,49],[-114,31]]]}},{name:"Central Time",utcOffset:-6,timezoneName:"America/Chicago",geometry:{type:"Polygon",coordinates:[[[-104,25],[-88,25],[-88,49],[-104,49],[-104,25]]]}},{name:"Eastern Time",utcOffset:-5,timezoneName:"America/New_York",geometry:{type:"Polygon",coordinates:[[[-88,25],[-67,25],[-67,49],[-88,49],[-88,25]]]}},{name:"Brazil Time",utcOffset:-3,timezoneName:"America/Sao_Paulo",geometry:{type:"Polygon",coordinates:[[[-75,-35],[-35,-35],[-35,5],[-75,5],[-75,-35]]]}},{name:"GMT/UTC",utcOffset:0,timezoneName:"Europe/London",geometry:{type:"Polygon",coordinates:[[[-15,35],[7.5,35],[7.5,72],[-15,72],[-15,35]]]}},{name:"Central European Time",utcOffset:1,timezoneName:"Europe/Berlin",geometry:{type:"Polygon",coordinates:[[[7.5,35],[22.5,35],[22.5,72],[7.5,72],[7.5,35]]]}},{name:"Eastern European Time",utcOffset:2,timezoneName:"Europe/Helsinki",geometry:{type:"Polygon",coordinates:[[[22.5,35],[37.5,35],[37.5,72],[22.5,72],[22.5,35]]]}},{name:"East Africa Time",utcOffset:3,timezoneName:"Africa/Nairobi",geometry:{type:"Polygon",coordinates:[[[22.5,-35],[52.5,-35],[52.5,40],[22.5,40],[22.5,-35]]]}},{name:"Moscow Time",utcOffset:3,timezoneName:"Europe/Moscow",geometry:{type:"Polygon",coordinates:[[[37.5,40],[67.5,40],[67.5,72],[37.5,72],[37.5,40]]]}},{name:"Gulf Standard Time",utcOffset:4,timezoneName:"Asia/Dubai",geometry:{type:"Polygon",coordinates:[[[52.5,12],[67.5,12],[67.5,40],[52.5,40],[52.5,12]]]}},{name:"India Standard Time",utcOffset:5.5,timezoneName:"Asia/Kolkata",geometry:{type:"Polygon",coordinates:[[[67.5,8],[97.5,8],[97.5,37],[67.5,37],[67.5,8]]]}},{name:"Bangladesh Time",utcOffset:6,timezoneName:"Asia/Dhaka",geometry:{type:"Polygon",coordinates:[[[82.5,20],[97.5,20],[97.5,30],[82.5,30],[82.5,20]]]}},{name:"Southeast Asia Time",utcOffset:7,timezoneName:"Asia/Bangkok",geometry:{type:"Polygon",coordinates:[[[97.5,-10],[112.5,-10],[112.5,25],[97.5,25],[97.5,-10]]]}},{name:"China Standard Time",utcOffset:8,timezoneName:"Asia/Shanghai",geometry:{type:"Polygon",coordinates:[[[97.5,18],[135,18],[135,53],[97.5,53],[97.5,18]]]}},{name:"Japan Standard Time",utcOffset:9,timezoneName:"Asia/Tokyo",geometry:{type:"Polygon",coordinates:[[[129,30],[146,30],[146,46],[129,46],[129,30]]]}},{name:"Australian Eastern Time",utcOffset:10,timezoneName:"Australia/Sydney",geometry:{type:"Polygon",coordinates:[[[142.5,-44],[157.5,-44],[157.5,-10],[142.5,-10],[142.5,-44]]]}},{name:"Australian Central Time",utcOffset:9.5,timezoneName:"Australia/Adelaide",geometry:{type:"Polygon",coordinates:[[[127.5,-39],[142.5,-39],[142.5,-20],[127.5,-20],[127.5,-39]]]}},{name:"New Zealand Time",utcOffset:12,timezoneName:"Pacific/Auckland",geometry:{type:"Polygon",coordinates:[[[165,-48],[180,-48],[180,-34],[165,-34],[165,-48]]]}}]},getTimezoneColors(){return["rgba(255, 99, 132, 0.3)","rgba(54, 162, 235, 0.3)","rgba(255, 205, 86, 0.3)","rgba(75, 192, 192, 0.3)","rgba(153, 102, 255, 0.3)","rgba(255, 159, 64, 0.3)","rgba(199, 199, 199, 0.3)","rgba(83, 102, 255, 0.3)","rgba(255, 99, 255, 0.3)","rgba(99, 255, 132, 0.3)","rgba(255, 206, 84, 0.3)","rgba(54, 235, 162, 0.3)"]},getColorForOffset(e,t){let i=Math.floor((e+12)/2)%t.length;return t[Math.max(0,Math.min(i,t.length-1))]},getAdministrativeTimezoneRegions(){return[{name:"US Pacific Time",timezoneName:"America/Los_Angeles",utcOffset:-8,geometry:{type:"MultiPolygon",coordinates:[[[[-124.4,32.5],[-124.4,42],[-120,42],[-120,46.7],[-124.4,46.7],[-124.4,49],[-117,49],[-117,45.5],[-116.5,45.5],[-116.5,42],[-120,42],[-120,39],[-114,39],[-114,35],[-117.2,32.5],[-124.4,32.5]]],[[[-179.1,51.2],[-179.1,71.4],[-129.9,71.4],[-129.9,54.4],[-130,54.4],[-130,51.2],[-179.1,51.2]]]]}},{name:"US Mountain Time",timezoneName:"America/Denver",utcOffset:-7,geometry:{type:"Polygon",coordinates:[[[-117,32.5],[-117,37],[-114,37],[-114,42],[-116.5,42],[-116.5,45.5],[-117,45.5],[-117,49],[-104,49],[-104,37],[-109,37],[-109,32.5],[-117,32.5]]]}},{name:"US Central Time",timezoneName:"America/Chicago",utcOffset:-6,geometry:{type:"Polygon",coordinates:[[[-104,25.8],[-104,37],[-109,37],[-109,49],[-96.4,49],[-96.4,45.9],[-90.4,45.9],[-87.5,45.2],[-82.4,41.8],[-82.4,36.5],[-84.3,36.5],[-84.3,33.8],[-85.6,32.6],[-88,30.2],[-91.4,29],[-94,29.7],[-96.9,25.8],[-104,25.8]]]}},{name:"US Eastern Time",timezoneName:"America/New_York",utcOffset:-5,geometry:{type:"Polygon",coordinates:[[[-87.5,24.4],[-87.5,45.2],[-90.4,45.9],[-96.4,45.9],[-96.4,49],[-82.4,49],[-82.4,45],[-75.7,45],[-67,45],[-67,47.5],[-69.2,47.5],[-69.2,44.8],[-67.8,44.8],[-67.8,40.8],[-73.7,40.8],[-75.4,39.7],[-75.4,39.2],[-80.5,39.2],[-80.5,36.5],[-82.4,36.5],[-82.4,35],[-84.3,35],[-84.3,30.4],[-81.4,24.4],[-87.5,24.4]]]}},{name:"Canada Pacific",timezoneName:"America/Vancouver",utcOffset:-8,geometry:{type:"Polygon",coordinates:[[[-139,48.3],[-139,69.6],[-120,69.6],[-120,60],[-125,60],[-125,54.4],[-130,54.4],[-130,48.3],[-139,48.3]]]}},{name:"Canada Mountain",timezoneName:"America/Edmonton",utcOffset:-7,geometry:{type:"Polygon",coordinates:[[[-120,49],[-120,60],[-110,60],[-110,68.8],[-102,68.8],[-102,49],[-120,49]]]}},{name:"Canada Central",timezoneName:"America/Winnipeg",utcOffset:-6,geometry:{type:"Polygon",coordinates:[[[-102,49],[-102,68.8],[-90,68.8],[-90,60],[-85,60],[-85,51],[-89,51],[-89,49],[-102,49]]]}},{name:"Canada Eastern",timezoneName:"America/Toronto",utcOffset:-5,geometry:{type:"Polygon",coordinates:[[[-89,41.7],[-89,51],[-85,51],[-85,60],[-68,60],[-68,45],[-74.7,45],[-76,44],[-82.4,42],[-89,41.7]]]}},{name:"Central European Time",timezoneName:"Europe/Berlin",utcOffset:1,geometry:{type:"MultiPolygon",coordinates:[[[[-4.8,36],[3.3,42.5],[7.4,43.7],[15,46.6],[22.9,48.6],[26.6,47.9],[29.7,45.9],[28.2,43.8],[22.4,41.3],[20.2,39.6],[14.5,35.9],[12.1,35.5],[8.1,36.9],[5.3,36.1],[-4.8,36]]]]}},{name:"Moscow Time",timezoneName:"Europe/Moscow",utcOffset:3,geometry:{type:"Polygon",coordinates:[[[27,41],[60,41],[60,68],[27,68],[27,41]]]}},{name:"Yekaterinburg Time",timezoneName:"Asia/Yekaterinburg",utcOffset:5,geometry:{type:"Polygon",coordinates:[[[60,45],[87,45],[87,73],[60,73],[60,45]]]}},{name:"China Standard Time",timezoneName:"Asia/Shanghai",utcOffset:8,geometry:{type:"Polygon",coordinates:[[[73.5,18.2],[134.8,18.2],[134.8,53.6],[73.5,53.6],[73.5,18.2]]]}},{name:"India Standard Time",timezoneName:"Asia/Kolkata",utcOffset:5.5,geometry:{type:"Polygon",coordinates:[[[68.1,6.7],[97.4,6.7],[97.4,37.1],[68.1,37.1],[68.1,6.7]]]}},{name:"Brazil Eastern",timezoneName:"America/Sao_Paulo",utcOffset:-3,geometry:{type:"Polygon",coordinates:[[[-57.6,-33.7],[-34.8,-33.7],[-34.8,5.3],[-57.6,5.3],[-57.6,-33.7]]]}},{name:"Brazil Western",timezoneName:"America/Cuiaba",utcOffset:-4,geometry:{type:"Polygon",coordinates:[[[-74,-18],[-57.6,-18],[-57.6,5.3],[-74,5.3],[-74,-18]]]}},{name:"Australian Eastern Standard Time",timezoneName:"Australia/Sydney",utcOffset:10,geometry:{type:"Polygon",coordinates:[[[140.9,-39.2],[153.6,-39.2],[153.6,-10.7],[140.9,-10.7],[140.9,-39.2]]]}},{name:"Australian Central Standard Time",timezoneName:"Australia/Adelaide",utcOffset:9.5,geometry:{type:"Polygon",coordinates:[[[129,-38],[140.9,-38],[140.9,-10.7],[129,-10.7],[129,-38]]]}},{name:"Australian Western Standard Time",timezoneName:"Australia/Perth",utcOffset:8,geometry:{type:"Polygon",coordinates:[[[112.9,-35.1],[129,-35.1],[129,-10.7],[112.9,-10.7],[112.9,-35.1]]]}}]},calculateCurrentUTCOffset(e){try{let t=new Date;if(Intl&&Intl.DateTimeFormat){let i=new Date(t.toLocaleString("en-US",{timeZone:"UTC"})),o=(new Date(t.toLocaleString("en-US",{timeZone:e})).getTime()-i.getTime())/(1e3*60*60);return Math.round(o*2)/2}}catch(t){console.warn(`Failed to calculate offset for ${e}:`,t)}return this.extractUTCOffset(e)},getCurrentTimeInTimezone(e){try{return new Date().toLocaleString("en-US",{timeZone:e,hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return"Unknown"}},getTimezoneOffset(e){try{let t=new Date,i=new Date(t.getTime()+t.getTimezoneOffset()*6e4);return(new Date(i.toLocaleString("en-US",{timeZone:e})).getTime()-i.getTime())/(1e3*60*60)}catch(t){return console.error("Error getting timezone offset for",e,t),{"America/New_York":-5,"America/Chicago":-6,"America/Denver":-7,"America/Los_Angeles":-8,"Europe/London":0,"Europe/Paris":1,"Europe/Moscow":3,"Asia/Tokyo":9,"Australia/Sydney":10,"Pacific/Auckland":12}[e]||0}},extractUTCOffset(e){let t={"Pacific/Baker_Island":-12,"Pacific/Midway":-11,"Pacific/Honolulu":-10,"Pacific/Marquesas":-9.5,"America/Anchorage":-9,"America/Los_Angeles":-8,"America/Vancouver":-8,"America/Denver":-7,"America/Phoenix":-7,"America/Chicago":-6,"America/Mexico_City":-6,"America/New_York":-5,"America/Toronto":-5,"America/Caracas":-4,"America/Santiago":-4,"America/Sao_Paulo":-3,"America/Buenos_Aires":-3,"America/St_Johns":-3.5,"Atlantic/Cape_Verde":-1,"Atlantic/Azores":-1,"Europe/London":0,"Europe/Dublin":0,"Africa/Casablanca":0,"Europe/Berlin":1,"Europe/Paris":1,"Europe/Rome":1,"Europe/Helsinki":2,"Europe/Athens":2,"Africa/Cairo":2,"Europe/Moscow":3,"Africa/Nairobi":3,"Asia/Dubai":4,"Asia/Baku":4,"Asia/Kabul":4.5,"Asia/Karachi":5,"Asia/Kolkata":5.5,"Asia/Kathmandu":5.75,"Asia/Dhaka":6,"Asia/Yangon":6.5,"Asia/Bangkok":7,"Asia/Jakarta":7,"Asia/Shanghai":8,"Asia/Singapore":8,"Asia/Manila":8,"Australia/Perth":8,"Asia/Tokyo":9,"Asia/Seoul":9,"Australia/Adelaide":9.5,"Australia/Darwin":9.5,"Australia/Sydney":10,"Australia/Melbourne":10,"Pacific/Guam":10,"Australia/Lord_Howe":10.5,"Pacific/Norfolk":11,"Pacific/Auckland":12,"Pacific/Fiji":12,"Pacific/Chatham":12.75,"Pacific/Tongatapu":13,"Pacific/Kiritimati":14};if(t[e])return t[e];if(e.includes("UTC")||e.includes("GMT")){let i=e.match(/([+-])(\d+)(?:\.(\d+))?/);if(i){let n=i[1]==="+"?1:-1,s=parseInt(i[2]),o=i[3]?parseInt(i[3])*6:0;return n*(s+o/60)}}return 0},addSimplifiedTimezones(e){[{name:"UTC-12 to UTC-8 (Pacific)",color:"rgba(255, 99, 132, 0.3)",bounds:[[-180,-60],[-120,75]]},{name:"UTC-8 to UTC-5 (Americas)",color:"rgba(54, 162, 235, 0.3)",bounds:[[-120,-60],[-60,75]]},{name:"UTC-5 to UTC-1 (Atlantic)",color:"rgba(255, 205, 86, 0.3)",bounds:[[-60,-60],[-15,75]]},{name:"UTC-1 to UTC+3 (Europe/Africa)",color:"rgba(75, 192, 192, 0.3)",bounds:[[-15,-60],[45,75]]},{name:"UTC+3 to UTC+7 (Asia West)",color:"rgba(153, 102, 255, 0.3)",bounds:[[45,-60],[105,75]]},{name:"UTC+7 to UTC+12 (Asia East/Pacific)",color:"rgba(255, 159, 64, 0.3)",bounds:[[105,-60],[180,75]]}].forEach((i,n)=>{let[s,o]=i.bounds,r=`timezone-region-${n}`,a=`timezone-layer-${n}`,l={type:"Feature",geometry:{type:"Polygon",coordinates:[[[s[0],s[1]],[o[0],s[1]],[o[0],o[1]],[s[0],o[1]],[s[0],s[1]]]]},properties:{name:i.name,color:i.color}};e.addSource(r,{type:"geojson",data:l}),e.addLayer({id:a,type:"fill",source:r,paint:{"fill-color":i.color,"fill-opacity":.3}}),e.addLayer({id:`${a}-border`,type:"line",source:r,paint:{"line-color":i.color.replace("0.3","0.8"),"line-width":1,"line-dasharray":[3,3]}}),e.on("click",a,c=>{this.shouldShowTimezonePopup(e,c)&&new maplibregl.Popup().setLngLat(c.lngLat).setHTML(`
            <div class="p-2">
              <div class="font-semibold text-gray-900">${i.name}</div>
              <div class="text-xs text-gray-600 mt-1">Timezone Region</div>
            </div>
          `).addTo(e)}),e.on("mouseenter",a,()=>{e.getCanvas().style.cursor="pointer"}),e.on("mouseleave",a,()=>{e.getCanvas().style.cursor=""})}),console.log("Simplified timezone overlay added successfully")},async loadEmbeddedTimezones(e){console.log("Loading timezone boundaries like timeanddate.com...");try{await this.loadTimeAndDateStyleTimezones(e)}catch(t){console.error("Failed to load timezone data:",t),this.addSimplifiedTimezones(e)}},async loadTimeAndDateStyleTimezones(e){console.log("Loading actual timezone boundary data...");try{await this.useActualTimezoneBoundaries(e)}catch(t){console.error("Failed to load timezone boundaries:",t),await this.loadSimplifiedAccurateTimezones(e)}},async useActualTimezoneBoundaries(e){console.log("Creating timezone boundaries with multiple zones per country...");let t=[{timezone:"America/Los_Angeles",name:"US Pacific Time",offset:-8,geometry:{type:"Polygon",coordinates:[[[-124.7,32.5],[-124.7,49],[-120,49],[-117,44],[-114,32.5],[-124.7,32.5]]]}},{timezone:"America/Denver",name:"US Mountain Time",offset:-7,geometry:{type:"Polygon",coordinates:[[[-117,32.5],[-117,49],[-104,49],[-104,32.5],[-117,32.5]]]}},{timezone:"America/Chicago",name:"US Central Time",offset:-6,geometry:{type:"Polygon",coordinates:[[[-104,25.8],[-104,49],[-87.5,49],[-84,30],[-97,25.8],[-104,25.8]]]}},{timezone:"America/New_York",name:"US Eastern Time",offset:-5,geometry:{type:"Polygon",coordinates:[[[-87.5,24.5],[-87.5,49],[-67,49],[-67,44],[-80,25],[-87.5,24.5]]]}},{timezone:"Europe/Moscow",name:"Moscow Time",offset:3,geometry:{type:"Polygon",coordinates:[[[27,41],[60,41],[60,82],[27,82],[27,41]]]}},{timezone:"Asia/Yekaterinburg",name:"Yekaterinburg Time",offset:5,geometry:{type:"Polygon",coordinates:[[[60,41],[87,41],[87,82],[60,82],[60,41]]]}},{timezone:"Asia/Novosibirsk",name:"Novosibirsk Time",offset:7,geometry:{type:"Polygon",coordinates:[[[87,41],[120,41],[120,82],[87,82],[87,41]]]}},{timezone:"Asia/Yakutsk",name:"Yakutsk Time",offset:9,geometry:{type:"Polygon",coordinates:[[[120,41],[150,41],[150,82],[120,82],[120,41]]]}},{timezone:"Asia/Vladivostok",name:"Vladivostok Time",offset:10,geometry:{type:"Polygon",coordinates:[[[150,41],[180,41],[180,82],[150,82],[150,41]]]}},{timezone:"Australia/Perth",name:"Western Australia",offset:8,geometry:{type:"Polygon",coordinates:[[[112,-35],[129,-35],[129,-13.5],[112,-13.5],[112,-35]]]}},{timezone:"Australia/Adelaide",name:"Central Australia",offset:9.5,geometry:{type:"Polygon",coordinates:[[[129,-38],[141,-38],[141,-26],[129,-26],[129,-38]]]}},{timezone:"Australia/Sydney",name:"Eastern Australia",offset:10,geometry:{type:"Polygon",coordinates:[[[141,-39],[154,-39],[154,-10],[141,-10],[141,-39]]]}},{timezone:"America/Vancouver",name:"Canada Pacific",offset:-8,geometry:{type:"Polygon",coordinates:[[[-141,48],[-120,48],[-120,84],[-141,84],[-141,48]]]}},{timezone:"America/Edmonton",name:"Canada Mountain",offset:-7,geometry:{type:"Polygon",coordinates:[[[-120,48],[-102,48],[-102,84],[-120,84],[-120,48]]]}},{timezone:"America/Winnipeg",name:"Canada Central",offset:-6,geometry:{type:"Polygon",coordinates:[[[-102,48],[-90,48],[-90,84],[-102,84],[-102,48]]]}},{timezone:"America/Toronto",name:"Canada Eastern",offset:-5,geometry:{type:"Polygon",coordinates:[[[-90,48],[-60,48],[-60,84],[-90,84],[-90,48]]]}},{timezone:"Europe/London",name:"GMT/BST",offset:0,geometry:{type:"Polygon",coordinates:[[[-11,49.5],[2,49.5],[2,61],[-11,61],[-11,49.5]]]}},{timezone:"Europe/Berlin",name:"Central Europe",offset:1,geometry:{type:"Polygon",coordinates:[[[2,35],[24,35],[24,71],[2,71],[2,35]]]}},{timezone:"Asia/Shanghai",name:"China Standard",offset:8,geometry:{type:"Polygon",coordinates:[[[73,18],[135,18],[135,54],[73,54],[73,18]]]}},{timezone:"Asia/Tokyo",name:"Japan Standard",offset:9,geometry:{type:"Polygon",coordinates:[[[129,24],[146,24],[146,46],[129,46],[129,24]]]}}],i=this.getTimezoneColors();t.forEach((n,s)=>{let o=this.getColorForOffset(n.offset,i),r=`timezone-boundary-${s}`,a=`timezone-layer-${s}`,l=`timezone-border-${s}`;e.addSource(r,{type:"geojson",data:{type:"Feature",geometry:n.geometry,properties:{timezone:n.timezone,name:n.name,offset:n.offset}}}),e.addLayer({id:a,type:"fill",source:r,paint:{"fill-color":o,"fill-opacity":.4}}),e.addLayer({id:l,type:"line",source:r,paint:{"line-color":o.replace("0.3","0.9"),"line-width":1,"line-opacity":.8}}),e.on("click",a,c=>{let h=this.getCurrentTimeInTimezone(n.timezone);new maplibregl.Popup().setLngLat(c.lngLat).setHTML(`
            <div class="team-popup p-4">
              <div class="text-sm font-semibold text-gray-900 mb-2">${n.name}</div>
              <div class="text-xs text-gray-600 mb-1">UTC${n.offset>=0?"+":""}${n.offset}</div>
              <div class="text-xs text-gray-600 mb-1">${n.timezone}</div>
              <div class="text-xs text-gray-600">Current time: ${h}</div>
            </div>
          `).addTo(e)})}),console.log(`Added ${t.length} timezone boundary regions`)},async createTimezoneRegionsFromRealBoundaries(e,t){console.log("Creating timezone regions from real geographic boundaries...");let i=this.getTimezoneColors(),n=this.getCountryTimezoneMap(),s={};t.features.forEach(o=>{let r=o.properties.NAME||o.properties.name||o.properties.NAME_EN,a=n[r];if(a){let l=a.offset.toString();s[l]||(s[l]={features:[],timezone:a.timezone,offset:a.offset,countries:[]}),s[l].features.push(o),s[l].countries.push(r)}}),Object.keys(s).forEach(o=>{let r=s[o],a=this.getColorForOffset(r.offset,i),l=`timezone-group-${o.replace(".","_").replace("-","neg")}`,c=`timezone-group-layer-${o.replace(".","_").replace("-","neg")}`,h=`timezone-group-border-${o.replace(".","_").replace("-","neg")}`,f={type:"FeatureCollection",features:r.features};console.log(`Adding timezone group UTC${r.offset>=0?"+":""}${r.offset} with ${r.features.length} regions`),e.addSource(l,{type:"geojson",data:f}),e.addLayer({id:c,type:"fill",source:l,paint:{"fill-color":a,"fill-opacity":.4}}),e.addLayer({id:h,type:"line",source:l,paint:{"line-color":a.replace("0.3","0.9"),"line-width":1,"line-opacity":.7}}),e.on("click",c,g=>{let m=e.queryRenderedFeatures(g.point,{layers:[c]});if(m.length>0){let d=m[0],y=d.properties.NAME||d.properties.name||"Unknown Region",v=this.getCurrentTimeInTimezone(r.timezone);new maplibregl.Popup().setLngLat(g.lngLat).setHTML(`
              <div class="team-popup p-4">
                <div class="text-sm font-semibold text-gray-900 mb-2">${y}</div>
                <div class="text-xs text-gray-600 mb-1">UTC${r.offset>=0?"+":""}${r.offset}</div>
                <div class="text-xs text-gray-600 mb-1">${r.timezone}</div>
                <div class="text-xs text-gray-600">Current time: ${v}</div>
              </div>
            `).addTo(e)}})}),console.log(`Successfully created timezone overlay with ${Object.keys(s).length} timezone groups using real boundaries`)},async loadSimplifiedAccurateTimezones(e){console.log("Loading simplified accurate timezone data...");let t=[{name:"Pacific Time",offset:-8,bounds:[-180,30,-120,70],timezone:"America/Los_Angeles"},{name:"Mountain Time",offset:-7,bounds:[-120,30,-105,55],timezone:"America/Denver"},{name:"Central Time",offset:-6,bounds:[-105,25,-90,50],timezone:"America/Chicago"},{name:"Eastern Time",offset:-5,bounds:[-90,25,-65,50],timezone:"America/New_York"},{name:"Atlantic Time",offset:-4,bounds:[-70,10,-55,50],timezone:"America/Halifax"},{name:"Brazil Time",offset:-3,bounds:[-75,-35,-35,10],timezone:"America/Sao_Paulo"},{name:"GMT/WET",offset:0,bounds:[-15,35,5,70],timezone:"Europe/London"},{name:"CET",offset:1,bounds:[5,35,25,70],timezone:"Europe/Berlin"},{name:"EET",offset:2,bounds:[25,35,45,70],timezone:"Europe/Helsinki"},{name:"West Africa",offset:1,bounds:[-20,-35,15,35],timezone:"Africa/Lagos"},{name:"East Africa",offset:3,bounds:[15,-35,50,35],timezone:"Africa/Nairobi"},{name:"Moscow Time",offset:3,bounds:[25,40,65,75],timezone:"Europe/Moscow"},{name:"India Standard",offset:5.5,bounds:[65,5,100,40],timezone:"Asia/Kolkata"},{name:"China Standard",offset:8,bounds:[75,15,135,55],timezone:"Asia/Shanghai"},{name:"Japan Standard",offset:9,bounds:[125,25,150,50],timezone:"Asia/Tokyo"},{name:"Australia West",offset:8,bounds:[110,-45,130,-10],timezone:"Australia/Perth"},{name:"Australia Central",offset:9.5,bounds:[130,-35,145,-10],timezone:"Australia/Adelaide"},{name:"Australia East",offset:10,bounds:[145,-45,180,-10],timezone:"Australia/Sydney"},{name:"New Zealand",offset:12,bounds:[165,-50,180,-30],timezone:"Pacific/Auckland"}],i=this.getTimezoneColors();t.forEach((n,s)=>{let o=this.getColorForOffset(n.offset,i),r=`timezone-${s}`,a=`timezone-layer-${s}`,l=`timezone-border-${s}`,[c,h,f,g]=n.bounds,m=[[[c,h],[f,h],[f,g],[c,g],[c,h]]];e.addSource(r,{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:m},properties:{name:n.name,timezone:n.timezone,offset:n.offset}}}),e.addLayer({id:a,type:"fill",source:r,paint:{"fill-color":o,"fill-opacity":.4}}),e.addLayer({id:l,type:"line",source:r,paint:{"line-color":o.replace("0.3","0.8"),"line-width":1,"line-opacity":.8}}),e.on("click",a,d=>{if(!this.shouldShowTimezonePopup(e,d))return;let y=this.getCurrentTimeInTimezone(n.timezone);new maplibregl.Popup().setLngLat(d.lngLat).setHTML(`
            <div class="team-popup p-4">
              <div class="text-sm font-semibold text-gray-900 mb-2">${n.name}</div>
              <div class="text-xs text-gray-600 mb-1">UTC${n.offset>=0?"+":""}${n.offset}</div>
              <div class="text-xs text-gray-600 mb-1">${n.timezone}</div>
              <div class="text-xs text-gray-600">Current time: ${y}</div>
            </div>
          `).addTo(e)})}),console.log(`Added ${t.length} timezone regions`)},async loadTimezoneShapes(e){console.log("Loading timezone boundary data...");try{let t=this.getAccurateTimezoneShapes(),i=this.getTimezoneColors();console.log(`Loading ${t.length} timezone regions`),t.forEach((n,s)=>{let o=`timezone-region-${s}`,r=`timezone-layer-${s}`,a=`timezone-border-${s}`,l=this.getColorForOffset(n.utcOffset,i);e.addSource(o,{type:"geojson",data:{type:"Feature",geometry:n.geometry,properties:{name:n.name,utcOffset:n.utcOffset,timezoneName:n.timezoneName}}}),e.addLayer({id:r,type:"fill",source:o,paint:{"fill-color":l,"fill-opacity":.4}}),e.addLayer({id:a,type:"line",source:o,paint:{"line-color":l.replace("0.3","0.9"),"line-width":1,"line-opacity":.7}}),e.on("click",r,c=>{if(!this.shouldShowTimezonePopup(e,c))return;let h=this.getCurrentTimeInTimezone(n.timezoneName);new maplibregl.Popup().setLngLat(c.lngLat).setHTML(`
              <div class="team-popup p-4">
                <div class="text-sm font-semibold text-gray-900 mb-2">${n.name}</div>
                <div class="text-xs text-gray-600 mb-1">UTC${n.utcOffset>=0?"+":""}${n.utcOffset}</div>
                <div class="text-xs text-gray-600 mb-1">${n.timezoneName}</div>
                <div class="text-xs text-gray-600">Current time: ${h}</div>
              </div>
            `).addTo(e)})}),console.log(`Added ${t.length} timezone regions with accurate boundaries`)}catch(t){throw console.error("Failed to load timezone shapes:",t),t}},async loadCountryBasedTimezones(e){console.log("Loading country boundaries for timezone mapping...");try{let t=await fetch("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson");if(!t.ok)throw new Error(`HTTP ${t.status}`);let i=await t.json();console.log(`Loaded ${i.features.length} countries`);let n=this.getCountryTimezoneMap(),s=this.getTimezoneColors(),o={};i.features.forEach(r=>{let a=r.properties.NAME||r.properties.name||r.properties.NAME_EN,l=n[a];if(l){let c=l.offset.toString();o[c]||(o[c]={features:[],timezone:l.timezone,offset:l.offset,countries:[]}),o[c].features.push(r),o[c].countries.push(a)}else console.log(`No timezone mapping for country: ${a}`)}),console.log(`Created ${Object.keys(o).length} timezone groups`),Object.keys(o).forEach(r=>{let a=o[r],l=this.getColorForOffset(a.offset,s),c=`timezone-group-${r.replace(".","_").replace("-","neg")}`,h=`timezone-group-layer-${r.replace(".","_").replace("-","neg")}`,f=`timezone-group-border-${r.replace(".","_").replace("-","neg")}`,g=`timezone-group-hover-${r.replace(".","_").replace("-","neg")}`,m={type:"FeatureCollection",features:a.features};console.log(`Adding timezone group UTC${a.offset>=0?"+":""}${a.offset} with ${a.features.length} countries: ${a.countries.slice(0,3).join(", ")}${a.countries.length>3?"...":""}`),e.addSource(c,{type:"geojson",data:m}),e.addLayer({id:h,type:"fill",source:c,paint:{"fill-color":l,"fill-opacity":.4}}),e.addLayer({id:g,type:"fill",source:c,paint:{"fill-color":l,"fill-opacity":.7},layout:{visibility:"none"}}),e.addLayer({id:f,type:"line",source:c,paint:{"line-color":l.replace("0.3","0.9"),"line-width":1.2,"line-opacity":.8}}),e.on("click",h,d=>{if(!this.shouldShowTimezonePopup(e,d))return;let y=e.queryRenderedFeatures(d.point,{layers:[h]});if(y.length>0){let v=y[0],E=v.properties.NAME||v.properties.name||"Unknown Country",L=this.getCurrentTimeInTimezone(a.timezone);new maplibregl.Popup().setLngLat(d.lngLat).setHTML(`
                <div class="p-3">
                  <div class="font-semibold text-gray-900">${E}</div>
                  <div class="text-xs text-gray-600 mt-1">UTC ${a.offset>=0?"+":""}${a.offset}</div>
                  <div class="text-xs text-gray-500 mt-1">${a.timezone}</div>
                  <div class="text-xs text-gray-700 mt-2">Current time: ${L}</div>
                </div>
              `).addTo(e)}}),e.on("mousemove",h,d=>{if(e.getCanvas().style.cursor="pointer",d.features&&d.features.length>0){let y=d.features[0].properties.NAME||d.features[0].properties.name;try{e.setFilter(g,["==",["get","NAME"],y]),e.setLayoutProperty(g,"visibility","visible")}catch(v){console.warn("Failed to show hover highlight:",v)}}}),e.on("mouseleave",h,()=>{e.getCanvas().style.cursor="";try{e.setLayoutProperty(g,"visibility","none")}catch(d){console.warn("Failed to hide hover highlight:",d)}})}),console.log("\u2705 Country-based timezone boundaries loaded successfully with hover effects!")}catch(t){console.error("Failed to load country timezone data:",t),this.addSimplifiedTimezones(e)}},getCountryTimezoneMap(){return{"United States of America":{timezone:"America/New_York",offset:-5},USA:{timezone:"America/New_York",offset:-5},"United States":{timezone:"America/New_York",offset:-5},Canada:{timezone:"America/Toronto",offset:-5},Mexico:{timezone:"America/Mexico_City",offset:-6},Greenland:{timezone:"America/Godthab",offset:-3},Brazil:{timezone:"America/Sao_Paulo",offset:-3},Argentina:{timezone:"America/Buenos_Aires",offset:-3},Chile:{timezone:"America/Santiago",offset:-4},Colombia:{timezone:"America/Bogota",offset:-5},Peru:{timezone:"America/Lima",offset:-5},Venezuela:{timezone:"America/Caracas",offset:-4},Ecuador:{timezone:"America/Guayaquil",offset:-5},Bolivia:{timezone:"America/La_Paz",offset:-4},Paraguay:{timezone:"America/Asuncion",offset:-3},Uruguay:{timezone:"America/Montevideo",offset:-3},Guatemala:{timezone:"America/Guatemala",offset:-6},"Costa Rica":{timezone:"America/Costa_Rica",offset:-6},Panama:{timezone:"America/Panama",offset:-5},Cuba:{timezone:"America/Havana",offset:-5},Jamaica:{timezone:"America/Jamaica",offset:-5},"United Kingdom":{timezone:"Europe/London",offset:0},Ireland:{timezone:"Europe/Dublin",offset:0},Iceland:{timezone:"Atlantic/Reykjavik",offset:0},Portugal:{timezone:"Europe/Lisbon",offset:0},Spain:{timezone:"Europe/Madrid",offset:1},France:{timezone:"Europe/Paris",offset:1},Germany:{timezone:"Europe/Berlin",offset:1},Italy:{timezone:"Europe/Rome",offset:1},Netherlands:{timezone:"Europe/Amsterdam",offset:1},Belgium:{timezone:"Europe/Brussels",offset:1},Switzerland:{timezone:"Europe/Zurich",offset:1},Austria:{timezone:"Europe/Vienna",offset:1},"Czech Republic":{timezone:"Europe/Prague",offset:1},Poland:{timezone:"Europe/Warsaw",offset:1},Hungary:{timezone:"Europe/Budapest",offset:1},Slovakia:{timezone:"Europe/Bratislava",offset:1},Slovenia:{timezone:"Europe/Ljubljana",offset:1},Croatia:{timezone:"Europe/Zagreb",offset:1},Serbia:{timezone:"Europe/Belgrade",offset:1},"Bosnia and Herzegovina":{timezone:"Europe/Sarajevo",offset:1},Montenegro:{timezone:"Europe/Podgorica",offset:1},Macedonia:{timezone:"Europe/Skopje",offset:1},Albania:{timezone:"Europe/Tirane",offset:1},Denmark:{timezone:"Europe/Copenhagen",offset:1},Sweden:{timezone:"Europe/Stockholm",offset:1},Norway:{timezone:"Europe/Oslo",offset:1},Finland:{timezone:"Europe/Helsinki",offset:2},Estonia:{timezone:"Europe/Tallinn",offset:2},Latvia:{timezone:"Europe/Riga",offset:2},Lithuania:{timezone:"Europe/Vilnius",offset:2},Belarus:{timezone:"Europe/Minsk",offset:3},Ukraine:{timezone:"Europe/Kiev",offset:2},Moldova:{timezone:"Europe/Chisinau",offset:2},Romania:{timezone:"Europe/Bucharest",offset:2},Bulgaria:{timezone:"Europe/Sofia",offset:2},Greece:{timezone:"Europe/Athens",offset:2},Turkey:{timezone:"Europe/Istanbul",offset:3},Cyprus:{timezone:"Asia/Nicosia",offset:2},Russia:{timezone:"Europe/Moscow",offset:3},Morocco:{timezone:"Africa/Casablanca",offset:1},Algeria:{timezone:"Africa/Algiers",offset:1},Tunisia:{timezone:"Africa/Tunis",offset:1},Libya:{timezone:"Africa/Tripoli",offset:2},Egypt:{timezone:"Africa/Cairo",offset:2},Sudan:{timezone:"Africa/Khartoum",offset:2},Ethiopia:{timezone:"Africa/Addis_Ababa",offset:3},Kenya:{timezone:"Africa/Nairobi",offset:3},Tanzania:{timezone:"Africa/Dar_es_Salaam",offset:3},Uganda:{timezone:"Africa/Kampala",offset:3},"South Africa":{timezone:"Africa/Johannesburg",offset:2},Nigeria:{timezone:"Africa/Lagos",offset:1},Ghana:{timezone:"Africa/Accra",offset:0},Cameroon:{timezone:"Africa/Douala",offset:1},"Democratic Republic of the Congo":{timezone:"Africa/Kinshasa",offset:1},Angola:{timezone:"Africa/Luanda",offset:1},Zimbabwe:{timezone:"Africa/Harare",offset:2},Botswana:{timezone:"Africa/Gaborone",offset:2},Namibia:{timezone:"Africa/Windhoek",offset:2},Zambia:{timezone:"Africa/Lusaka",offset:2},Madagascar:{timezone:"Indian/Antananarivo",offset:3},Israel:{timezone:"Asia/Jerusalem",offset:2},Jordan:{timezone:"Asia/Amman",offset:2},Lebanon:{timezone:"Asia/Beirut",offset:2},Syria:{timezone:"Asia/Damascus",offset:2},Iraq:{timezone:"Asia/Baghdad",offset:3},Iran:{timezone:"Asia/Tehran",offset:3.5},"Saudi Arabia":{timezone:"Asia/Riyadh",offset:3},Kuwait:{timezone:"Asia/Kuwait",offset:3},Qatar:{timezone:"Asia/Qatar",offset:3},Bahrain:{timezone:"Asia/Bahrain",offset:3},"United Arab Emirates":{timezone:"Asia/Dubai",offset:4},Oman:{timezone:"Asia/Muscat",offset:4},Yemen:{timezone:"Asia/Aden",offset:3},Afghanistan:{timezone:"Asia/Kabul",offset:4.5},Pakistan:{timezone:"Asia/Karachi",offset:5},India:{timezone:"Asia/Kolkata",offset:5.5},Nepal:{timezone:"Asia/Kathmandu",offset:5.75},Bangladesh:{timezone:"Asia/Dhaka",offset:6},"Sri Lanka":{timezone:"Asia/Colombo",offset:5.5},Maldives:{timezone:"Indian/Maldives",offset:5},Myanmar:{timezone:"Asia/Yangon",offset:6.5},Thailand:{timezone:"Asia/Bangkok",offset:7},Laos:{timezone:"Asia/Vientiane",offset:7},Cambodia:{timezone:"Asia/Phnom_Penh",offset:7},Vietnam:{timezone:"Asia/Ho_Chi_Minh",offset:7},Malaysia:{timezone:"Asia/Kuala_Lumpur",offset:8},Singapore:{timezone:"Asia/Singapore",offset:8},Indonesia:{timezone:"Asia/Jakarta",offset:7},Brunei:{timezone:"Asia/Brunei",offset:8},Philippines:{timezone:"Asia/Manila",offset:8},"Timor-Leste":{timezone:"Asia/Dili",offset:9},China:{timezone:"Asia/Shanghai",offset:8},Mongolia:{timezone:"Asia/Ulaanbaatar",offset:8},"North Korea":{timezone:"Asia/Pyongyang",offset:9},"South Korea":{timezone:"Asia/Seoul",offset:9},Japan:{timezone:"Asia/Tokyo",offset:9},Taiwan:{timezone:"Asia/Taipei",offset:8},"Hong Kong":{timezone:"Asia/Hong_Kong",offset:8},Macau:{timezone:"Asia/Macau",offset:8},Kazakhstan:{timezone:"Asia/Almaty",offset:6},Kyrgyzstan:{timezone:"Asia/Bishkek",offset:6},Tajikistan:{timezone:"Asia/Dushanbe",offset:5},Turkmenistan:{timezone:"Asia/Ashgabat",offset:5},Uzbekistan:{timezone:"Asia/Tashkent",offset:5},Australia:{timezone:"Australia/Sydney",offset:10},"New Zealand":{timezone:"Pacific/Auckland",offset:12},"Papua New Guinea":{timezone:"Pacific/Port_Moresby",offset:10},Fiji:{timezone:"Pacific/Fiji",offset:12},Samoa:{timezone:"Pacific/Samoa",offset:13},Tonga:{timezone:"Pacific/Tongatapu",offset:13},Vanuatu:{timezone:"Pacific/Efate",offset:11},"Solomon Islands":{timezone:"Pacific/Guadalcanal",offset:11}}},shouldShowTimezonePopup(e,t){if(!this.currentNightPolygon)return!0;let i=[t.lngLat.lng,t.lngLat.lat],n=this.pointInPolygon(i,this.currentNightPolygon);return console.log("Click in night region:",n),!n},pointInPolygon(e,t){let[i,n]=e,s=!1;for(let o=0,r=t.length-1;o<t.length;r=o++){let[a,l]=t[o],[c,h]=t[r];l>n!=h>n&&i<(c-a)*(n-l)/(h-l)+a&&(s=!s)}return s},addSunlightOverlay(e){let t=new Date,i=this.calculateSolarPosition(t),n=[];for(let o=-180;o<=180;o+=1){let r=this.calculateTerminatorLatitude(o,i);!isNaN(r)&&r>=-90&&r<=90&&n.push([o,r])}let s=this.createNightPolygon(n,t);this.currentNightPolygon=s,e.addSource("night-overlay",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[s]},properties:{type:"night"}}}),e.addLayer({id:"night-overlay-layer",type:"fill",source:"night-overlay",paint:{"fill-color":"#1a1a2e","fill-opacity":.4}}),e.addLayer({id:"terminator-line",type:"line",source:"night-overlay",paint:{"line-color":"#fbbf24","line-width":1,"line-opacity":.6,"line-blur":2}}),e.on("click","night-overlay-layer",o=>{let r=new Date,a=r.toLocaleTimeString(),l=r.toUTCString();new maplibregl.Popup({className:"sunlight-info"}).setLngLat(o.lngLat).setHTML(`
          <div class="p-3">
            <div class="font-semibold text-yellow-400 mb-2">\u{1F319} Night Region</div>
            <div class="text-xs space-y-1">
              <div>Local: ${a}</div>
              <div>UTC: ${l}</div>
              <div class="text-yellow-300 mt-2">Solar terminator moves continuously as Earth rotates</div>
            </div>
          </div>
        `).addTo(e)}),e.on("mouseenter","night-overlay-layer",()=>{e.getCanvas().style.cursor="pointer"}),e.on("mouseleave","night-overlay-layer",()=>{e.getCanvas().style.cursor=""}),this.sunlightInterval=setInterval(()=>{this.updateSunlightOverlay(e)},6e4),console.log("Sunlight overlay added successfully")},createNightPolygon(e,t){if(e.length===0)return[];let i=(t.getUTCHours()+t.getUTCMinutes()/60)/24,n=t.getMonth()>=10||t.getMonth()<=2,s=[];return i>.5?(s.push([-180,85]),e.forEach(o=>s.push(o)),s.push([180,85],[180,-85],[-180,-85],[-180,85])):(s.push([180,85]),e.reverse().forEach(o=>s.push(o)),s.push([-180,85],[-180,-85],[180,-85],[180,85])),s},updateSunlightOverlay(e){if(!e.getSource("night-overlay"))return;let t=new Date,i=this.calculateSolarPosition(t),n=[];for(let o=-180;o<=180;o+=1){let r=this.calculateTerminatorLatitude(o,i);!isNaN(r)&&r>=-90&&r<=90&&n.push([o,r])}let s=this.createNightPolygon(n,t);this.currentNightPolygon=s,e.getSource("night-overlay").setData({type:"Feature",geometry:{type:"Polygon",coordinates:[s]},properties:{type:"night"}})},calculateSolarPosition(e){let t=this.getJulianDay(e),i=(t-2451545)/36525,n=this.mod(280.46646+i*(36000.76983+i*3032e-7),360),s=357.52911+i*(35999.05029-1537e-7*i),o=.016708634-i*(42037e-9+1267e-10*i),r=Math.sin(this.deg2rad(s))*(1.914602-i*(.004817+14e-6*i))+Math.sin(this.deg2rad(2*s))*(.019993-101e-6*i)+Math.sin(this.deg2rad(3*s))*289e-6,a=n+r,c=23+(26+(21.448-i*(46.815+i*(59e-5-i*.001813)))/60)/60+.00256*Math.cos(this.deg2rad(125.04-1934.136*i)),h=this.rad2deg(Math.asin(Math.sin(this.deg2rad(c))*Math.sin(this.deg2rad(a)))),f=Math.tan(this.deg2rad(c/2))*Math.tan(this.deg2rad(c/2)),g=4*this.rad2deg(f*Math.sin(2*this.deg2rad(n))-2*o*Math.sin(this.deg2rad(s))+4*o*f*Math.sin(this.deg2rad(s))*Math.cos(2*this.deg2rad(n))-.5*f*f*Math.sin(4*this.deg2rad(n))-1.25*o*o*Math.sin(2*this.deg2rad(s)));return{declination:h,equationOfTime:g,julianDay:t}},calculateTerminatorLatitude(e,t){let{declination:i,equationOfTime:n,julianDay:s}=t,o=n+4*e,r=new Date,c=(r.getUTCHours()*60+r.getUTCMinutes()+r.getUTCSeconds()/60+o)/4-180,h=this.deg2rad(i),f=this.deg2rad(c);if(Math.abs(Math.cos(f))<1e-6)return i>0?90-Math.abs(i):-90+Math.abs(i);let g=Math.atan(-Math.cos(f)/Math.tan(h));return this.rad2deg(g)},getJulianDay(e){let t=Math.floor((14-(e.getUTCMonth()+1))/12),i=e.getUTCFullYear()+4800-t,n=e.getUTCMonth()+1+12*t-3,s=e.getUTCDate()+Math.floor((153*n+2)/5)+365*i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400)-32045,o=(e.getUTCHours()+e.getUTCMinutes()/60+e.getUTCSeconds()/3600)/24;return s+o-.5},deg2rad(e){return e*Math.PI/180},rad2deg(e){return e*180/Math.PI},mod(e,t){return(e%t+t)%t},destroyed(){this.map&&this.map.remove(),this.sunlightInterval&&clearInterval(this.sunlightInterval)}};var Wn=document.querySelector("meta[name='csrf-token']").getAttribute("content"),Ei=new Ti("/live",Dt,{longPollFallbackMs:2500,params:{_csrf_token:Wn},hooks:ki});window.addEventListener("phx:speak_text",e=>{let{text:t,lang:i}=e.detail;window.speakText(t,i)});ot.default.config({barColors:{0:"#29d"},shadowColor:"rgba(0, 0, 0, .3)"});window.addEventListener("phx:page-loading-start",e=>ot.default.show(300));window.addEventListener("phx:page-loading-stop",e=>ot.default.hide());window.speakText=function(e,t,i=.8,n=1){if("speechSynthesis"in window){window.speechSynthesis.cancel();let s=new SpeechSynthesisUtterance(e);s.lang=t,s.rate=i,s.pitch=n,s.volume=1;let o=window.speechSynthesis.getVoices(),r=o.find(a=>a.lang===t)||o.find(a=>a.lang.startsWith(t.split("-")[0]));r&&(s.voice=r),window.speechSynthesis.speak(s)}else console.warn("Speech synthesis not supported in this browser")};"speechSynthesis"in window&&(window.speechSynthesis.onvoiceschanged=function(){});Ei.connect();window.liveSocket=Ei;})();
/**
 * @license MIT
 * topbar 2.0.0, 2023-02-04
 * https://buunguyen.github.io/topbar
 * Copyright (c) 2021 Buu Nguyen
 */
