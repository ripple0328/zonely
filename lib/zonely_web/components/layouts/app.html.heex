<%!-- Detect current view for active tab highlighting --%>
<% current_view = case assigns do
  %{socket: %{view: view}} -> view
  _ -> nil
end %>
<% active_tab = cond do
  current_view in [ZonelyWeb.ExploreLive] -> :explore
  current_view in [ZonelyWeb.MeLive, ZonelyWeb.MyNameCardLive] -> :me
  true -> :lists
end %>

<%!-- Desktop top nav (hidden on mobile) --%>
<header class="hidden sm:block border-b border-gray-200 bg-white" data-testid="main-header">
  <div class="mx-auto flex max-w-5xl items-center justify-between px-4 py-3 sm:px-6">
    <a href={~p"/"} class="flex items-center gap-2 text-lg font-bold text-gray-900" aria-label="SayMyName home">
      <span class="text-xl">üó£Ô∏è</span>
      <span>SayMyName</span>
    </a>
    <nav class="flex items-center gap-1" role="tablist" aria-label="Main navigation" data-testid="main-navigation">
      <a
        href={~p"/"}
        role="tab"
        aria-selected={if(active_tab == :lists, do: "true", else: "false")}
        class={[
          "flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",
          if(active_tab == :lists, do: "bg-blue-50 text-blue-700", else: "text-gray-600 hover:bg-gray-100 hover:text-gray-900")
        ]}
        data-testid="nav-lists"
      >
        <.icon name="hero-list-bullet" class="h-5 w-5" />
        Lists
      </a>
      <a
        href={~p"/explore"}
        role="tab"
        aria-selected={if(active_tab == :explore, do: "true", else: "false")}
        class={[
          "flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",
          if(active_tab == :explore, do: "bg-blue-50 text-blue-700", else: "text-gray-600 hover:bg-gray-100 hover:text-gray-900")
        ]}
        data-testid="nav-explore"
      >
        <.icon name="hero-magnifying-glass" class="h-5 w-5" />
        Explore
      </a>
      <a
        href={~p"/me"}
        role="tab"
        aria-selected={if(active_tab == :me, do: "true", else: "false")}
        class={[
          "flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",
          if(active_tab == :me, do: "bg-blue-50 text-blue-700", else: "text-gray-600 hover:bg-gray-100 hover:text-gray-900")
        ]}
        data-testid="nav-me"
      >
        <.icon name="hero-user-circle" class="h-5 w-5" />
        Me
      </a>
    </nav>
  </div>
</header>

<%!-- Main content area --%>
<main class="min-h-screen bg-gray-50 pb-20 sm:pb-0">
  <div class="mx-auto max-w-5xl px-4 py-6 sm:px-6">
    <.flash_group flash={@flash} />
    <%= @inner_content %>
  </div>
</main>

<%!-- Mobile bottom tab bar (hidden on desktop) --%>
<nav
  class="fixed bottom-0 inset-x-0 z-50 border-t border-gray-200 bg-white sm:hidden"
  role="tablist"
  aria-label="Main navigation"
  data-testid="mobile-tab-bar"
>
  <div class="flex items-center justify-around py-2">
    <a
      href={~p"/"}
      role="tab"
      aria-selected={if(active_tab == :lists, do: "true", else: "false")}
      class={[
        "flex flex-col items-center gap-1 rounded-lg px-4 py-1 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500",
        if(active_tab == :lists, do: "text-blue-600", else: "text-gray-500")
      ]}
      data-testid="mobile-nav-lists"
    >
      <.icon name="hero-list-bullet" class="h-6 w-6" />
      <span>Lists</span>
    </a>
    <a
      href={~p"/explore"}
      role="tab"
      aria-selected={if(active_tab == :explore, do: "true", else: "false")}
      class={[
        "flex flex-col items-center gap-1 rounded-lg px-4 py-1 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500",
        if(active_tab == :explore, do: "text-blue-600", else: "text-gray-500")
      ]}
      data-testid="mobile-nav-explore"
    >
      <.icon name="hero-magnifying-glass" class="h-6 w-6" />
      <span>Explore</span>
    </a>
    <a
      href={~p"/me"}
      role="tab"
      aria-selected={if(active_tab == :me, do: "true", else: "false")}
      class={[
        "flex flex-col items-center gap-1 rounded-lg px-4 py-1 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500",
        if(active_tab == :me, do: "text-blue-600", else: "text-gray-500")
      ]}
      data-testid="mobile-nav-me"
    >
      <.icon name="hero-user-circle" class="h-6 w-6" />
      <span>Me</span>
    </a>
  </div>
</nav>
